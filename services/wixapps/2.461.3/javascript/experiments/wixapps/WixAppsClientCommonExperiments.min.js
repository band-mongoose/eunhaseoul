define.experiment.Class("wixapps.apps.blog.ArchiveLogic.BlogManager",function(a,b){a.traits(b.merge(["wixapps.core.logics.BlogManagerTrait"])),a.resources(b.merge(["W.Viewer"])),a.fields({previewPageId:null}),a.methods({run:function(a,b,c){b.filter=b.filter||{},b.filter.deleted={$ne:!0},this.parent(a,b,c)}})}),define.experiment.Class("wixapps.apps.blog.BlogQueryPageLogic.BlogManager",function(a,b){a.traits(b.merge(["wixapps.core.logics.BlogManagerTrait"])),a.resources(b.merge(["W.Viewer"])),a.fields({_environment:null,previewPageId:null}),a.methods({initialize:b.after(function(){this.prefetchPreviewPageId()}),paramsFromUri:function(a){var b=a.split("/"),c={};c.filter={draft:!1},c.filter["scheduled.iso"]={$not:{$gt:"$now"}},c.filter.deleted={$ne:!0},"Featured"===b[0]&&(c.filter.featured=!0,b.shift());for(var d=0;d<b.length;d+=2)switch(b[d]){case"Type":c.filter._type=b[d+1];break;case"Tag":c.filter.tags=decodeURIComponent(b[d+1]);break;case"Page":c.page=b[d+1];break;case"Sort":c.sort=b[d+1];break;case"Date":var e=b[d+1];c.filter["date.iso"]={$regex:"^"+e}}return c.filter=JSON.stringify(c.filter),c},_addAppSpecificParams:function(a){var b;b=a.filter?JSON.parse(a.filter):{},b["scheduled.iso"]={$not:{$gt:"$now"}},b.draft=!1,b.deleted={$ne:!0},a.filter=JSON.stringify(b)}})}),define.experiment.Class("wixapps.apps.blog.PostListLogic.BlogManager",function(a,b){a.traits(b.merge(["wixapps.core.logics.BlogManagerTrait"])),a.resources(b.merge(["W.Viewer"])),a.fields({_localizer:null,previewPageId:null}),a.methods({initialize:b.after(function(){this.prefetchPreviewPageId()}),run:function(a,b,c){b=b||{};var d={};b.filter&&(d=JSON.parse(b.filter)),d["scheduled.iso"]={$not:{$gt:"$now"}},d.draft=!1,d.deleted={$ne:!0},b.filter=JSON.encode(d),this.parent(a,b,c)},_getTags:function(a,b){a.draft=!1,a.deleted={$ne:!0};var c=function(a){var c=Object.keys(a.getValue()).sort();b(c)};this._environment.getDataService().groupByAndCount("Posts","Post",a,"tags",{},c,function(){})}})}),define.experiment.Class("wixapps.core.apprepo.AppPartDefinition.AppBuilderTags",function(a){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.traits([]),a.fields({_appInstance:null}),a.methods({initialize:function(a,b){this._appInstance=a,b.dataSelectorDef?this.setDataSelectorDef(b.dataSelectorDef):this.setDataSelectorId(b.dataSelector),this.setViewName(b.viewName),this.setType(b.type),this.setDisplayName(b.displayName)},setDataSelectorDef:function(a){this._dataSelectorDef=_.cloneDeep(a),this.setDataSelectorId(a.id)},getDataSelectorDef:function(){return _.cloneDeep(this._dataSelectorDef)},clearDataSelectorPredefinedSettings:function(){this._dataSelectorDef.predefinedSettings=null}})}),define.experiment.Class("wixapps.core.apprepo.AppPartDefinition.AppBuilderTagsEditor",function(a){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.traits([]),a.fields({_appInstance:null,_dataSelectorDef:{}}),a.methods({initialize:function(a,b){this._appInstance=a,this.setDataSelectorDef(b.dataSelectorDef),this.setViewName(b.viewName),this.setType(b.type),this.setDisplayName(b.displayName)},getDefinition:function(){return{dataSelectorDef:this._dataSelectorDef||{id:this._dataSelector},viewName:this._viewName,type:this._type,displayName:this._displayName}},setDataSelectorDef:function(a){this._dataSelectorDef=_.cloneDeep(a)},getDataSelectorDef:function(){return _.cloneDeep(this._dataSelectorDef)},setDataSelectorId:function(a){this._dataSelectorDef.id=a},getDataSelectorId:function(){return this._dataSelectorDef.id},setDataSelectorPredefinedSettings:function(a){this._dataSelectorDef.predefinedSettings=_.cloneDeep(a)},getDataSelector:function(){return this._appInstance.getDataSelectors().getById(this._dataSelectorDef.id)}})}),define.experiment.Class("wixapps.core.apprepo.AppPartsRepository.AppBuilderTagsEditor",function(a){a.methods({createAndRegister:function(a,b,c,d){var e=this._createAppPartDefinition(a,b,c,d),f=this.register("apppart",e);return f},_createAppPartDefinition:function(a,b,c,d){var e={type:c,dataSelectorDef:a,viewName:b,displayName:d};return new this.imports.AppPartDefinition(this._appInstance,e)}})}),define.experiment.Class("wixapps.core.apprepo.AppRepoTransport.ListsNewServerBaseUrl",function(a){a.methods({_getServiceUrl:function(a){if(a.test("published")&&this.resources.W.Config.env.$isPublicViewerFrame){var b=this.resources.W.Config.getAppsRepoServerUrl();return b+"/"}var c=window.location.origin||this._extractBasePath(window.location.href);return c+"/apps/appBuilder/api"}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationDefinition.AppBuilderTags",function(a){a.statics({TAGS_KEY:"tags"}),a.methods({getTags:function(){return this._appDef[this.TAGS_KEY]},setTags:function(a){this._appDef[this.TAGS_KEY]=a}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationDefinition.BlinkyFormContainer",function(a){a.statics({FORMS_KEY:"forms",MINI_PARTS_KEY:"miniParts"}),a.methods({getForms:function(){return this._appDef[this.FORMS_KEY]},setForms:function(a){this._appDef[this.FORMS_KEY]=a},getMiniParts:function(){return this._appDef[this.MINI_PARTS_KEY]},setMiniParts:function(a){this._appDef[this.MINI_PARTS_KEY]=a}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.AppBuilderDeleteType.New",function(a){a.methods({isStubStore:function(){return this._isStubStore},deleteType:function(a,b,c,d){var e=this,f=function(c){var f=e.getTypesManager().getType(a),g=c;e.getDataProviders().getWixDbDataProvider().deleteType(a);var h=e._dataSelectorsRepo.filterByType(a);_.each(h,function(a){e._dataSelectorsRepo.remove(a.getId())});var i=e._partsRepo.filterByType(a,!1,!0);_.each(i,function(a){e._partsRepo.remove(a.getId())});var j=e._pagesRepo.filterByType(a);_.each(j,function(a){e._pagesRepo.remove(a.getId())});var k=e.getViewDefinitions(),l=k.getViewDefinitionsByType(a),m={appInstance:e,typeName:a,typeObj:f,itemsOfType:g,dataSelectors:h,partDefs:i,pageDefs:j,viewDefs:l};if(!d){var n={c1:a};e._logger.reportEvent(e._logger.Events.APP_BUILDER_USER_DELETED_TYPE,n)}b(m)},g=function(a){e._logger.reportError(a,e.$className,"deleteType",l.SubCategory.APP_BUILDER)};this.getDataProviders().getWixDbDataProvider().query(a,{},{title:1},0,-1,f,g)},restoreType:function(a,b,c,d,e,f){var g=this,h=function(a){g._logger.reportError(a,g.$className,"restoreType",l.SubCategory.APP_BUILDER)};this.getDataProviders().getWixDbDataProvider().restoreType(a,b,function(){},h),_.forEach(c,function(a){g._dataSelectorsRepo.registerWithId(a.getId(),a)}),_.forEach(d,function(a){g._partsRepo.registerWithId(a.getId(),a)}),_.forEach(e,function(a){g._pagesRepo.registerWithId(a.getId(),a)});var i=this._viewsDefRepo.getViewDefinitionsByType(a.name);i.length||_.forEach(f,function(a){g.addViewDefinition(a.getValue())})}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.AppBuilderTags",function(a,b){a.utilize(b.merge(["wixapps.core.apprepo.TagsRepository"])),a.fields({_tagsRepo:null,_tagsMapping:null}),a.methods({initialize:b.before(function(){this._tagsRepo=new this.imports.TagsRepository(this)}),toObject:function(){var a=new this.imports.ApplicationDefinition;a.setDataProviders(this._dataProvidersRepo.toObject()),a.setDataSelectors(this._dataSelectorsRepo.toArray()),a.setAppPartDefinitions(this._partsRepo.toObject());var b=this.getDataProviders().getWixDbDataProvider();return a.setTypes(b.getManagedTypes()),a.setTags(this._tagsRepo.toObject()),a.setViewDefinitions(this._viewsDefRepo.toArray()),a.setPages(this._pagesRepo.toObject()),a.setAppInstanceVersion(this.getAppInstanceVersion()),a.toObject()},updateDataSelectors:function(a,b){var c=this._dataSelectorsRepo.getByType(a._type);_.each(c,function(c){c.isListSelector()&&c.updateList(a,b)})},_loadAppData:function(){this._dataProvidersRepo.fromObject(this._appDef.getDataProviders()),this._dataProvidersRepo.isWixDbDataProviderDefined()||this._dataProvidersRepo.createWixDbDataProvider(),this._dataSelectorsRepo.fromArray(this._appDef.getDataSelectors()),this._partsRepo.fromObject(this._appDef.getAppPartDefinitions()),this._tagsRepo.fromObject(this._appDef.getTags()),this.loadViews(this._appDef.getViewDefinitions()),this._pagesRepo.fromObject(this._appDef.getPages()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},getTagsRepo:function(){return this._tagsRepo},getTagsMapping:function(){return this._tagsRepo&&!this._tagsMapping&&(this._tagsMapping=this._dataFactory.createDataItem(this._tagsRepo.toObject())),this._tagsMapping}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.AppBuilderTagsEditor",function(a,b){a.utilize(b.merge(["wixapps.core.apprepo.TagsRepository"])),a.fields({_tagsRepo:null,_tagsMapping:null}),a.methods({_migrateDefinitions:function(a){var b=this._viewBuilder,c=_.reduce(a._appDef.views,function(a,c){return a.concat(b._find(c,function(a){return a.textAlign&&a["text-align"]}))},[]);_.each(c,function(a){delete a.textAlign});var d=1,e=this._appDef.getAppPartDefinitions();for(var f in e)if(e.hasOwnProperty(f)){var g=e[f];g.hasOwnProperty("displayName")||(g.displayName="List "+d,d++),_.isString(g.dataSelector)&&(g.dataSelectorDef={id:g.dataSelector},delete g.dataSelector)}},addTag:function(a){var b=this._tagsRepo.createAndRegister(a);return this._tagsMapping&&this._tagsMapping.setValue(this._tagsRepo.toObject()),b}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.BlinkyFormContainer",function(a,b){a.utilize(b.merge(["wixapps.core.apprepo.FormsRepository","wixapps.core.apprepo.MiniPartsRepository"])),a.fields({_formsRepository:null,_miniPartsRepository:null}),a.methods({initialize:b.before(function(){this._formsRepository=new this.imports.FormsRepository(this),this._miniPartsRepository=new this.imports.MiniPartsRepository(this)}),toObject:function(){var a=new this.imports.ApplicationDefinition;a.setDataProviders(this._dataProvidersRepo.toObject()),a.setDataSelectors(this._dataSelectorsRepo.toArray()),a.setAppPartDefinitions(this._partsRepo.toObject());var b=this.getDataProviders().getWixDbDataProvider();return a.setTypes(b.getManagedTypes()),a.setTags(this._tagsRepo.toObject()),a.setViewDefinitions(this._viewsDefRepo.toArray()),a.setPages(this._pagesRepo.toObject()),a.setForms(this._formsRepository.toObject()),a.setForms(this._miniPartsRepository.toObject()),a.setAppInstanceVersion(this.getAppInstanceVersion()),a.toObject()},_loadAppData:function(){this._dataProvidersRepo.fromObject(this._appDef.getDataProviders()),this._dataProvidersRepo.isWixDbDataProviderDefined()||this._dataProvidersRepo.createWixDbDataProvider(),this._dataSelectorsRepo.fromArray(this._appDef.getDataSelectors()),this._partsRepo.fromObject(this._appDef.getAppPartDefinitions()),this._tagsRepo.fromObject(this._appDef.getTags()),this._formsRepository.fromObject(this._appDef.getForms()),this._miniPartsRepository.fromObject(this._appDef.getMiniParts()),this.loadViews(this._appDef.getViewDefinitions()),this._pagesRepo.fromObject(this._appDef.getPages()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},getFormDefinitions:function(){return this._formsRepository},getMiniPartDefinitions:function(){return this._miniPartsRepository}})}),define.experiment.Class("wixapps.core.apprepo.ApplicationInstance2.ServerPagination",function(a){a.methods({_loadAppData:function(){this._dataProvidersRepo.fromObject(this._appDef.getDataProviders()),this._dataProvidersRepo.isWixDbDataProviderDefined()||this._dataProvidersRepo.createWixDbDataProvider();var a=this._appDef.getDataSelectors(),b=this._appDef.getAppPartDefinitions(),c=this._appDef.getViewDefinitions();this._migratePaginationfromViewsToSelectors(a,b,c),this._dataSelectorsRepo.fromArray(a),this._partsRepo.fromObject(b),this.loadViews(c),this._pagesRepo.fromObject(this._appDef.getPages()),this.setAppInstanceVersion(this._appDef.getAppInstanceVersion())},_migratePaginationfromViewsToSelectors:function(a,b,c){var d=function(a){return"comp.hidePagination"===a.key||"comp.itemsPerPage"===a.key};_.forEach(c,function(c){var e,f,g,h;if(c.comp.items&&c.comp.items.length>0&&"paginatedlist"===c.comp.items[0].id){if(f=c.comp.items[0].comp,void 0===f.hidePagination)return!1;g=_.find(b,{viewName:c.name}),h=_.find(a,{id:g.dataSelector}),"false"===f.hidePagination&&f.itemsPerPage&&(h.limit=parseInt(f.itemsPerPage,10)),delete f.hidePagination,delete f.itemsPerPage,e=_.filter(c.customizations,d),_.pull(c.customizations,e[0],e[1])}})}})}),define.experiment.Class("wixapps.core.apprepo.DataSelectorsRepository.AppBuilderDeleteType.New",function(a){a.methods({getByType:function(a){return this._byType[a]||[]},filterByType:function(a){return this.filter(function(b){return b.getSelectionType()===a})}})}),define.experiment.newClass("wixapps.core.apprepo.TagDefinition.AppBuilderTags",function(a){a.inherits("wixapps.core.apprepo.base.AppRepoItem"),a.fields({_displayName:null}),a.methods({initialize:function(a,b){this._appInstance=a,this.setDisplayName(b)},getDefinition:function(){return this._displayName},setDisplayName:function(a){this._displayName=a},getDisplayName:function(){return this._displayName}})}),define.experiment.newClass("wixapps.core.apprepo.TagsRepository.AppBuilderTags",function(a){a.inherits("wixapps.core.apprepo.base.BaseRepository"),a.utilize(["wixapps.core.apprepo.TagDefinition"]),a.methods({_getInstanceClass:function(){return this.imports.TagDefinition},createAndRegister:function(a){var b=new this.imports.TagDefinition(this._appInstance,a);return this.registerWithGuid(b)}})}),define.experiment.Class("wixapps.core.data.providers.ItemBasedDataProvider.ServerPagination",function(a){a.methods({readItems:function(){throw"not implemented"},query:function(){throw"not implemented"}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider.AppBuilderTags",function(a){a.methods({_matchSingleValue:function(a,b){if("object"==typeof a){if(a.hasOwnProperty("$in"))return a.$in.contains(b);if(a.hasOwnProperty("$ne"))return b!=a.$ne;if(a.hasOwnProperty("$gt"))return b>a.$gt;if(a.hasOwnProperty("$gte"))return b>=a.$gte;if(a.hasOwnProperty("$lt"))return b<a.$lt;if(a.hasOwnProperty("$lte"))return b<=a.$lte;if(a.hasOwnProperty("$size"))return a.$size==b.length;if(_.isArray(a)){var c=this;return _.any(a,function(a){return c._matchIgnoreType(a,b)})}return this._matchIgnoreType(a,b)}return b==a}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbBaseDataProvider.ServerPagination",function(a){a.methods({readItems:function(a,b,c,d){for(var e={},f=0;f<b.length;f++)e[b[f]]=f;for(var g=function(a,b){return e[a.getChildValue("_iid")]-e[b.getChildValue("_iid")]},h=[],i=0,j=[],k=0;k<b.length;k++){var l=this._localStore.get(b[k]);l?(i++,j.push(l)):h.push(b[k])}var m=function(a,b){j.append(a),j.sort(g),c(j,b)};h.length>0?this.query(a,{_iid:{$in:h}},{},0,-1,!1,m,d):m([])},query:function(a,b,c,d,e,f,g,h){this._willThrowIfTypeDoesNotExist(a);var i=JSON.stringify({typeName:a,filter:b,sort:c,skip:d,limit:e}),j=function(d){var e=[];this._queryStore[i]=1;var f=d.totalCount||-1;d.items.forEach(function(a){a=this._translateLoadedItem(a);var b=a._iid;if(!this._localStore.isItemMarkedAsDeleted(b)){var c=this._localStore.get(b);if(!c||!c.isDirty()){var d=this._localStore.put(b,a);d.resetDirtyFlag(),e.push(d)}}}.bind(this));var h=!1;this._localStore.each(function(c){this._isItemModified(c)&&this._match(a,b,c.getValue(0))&&(h=!0,e.push(c))}.bind(this)),h&&this._sortQueryResults(e,c),g(e,f)}.bind(this);if(this._api.isTempStore()||this._queryStore[i]){var k=this.queryLocalStore(a,b,c,d,e);return g(k),void 0}this._rewriteAndQuery(a,b,c,d,e,f,j,h)},_rewriteAndQuery:function(a,b,c,d,e,f,g,h){this._api.query(a,b,c,d,e,f,g,h)}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbDraftDataProvider.ServerPagination",function(a){a.methods({_rewriteAndQuery:function(a,b,c,d,e,f,g,h){this._newTypes.contains(a)?g({items:[]}):this._api.query(a,b,c,d,e,f,g,h)}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbTransport.AtntFixLists",function(a){a.methods({_getServiceUrl:function(a,b){if(b&&this.resources.W.Config.env.$isPublicViewerFrame)return this._getFallbackServiceUrl(a);var c=window.location.origin||this._extractBasePath(window.location.href),d=this.operationEndPoints[a]||this._savedOrPublished();return c+"/apps/appBuilder/1/"+d+"/"},_getFallbackServiceUrl:function(a){var b=this._extractFallbackBasePath(window.location.href),c=this.operationEndPoints[a]||this._savedOrPublished();return b+"/_api/appBuilder/1/"+c+"/"}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbTransport.ListsNewServerBaseUrl",function(a){a.methods({_getServiceUrl:function(a){var b=window.location.origin||this._extractBasePath(window.location.href),c=this.operationEndPoints[a]||this._savedOrPublished();return b+"/apps/appBuilder/api/1/"+c+"/"}})}),define.experiment.Class("wixapps.core.data.providers.wixdb.WixDbTransport.ServerPagination",function(a){a.methods({query:function(a,b,c,d,e,f,g,h){var i=this.resources.W.Utils.AppsUtils.getResourceValueSync("W.Apps"),j=i&&"owner"===i.getUserRole();this.doRequest("Query",{consistentRead:j},{applicationInstanceId:this._appInstance.getInstanceId(),applicationInstanceVersion:this._appInstance.getAppInstanceVersion(),type:a,filter:b,sort:c,skip:d,getTotalCount:f,limit:-1==e?null:e},g,h)}})}),define.experiment.Class("wixapps.core.data.selectors.AllItemsOfTypeDataSelector.ServerPagination",function(a){a.methods({getData:function(a){var b=this._virtualArray;this._dataProvider.query(this._forType,{},{title:1},0,-1,!1,function(c){b.setChildren(c),a(b)})}})}),define.experiment.Class("wixapps.core.data.selectors.ListDataSelector.AppBuilderTags",function(a){a.methods({updateList:function(){}})}),define.experiment.Class("wixapps.core.data.selectors.ListDataSelector.ServerPagination",function(a){a.fields({_skip:0,_limit:-1}),a.methods({setSelectedItemByIndex:function(a,b){if(-1===a)return this.resetSelectedItem(),void 0;if(a>=this.getTotalCount()||-1>a)throw"Can't set selected item at "+a+" index in dataSelector id "+this.getId();if(this._selectedItemIndex=a,this.paginationEnabled()){var c=this;this.setPageByItemIndex(this._selectedItemIndex,function(d){var e=a-c.getCurrentPageIndex()*c._limit,f=d.getChildByIndex(e);c.setSelectedItem(f),b&&b(f)})}else{var d=this._virtualArray.getChildByIndex(a);this.setSelectedItem(d),b&&b(d)}},initialize:function(a,b){this.parent(a,b),this._limit=b.limit||-1,this._virtualSelectedItem=this._dataItemFactory.createVirtualArray([])},resetSelectedItem:function(){this._virtualSelectedItem&&(this._selectedItemIndex=-1,this._virtualSelectedItem.setChildren([]))},_refresh:function(a,b){a||(a=function(){}),b||(b=function(){});var c=this,d=function(b){for(var d=b.getChildren().length,e=!1,f=0;d>f;f++)if(b.getChildByIndex(f)===c.getSelectedItem()){e=!0;break}e||c.setSelectedItemByIndex(0),a(b)};this.getData(d,b)},setSelectedItem:function(a){this._virtualSelectedItem=this._virtualSelectedItem||this._dataItemFactory.createVirtualArray([]),this._virtualSelectedItem.setChildren([a])},getSelectedItem:function(){return this._virtualSelectedItem&&this._virtualSelectedItem.getRealChildren()[0]},setLimit:function(a){this._limit=a,this.fireEvent("limitChanged",{limit:this._limit,numOfPages:this.getNumofPages()}),this.paginationEnabled()?this.firstPage():this._refresh()},getLimit:function(){return this._limit},getSelectedItemIndex:function(){var a;return this._virtualSelectedItem&&this._virtualSelectedItem.getChildByIndex(0)?(a=this._virtualSelectedItem.getChildByIndex(0).getChildValue("_iid"),this.getItemIdIndex(a)):-1},paginationEnabled:function(){return-1!==this._limit},getTotalCount:function(){return this._virtualArray.getChildrenCount()},getNumofPages:function(){return-1===this._limit||this.getTotalCount()<=this._limit?1:Math.ceil(this.getTotalCount()/this._limit)},_setSkip:function(a,b,c){if(!this.paginationEnabled())throw"pagination is not enabled";var d=this._skip;this._skip=a;var e=this,f=function(a){e.fireEvent("pageChanged",e.getCurrentPage()),b&&b(a)},g=function(a){this._skip=d,c&&c(a)};this._refresh(f,g)},getCurrentPage:function(){return this.getCurrentPageIndex()+1},getCurrentPageIndex:function(){return Math.ceil(this._skip/this._limit)},gotoNextPage:function(){return this.getCurrentPage()>=this.getNumofPages()?this.firstPage():(this._setSkip(this._skip+this._limit),void 0)},gotoPreviousPage:function(){return this._skip<this._limit?this._setPage(this.getNumofPages()):(this._setSkip(this._skip-this._limit),void 0)},setPageByItemIndex:function(a,b,c){this.paginationEnabled()||c&&c("pagination is not enabled");var d=Math.floor(a/this._limit);d!=this.getCurrentPageIndex()?this._setSkip(d*this._limit,b,c):b&&b(this._virtualArray)},_setPage:function(a){if(0>=a||a>this.getNumofPages())throw"page index is out of bounds.  Index: "+a+"number of pages: "+this.getNumofPages();return this._setSkip(this._limit*a-this._limit)},firstPage:function(){this._setSkip(0)},getDefinition:function(){return _.merge(this.parent(),{limit:this._limit})},getAllData:function(a,b){var c=this._skip,d=this._limit;this._skip=0,this._limit=-1,this.getData(a,b),this._skip=c,this._limit=d}})}),define.experiment.Class("wixapps.core.data.selectors.ManualSelectedListDataSelector.AppBuilderTags",function(a){a.methods({getDefinition:function(){var a=this.parent();return a.itemIds=this._itemIds,a},getItems:function(a,b){this._dataProvider.readItems(this.getSelectionType(),this._getItemIdsForQuery(),function(b){b.length!==this._getItemIdsForQuery().length&&(this.resources.W.Config.env.$isEditorViewerFrame&&this._logger.reportError(this._logger.Errors.DATA_SELECTOR_MISSING_ITEMS,this.$className,"getItems",this._logger.SubCategory.APP_BUILDER),this._itemIds=_.map(b,function(a){return a.getChildValue("_iid")})),this._virtualArray=this._virtualArray||this._dataItemFactory.createVirtualArray(),this._virtualArray.setChildren(b),this._fireSelectorRefreshed(),a(this._virtualArray)}.bind(this),b)}})}),define.experiment.Class("wixapps.core.data.selectors.ManualSelectedListDataSelector.ServerPagination",function(a){a.fields({_currentItemIds:null}),a.methods({getTotalCount:function(){return this._itemIds.length},_getItemIdsForQuery:function(){return this.paginationEnabled()?_.clone(this._itemIds).splice(this._skip,this._limit):this._itemIds},getAllData:function(a,b){this._dataProvider.readItems(this.getSelectionType(),this._itemIds,function(b){var c=this._dataItemFactory.createVirtualArray();c.setChildren(b),a(c)}.bind(this),b)}})}),define.experiment.Class("wixapps.core.data.selectors.TagsFilteredItemsDataSelector.ServerPagination",function(a){a.methods({getData:function(a,b){var c=this._tagIds.length?{_tags:this._tagIds.length>1?{$in:this._tagIds}:_.first(this._tagIds)}:{},d=this,e=function(b){function c(){d.fireEvent("dataSelectorRefreshed")}d._virtualArray=d._virtualArray||d._dataItemFactory.createVirtualArray(),d._virtualArray.addEvent(Constants.DataItemEvents.CHANGE,c),d._virtualArray.setChildren(b),d._virtualArray.removeEvent(Constants.DataItemEvents.CHANGE,c),a(d._virtualArray)};this._dataProvider.query(this._forType,c,this.getQuerySortParameter(),0,-1,!1,e,b)}})}),define.experiment.Class("wixapps.core.data.selectors.base.BaseDataSelector.AppBuilderTags",function(a){a.methods({setPredefinedSettings:function(){throw"Not Implemented"},hasPredefinedSettings:function(){return!1}})}),define.experiment.Class("wixapps.core.dataservice.DataServiceTransportBase.AtntFixLists",function(a,b){a.resources(b.merge(["W.Config"])),a.fields({_fallbackServiceUrl:null}),a.methods({initialize:function(a,b){this._userProperties=a,this._accessToken=b;var c=window.location.origin||this._extractBasePath(window.location.href);this._serviceUrl=c+"/apps/lists/1/";var d=this._extractFallbackBasePath();this._fallbackServiceUrl=this.resources.W.Config.env.$isPublicViewerFrame?d+"/_api/lists/1/":this._serviceUrl},_extractFallbackBasePath:function(){var a=document.createElement("a");return a.href=window.location.href,"https://fallback.wix.com"},doRequest:function(a,b,c,d,e){var f=!1;e||(e=function(a){throw a.description+" ("+a.code+")"});var g=function(a){var b=this.getLogger();b.reportError(a,this.$className,"doRequest",b.SubCategory.DATA_SERVICE)}.bind(this),h=function(a){if(clearTimeout(k),!f)if(f=!0,a.success)d(a.payload);else{var b={code:a.errorCode,description:a.errorDescription};g(b),e(b)}}.bind(this),i=function(a){clearTimeout(k);var b={code:a.status?a.status:-1,description:a.statusText?a.statusText:"Unspecified error occurred, possibly a connection problem"};g(b),l&&j()}.bind(this),j=function(){l=!1;var d=function(a){if(!f){var b={code:a.status?a.status:-1,description:a.statusText?a.statusText:"Error in Fallback Request for AT&T Fix"};g(b),e(b)}}.bind(this),i=this.resources.W.Utils.AppsUtils.urlBuilder(this._fallbackServiceUrl);this._postJsonRequest(a,b,c,h,d,i)}.bind(this),k=setTimeout(function(){l&&!f&&j()}.bind(this),5e3),l=!0,m=this.resources.W.Utils.AppsUtils.urlBuilder(this._serviceUrl);this._postJsonRequest(a,b,c,h,i,m)},_postJsonRequest:function(a,b,c,d,e,f){f.combinePath(a),f.addParams(b);var g,h={url:f.toString(),urlEncoded:!1,onSuccess:d,onFailure:e};return g=new this.resources.W.Utils.AppsUtils.JSONNative(h),g.options=g.options||{},g.options.headers=g.options.headers||{},g.options.headers["If-Modified-Since"]="Sat, 1 Jan 2005 00:00:00 GMT",g.options.headers["Content-Type"]="application/json; charset=utf-8",g.options.headers["x-wix-user-properties"]=this._userProperties,g.options.headers["x-wix-access-token"]=this._accessToken,g.post(JSON.stringify(c))}})}),define.experiment.Class("wixapps.core.dataservice.DataServiceTransportBase.ListsNewServerBaseUrl",function(a){a.methods({initialize:function(a,b){this._userProperties=a,this._accessToken=b;var c=window.location.origin||this._extractBasePath(window.location.href);this._serviceUrl=c+"/apps/lists/api/1/"}})}),define.experiment.Class("wixapps.core.logics.page.ItemFromPageLogic.BlogManager",function(a,b){a.traits(["wixapps.core.logics.BlogManagerTrait"]),a.resources(b.merge(["W.Viewer"])),a.fields({previewPageId:null}),a.methods({initialize:b.after(function(){this.prefetchPreviewPageId()}),_onDataLoaded:function(a){var b=this._params.acceptableTypes;if(b&&b.length>0&&!b.contains(a.getTypeName()))throw"Part expected ["+b+" ] but received "+a.getTypeName();var c=this._getParamsFromURL();if("MediaPost"===a.getTypeName()&&c.unpublished){var d=a.getChildByRef("unpublishedChanges");a.replaceChild(d.getChildByRef("title"),"title"),a.replaceChild(d.getChildByRef("mediaText"),"mediaText"),a.replaceChild(d.getChildByRef("tags"),"tags"),a.replaceChild(d.getChildByRef("date"),"date")}this.parent(a),this._dataItem=a}})}),define.experiment.Class("wixapps.core.logics.page.ListFromPageLogic.BlogManager",function(a,b){a.traits(["wixapps.core.logics.BlogManagerTrait"]),a.resources(b.merge(["W.Viewer"])),a.fields({previewPageId:null}),a.methods({initialize:b.after(function(){this.prefetchPreviewPageId()})})}),define.experiment.Class("wixapps.core.logics.page.SingleItemPageLogic.BlogManager",function(a,b){a.traits(["wixapps.core.logics.BlogManagerTrait"]),a.resources(b.merge(["W.Viewer"])),a.fields({previewPageId:null}),a.methods({initialize:b.after(function(){this.prefetchPreviewPageId()}),fetchDataItem:function(a,b,c){var d=this._environment.getDataService(),e=a.collectionId,f=a.itemId,g=function(a){if(!a||0===a.length)return c({code:-10004,description:"No items were found"}),void 0;var d=a[0],e=this._environment.options.acceptableTypes;!e||e.length>0||e.contains(d.getTypeName())?b(d):c({code:-10003,description:"Page expected ["+e+" ] but received "+d.getTypeName()})}.bind(this),h=function(a){c(a)}.bind(this);if(!f||!e)return c({code:-1,description:"Item id or collection id not defined"}),void 0;var i=d.readItemFromCache(e,f);if(i)b(i);else{var j={_iid:f},k=this._environment.options.filter;k&&!a.preview&&(j=_.merge(j,k)),this._environment.getDataService().query(e,j,{},0,1,!1,g,h)}},paramsFromUri:function(a){var b=a.split("/"),c={};return c.itemId=b[0],"Preview"===b[1]&&(c.preview=!0),c}})}),define.experiment.component("wixapps.core.utils.ListCursor.AppBuilderTagsEditor",function(a){a.methods({setSelectedIndex:function(a,b){var c=this._currentItemIndex;if(a!==this._currentItemIndex){var d=this._getItemsLength();this._currentItemIndex=0===d?-1:a>=d?0:0>a?d-1:a}b||this.fireChangeEvent(this._currentItemIndex,c)}})}),define.experiment.Class("wixapps.core.utils.WixServiceTransportBase.AtntFixLists",function(a,b){a.resources(b.merge(["W.Config"])),a.methods({_getServiceUrl:function(){},_doRequestInternal:function(a,b,c,d,e,f){var g,h=!1;f||(f=function(a){throw a.description+" ("+a.code+")"}),e||(e=function(){}),d||(d="POST");var i=function(a){var b=this.getLogger();b.reportError(a,this.$className,"doRequest",b.SubCategory.DATA_SERVICE)}.bind(this),j=function(a){if(clearTimeout(g),!h)if(h=!0,a.success)e(a.payload);else{var b={code:a.errorCode,description:a.errorDescription};i(b),f(b)}}.bind(this),k=function(a){clearTimeout(g);var b={code:a.status?a.status:-1,description:a.statusText?a.statusText:"Unspecified error occurred, possibly a connection problem"};i(b),m&&l()}.bind(this),l=function(){m=!1;var e=function(a){if(!h){var b={code:a.status?a.status:-1,description:a.statusText?a.statusText:"Unspecified error occurred, possibly a connection problem"};i(b),f(b)}}.bind(this),g=this._getServiceUrl(a,!0),k=this._buildPostJsonUrl(a,b,g);this._postJsonRequest(k,c,d,j,e)}.bind(this);g=setTimeout(function(){m&&l()}.bind(this),5e3);var m=!0,n=this._buildPostJsonUrl(a,b,this._getServiceUrl(a));this._postJsonRequest(n,c,d,j,k)},_extractFallbackBasePath:function(){var a=document.createElement("a");return a.href=window.location.href,"https://fallback.wix.com"},_buildPostJsonUrl:function(a,b,c){var d=this.resources.W.Utils.AppsUtils.urlBuilder(c);return d.combinePath(a),d.addParams(b),d.toString()},_postJsonRequest:function(a,b,c,d,e){var f,g={url:a,urlEncoded:!1,onSuccess:d,onFailure:e,method:c,data:b?JSON.stringify(b):""};f=new this.resources.W.Utils.AppsUtils.JSONNative(g),f.options=f.options||{},f.options.headers=f.options.headers||{},f.options.headers["If-Modified-Since"]="Sat, 1 Jan 2005 00:00:00 GMT",f.options.headers["Content-Type"]="application/json; charset=utf-8",f.options.headers.Accept="application/json",f.send()}})}),define.experiment.Class("wixapps.core.views.ViewBuilder.AppBuilderTagsEditor",function(a){a.methods({_getPaginatedListTemplate:function(){return"PaginatedListTemplate3"}})}),define.experiment.Class("wixapps.core.views.ViewBuilder.BlinkyFormContainer",function(a){a.methods({initialize:function(){if(this._typesManager=new this.imports.TypesManager,this._localizer=new this.imports.AppBuilderLocalizer,this._utils=this.resources.W.Utils.AppsUtils,!Constants)throw"ViewBuilder:: where is Constants?";Constants.AppBuilderViewTemplates&&this.registerTemplates(Constants.AppBuilderViewTemplates),Constants.AppBuilderTemplates&&this.registerBundles(),Constants.FormFieldsTemplates&&this.registerTemplates(Constants.FormFieldsTemplates),Constants.FormTemplates&&this.registerFormBundles(),this._buildTypesTemplateMap()},registerTemplates:function(a){this._registerTypes(a.types),this._registerData(a.data),this._registerViews(a.views),this._registerTemplates(a.templates),this._registerFieldTemplates(a.fieldTemplates)},registerFormBundles:function(){var a=this;_.forOwn(Constants.FormTemplates,function(b){a._registerTypes([b.type]),a._registerTemplates([b.template])})},getFormTemplateDefinition:function(a){var b=this._getTemplateDef(a),c={id:b.id,friendlyName:this._localizer.localize("FORM_TEMPLATE_BUNDLE_NAME_"+b.id,b.id),description:this._localizer.localize("FORM_TEMPLATE_BUNDLE_DESC_"+b.id,b.id),defaultWidth:b.defaultWidth,defaultHeight:b.defaultHeight,type:null};return c.type=this._getTypeDef(b.type),c.type.name=c.type.name+this._delimiter+this._utils.getTimeBasedUniqueId(),c.type.displayName=this._localizer.localize("TEMPLATE_BUNDLE_TYPE_NAME_2_"+b.id,b.id),c
}})}),define.experiment.Class("wixapps.core.views.ViewBuilder.ServerPagination",function(a){a.methods({_getPaginatedListTemplate:function(){return"PaginatedListTemplate2"}})}),define.experiment.Class("wixapps.core.views.ViewBuilder.ShowHideFieldEditor",function(a){a.methods({getViewFieldsMapping:function(a){var b,c,d,e,f,g=[],h=function(a){return"object"===this._utils.getType(a)&&a.hasOwnProperty("comp")&&a.comp.hasOwnProperty("name")&&("Field"===a.comp.name||"TextField"===a.comp.name)}.bind(this),i=this._findCompByNames(a,"FieldBox");for(b=0;b<i.length;b++){d=i[b];var j=d.id;if(d.comp&&d.comp.editorData&&d.comp.editorData.displayName){var k=d.comp.editorData.displayName;this._localizer.isValidKey(k)&&(k=this._localizer.localize(this._localizer.getKeyValue(k),j)),j=k}if(g.push({containerId:d.id,containerName:j,containerFields:[],hasFields:!1,orientation:d.comp.orientation}),d.comp.items){for(c=0;c<d.comp.items.length;c++)e=d.comp.items[c],h(e)&&(this.isFieldHidden(a,e.id)||(f=e.comp.items[0],g[b].containerFields.push({id:e.id,data:e.data,compName:f.comp.name,fieldType:e.comp.name,containerId:d.id,containerName:j})));g[b].containerFields.length>0&&(g[b].hasFields=!0)}}return g},changeFieldVisibility:function(a,b,c){this._markModified(a);var d=this._findCompByNames(a,"FieldBox"),e=_(d).map(function(a){return a.comp.items}).flatten().compact().find({data:b});e&&(e.comp.hidden=!c)}})}),define.experiment.component("wixapps.integration.components.AppPart.AppBuilderDeleteType.New",function(a){a.fields({isAppPart:!0})}),define.experiment.component("wixapps.integration.components.AppPart.BoxSlideShow",function(a){a.methods({canBeDraggedIntoBoxSlideShow:function(){return!1}})}),define.experiment.component("wixapps.integration.components.AppPart.WixAppsGalleries",function(a,b){var c=a,d=b;c.resources(d.merge(["W.ComponentLifecycle"])),c.methods({_onResize:d.after(function(){this.resources.W.ComponentLifecycle.forceRender()}),applyCustomizationRule:function(a,b){var c=this.setCustomizationRule(a,!0);if(c!==!1){this._ignoreUpdate=!b;var d=c&&c.length>0?c[0]:void 0,e=this.getCustomizationDefaultValue(a.forType,a.view,a.format||"",a.fieldId,a.key),f=d?!this.injects().Utils.areObjectsEqual(a,d):e!=a.value;f&&this.injects().Commands.executeCommand("WViewerCommands.AppDataChange",[a,d,this]),this._data.fireDataChangeEvent("appLogicCustomizations",a,d,this,!0),this._ignoreUpdate=!1,this._applyCustomizationRulesToDefinitions(),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE),this._eventDispatcher.fireEvent(Constants.WixAppEvents.APP_PART_RESIZE),window.requestAnimFrame(function(){this.fireEvent("autoSized")}.bind(this))}},_onDataChange:function(a,b){return this._ignoreUpdate?void 0:"AppPartProperties"===a.getType()?(this._skinParts.inlineContent.setStyle("direction",a.get("direction")),this._mainProxy&&this._mainProxy.getViewContext().getEnvironment().setVar("partDirection",a.get("direction")),void 0):(this._appInstance&&"appLogicCustomizations"!==b&&this._runLogic(),void 0)}})}),define.experiment.component("wixapps.integration.components.AppPart2.AppBuilderDeleteType.New",function(a){a.fields({isAppPart2:!0})}),define.experiment.component("wixapps.integration.components.AppPart2.AppBuilderTags",function(a,b){a.utilize(b.merge(["wixapps.integration.managers.AppBuilderLocalizer"])),a.binds(b.merge(["_userTagChanged","_onDataSelectorRefreshed"])),a.methods({initialize:b.after(function(){this._localizer=new this.imports.AppBuilderLocalizer}),setDataSelector:function(a){if(this._dataSelector){var b=this._appInstance.getDataSelectors(),c=this._dataSelector.getId();b.remove(c),b.registerWithId(c,a),this._dataSelector.getLogicalTypeName()!==a.getLogicalTypeName()&&this._appPartDefinition.clearDataSelectorPredefinedSettings(),this._dataSelector.removeEvent("dataSelectorRefreshed",this._onDataSelectorRefreshed)}this._dataSelector=a,this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this});var d=function(b){var c=this._appInstance.getViewDefinitions();this._verifyRequiredViewDefinitions(c,this._forType,this._viewName,this._formatName),this._retrieveData(b),this.fireEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,a),this._dataSelector.addEvent("dataSelectorRefreshed",this._onDataSelectorRefreshed)}.bind(this);this._dataSelector.getData(d,this._onError)},_createVars:function(){var a,b=!1,c=[{value:"",text:""}],d="",e=this.getAppPartDefinition().getDataSelectorDef();if(e&&(a=e.predefinedSettings),a){var f=this._appInstance.getTagsMapping().getValue();c=[{value:"all",text:this._localize("FILTER_DIALOG_All_Tags","All")}];for(var g=0;g<a.tags.length;g++)c.push({value:a.tags[g],text:f[a.tags[g]]});d=this._dataSelector.getTags().length>1?"all":_.first(this._dataSelector.getTags()),b=!0}return{userTags:{enabled:b,items:c,selectedValue:d}}},_setUserTagSelectedValue:function(a){var b=this.getEventDispatcher();b.removeEvent("onTagChanged",this._userTagChanged);var c=this.getUserTags().getChildByRef("selectedValue");c.setValue(a),b.addEvent("onTagChanged",this._userTagChanged)},getUserTags:function(){return this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("userTags")},_userTagChanged:function(a){var b=this,c=a.sender.getData().getChildValue("selectedValue"),d=function(){b._viewHolder.performActionWhenReady(function(){b.setState("content")}),b.reRenderView(),b._setUserTagSelectedValue(c)};b.setState("loading"),W.Config.env.$isPublicViewerFrame&&b._logger.reportEvent(b.imports.WixAppsLogger.Events.TAG_SELECTED_IN_VIEWER),this._dataSelector.setPredefinedSettings({tags:this.getAppPartDefinition().getDataSelectorDef().predefinedSettings.tags,selectedTag:c},d,d)},_onDataSelectorRefreshed:function(){if("IB.TagsFilteredList"===this._dataSelector.getLogicalTypeName()){var a=this._dataSelector.getTags().length>1?"all":_.first(this._dataSelector.getTags());this._setUserTagSelectedValue(a)}},_bindPresenterEvents:function(){var a=this.getEventDispatcher();a.addEvent("onTagChanged",this._userTagChanged)},_setupViewHolder:function(a){this._viewHolder.setupViewHolder(a,this._viewName,this._formatName,this._createVars()),this._bindPresenterEvents()},_initApp:function(){try{var a=this._appInstance.getAppPartDefinitions(),b=this._appInstance.getDataSelectors(),c=this._data.get("appPartName");if(!a.exists(c))return this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_PART_DEFINITION,{c1:c}),this._itsDeadJim(),void 0;this._appPartDefinition=a.getById(c);var d=this._appPartDefinition.getDataSelectorId();if(!b.exists(d))return this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_DATA_SELECTOR,{c1:d}),this._itsDeadJim(),void 0;this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this._forType=this._appPartDefinition.getType(),this._viewName=this._appPartDefinition.getViewName(),this._formatName=this._isMobile()?"Mobile":"";var e=b.getById(d);this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this}),this.setDataSelector(e),this._appPartDefinition.setUsed(!0)}catch(f){this._logger.reportEvent(this.imports.WixAppsLogger.Events.APP_PART2_FAILED_TO_LOAD_DATA_SELECTOR,{c1:d}),this._itsDeadJim(f)}},_localize:function(a,b){return this._localizer.localize(a,b)},dispose:b.before(function(){this._dataSelector.removeEvent("dataSelectorRefreshed",this._onDataSelectorRefreshed)})})}),define.experiment.component("wixapps.integration.components.AppPart2.AppBuilderTagsEditor",function(a){a.methods({setDataSelectorPredefinedSettings:function(a){this._appPartDefinition.setDataSelectorPredefinedSettings(a),this.fireEvent(Constants.WixAppEvents.DATA_SELECTOR_PREDEFINED_SETTINGS_CHANGED,a)}})}),define.experiment.component("wixapps.integration.components.AppPart2.AppBuilderTagsRevert",function(a,b){a.utilize(b.merge(["wixapps.integration.managers.AppBuilderLocalizer"])),a.binds(b.merge(["_userTagChanged","_onDataSelectorRefreshed"])),a.methods({convertTagsSelectorToManual:function(a){var b=this._appInstance.getDataSelectors(),c=this._dataSelector._dataProvider,d=this._dataSelector.getSelectionType(),e=b.createInstance("IB.ManualSelectedList",c,d,{itemIds:_.pluck(a,"_iid")});this.setDataSelector(e)},setDataSelector:function(a){if(this._dataSelector){var b=this._appInstance.getDataSelectors(),c=this._dataSelector.getId();b.remove(c),b.registerWithId(c,a),this._appPartDefinition.clearDataSelectorPredefinedSettings&&this._dataSelector.getLogicalTypeName()!==a.getLogicalTypeName()&&this._appPartDefinition.clearDataSelectorPredefinedSettings(),this._dataSelector.removeEvent("dataSelectorRefreshed",this._onDataSelectorRefreshed)}this._dataSelector=a,this.resources.W.Commands.executeCommand("ApplicationPerformanceSpy.logPhase2",{step:"requesting items from server",appPart:this});var d=function(b){var c=this._appInstance.getViewDefinitions();this._verifyRequiredViewDefinitions(c,this._forType,this._viewName,this._formatName),"IB.TagsFilteredList"===this._dataSelector.getLogicalTypeName()&&this.convertTagsSelectorToManual(b.getValue()),this._retrieveData(b),this.fireEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,a),this._dataSelector.addEvent("dataSelectorRefreshed",this._onDataSelectorRefreshed)}.bind(this);this._dataSelector.getData(d,this._onError)}})}),define.experiment.component("wixapps.integration.components.AppPart2.BoxSlideShow",function(a){a.methods({canBeDraggedIntoBoxSlideShow:function(){return!1}})}),define.experiment.component("wixapps.integration.components.AppPart2.ServerPagination",function(a,b){a.binds(b.merge(["_viewNextPage","_viewPreviousPage","_viewSetPageByItemIndex","_createPaginationVars","setLimit","_pageChanged","_limitChanged"])),a.methods({_initApp:b.before(function(){this._viewHolder.getEventDispatcher().addEvent("nextPage",this._viewNextPage),this._viewHolder.getEventDispatcher().addEvent("previousPage",this._viewPreviousPage),this._viewHolder.getEventDispatcher().addEvent("setPageByItemIndex",this._viewSetPageByItemIndex)}),_addDataSelectorEvents:function(){this._dataSelector.addEvent("pageChanged",this._pageChanged),this._dataSelector.addEvent("limitChanged",this._limitChanged)},_removeDataSelectorEvents:function(){this._dataSelector.removeEvent("pageChanged",this._pageChanged),this._dataSelector.removeEvent("limitChanged",this._limitChanged)},setLimit:function(a){this._dataSelector.setLimit(a)},getLimit:function(){return this._dataSelector.getLimit()},paginationEnabled:function(){return this._dataSelector.paginationEnabled()},_pageChanged:function(a){this._viewHolder.getRootProxy()&&this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("currentPage").setValue(a)},_limitChanged:function(a){if(this._viewHolder.getRootProxy()){var b=-1!==a.limit;this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("maxPage").setValue(a.numOfPages),this._viewHolder.getRootProxy().getViewContext().getEnvironment().getVar("hidePagination").setValue(b?"false":"true")}},_viewNextPage:function(){this._dataSelector.gotoNextPage()},_viewPreviousPage:function(){this._dataSelector.gotoPreviousPage()},_viewSetPageByItemIndex:function(a){this._dataSelector.setPageByItemIndex(a)},_setupViewHolder:function(a){this._viewHolder.setupViewHolder(a,this._viewName,this._formatName,this._createPaginationVars())},_createPaginationVars:function(){return{limit:this._dataSelector.getLimit(),maxPage:this._dataSelector.getNumofPages(),currentPage:1,hidePagination:!this._dataSelector.paginationEnabled()}},dispose:function(){this._appInstance&&(this._appInstance.getViewDefinitions()&&this._appInstance.getViewDefinitions().removeEvent(Constants.DataItemEvents.CHANGE,this._onViewDefinitionsChanged),this._appPartData&&this._appPartData.removeEvent(Constants.DataItemEvents.CHANGE,this._onAppDataChanged),this._viewHolder&&(this._viewHolder.getEventDispatcher()&&(this._viewHolder.getEventDispatcher().removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._onAppViewReady),this._viewHolder.getEventDispatcher().removeEvent(Constants.WixAppEvents.APP_CONTENT_RESIZE,this._onContentResize),this._viewHolder.getEventDispatcher().removeEvent("nextPage",this._nextPage),this._viewHolder.getEventDispatcher().removeEvent("previousPage",this._previousPage),this._viewHolder.getEventDispatcher().removeEvent("setPageByItemIndex",this._setPageByItemIndex)),this._viewHolder.dispose())),this._appPartDefinition&&this._appPartDefinition.setUsed(!1),this._viewHolder=null,this._dataSelector=null,this.parent()}})}),define.experiment.component("wixapps.integration.components.SiteButton.OBC_SiteButton.New",function(a){var b=a;b.inherits("wysiwyg.viewer.components.SiteButtonOBC")}),define.experiment.component("wixapps.integration.components.panels.EditFieldPanel.NewListFields",function(a){a.methods({_addCustomizationControl:function(a,b,c){switch(b){case"TextField":return this._addTextFieldCustomizations(a,c);case"Field":return this._addGenericFieldCustomizations(a,c);default:return this._addGenericFieldCustomizations(a,c)}},_addTextFieldCustomizations:function(a,b){var c=this;a.addInputGroupField(function(){"Date"===b&&c._addTextFieldDateFormat(this),c._addTextCustomizations(this,b)}),this._addTextFieldSizeAndSpacing(a)},_addTextFieldDateFormat:function(a){var b=[{label:"Short Date (03/12/81)",value:"mm/dd/yy"},{label:"Medium Date (Mar 12, 1981)",value:"mmm dd, yyyy"},{label:"Long Date (March 12, 1981)",value:"mmmm dd, yyyy"},{label:"Full Date (Thursday, March 12, 1981)",value:"dddd, mmmm dd, yyyy"},{label:"ISO Date (1981/12/03)",value:"yyyy-mm-dd"},{label:"Europe Short Date (12/3/81)",value:"dd/mm/yy"},{label:"Europe Short Date 2 (12.3.81)",value:"dd.mm.yy"}],c=a.addComboBoxField("Date Format",b);this._bindToCustomization(c,{key:"comp.items.0.comp.format"},"isoDate",_.identity,_.identity)}})}),define.experiment.component("wixapps.integration.components.panels.EditFieldPanel.WixAppsGalleryField",function(a,b){a.fields({_spacingPanelDefer:null}),a.methods({_recreateFieldSettings:b.before(function(){this._spacingPanelDefer=Q.defer()}),_addGenericFieldCustomizations:function(a,b){var c=this,d=!1;a.addInputGroupField(function(){switch(b){case"Image":c._addImageCustomization(this);break;case"Video":c._minWidth=200,c._minHeight=220,c._addVideoCustomization(this);break;case"Button2":c._minHeight=14,c._addButtonCustomization(this);break;case"SliderGallery":c._addSliderGalleryCustomization(this),d=!0;break;default:c._addImageCustomization(this)}}),this._addGenericSizeAndSpacing(a,d)},_addGenericSizeAndSpacing:function(a,b){var c=this;a.addInputGroupField(function(){this.addLabel(c._loc("Size")),this.addBreakLine(7,"1px solid #E5E5E5",10),c.size=c.size||{},c.size.width=c._addSlider(this,c._loc("Width"),{key:"comp.width"},c._minWidth,1200,1,void 0,b),c.size.height=c._addSlider(this,c._loc("Height"),{key:"comp.height"},c._minHeight,1200,1,void 0,b),"auto"==c._heightMode&&c.size.height.disable(),c._addBoxAlign(this,c._loc("SizeAlignmentLabel"))}),c._addSpacing(a,b)},_addSpacing:function(a,b){var c=this;a.addInputGroupField(function(){c._addCollapsiblePanel(this,c._loc("SpacingLabel"),function(){c._spacingPanelDefer.promise.done(function(a){c.spacers=c.spacers||{},c.spacers.top=c._addSlider(a,c._loc("Spacing_Top"),{key:c._isVertical?"comp.spacers.before":"comp.spacers.xax-before"},0,600,1,void 0,b),c.spacers.bottom=c._addSlider(a,c._loc("Spacing_Bottom"),{key:c._isVertical?"comp.spacers.after":"comp.spacers.xax-after"},0,600,1,void 0,b),c.spacers.left=c._addSlider(a,c._loc("Spacing_Left"),{key:c._isVertical?"comp.spacers.xax-before":"comp.spacers.before"},0,600,1,void 0,b),c.spacers.right=c._addSlider(a,c._loc("Spacing_Right"),{key:c._isVertical?"comp.spacers.xax-after":"comp.spacers.after"},0,600,1,void 0,b)}),c._spacingPanelDefer.resolve(this)})})},_addSliderGalleryCustomization:function(a){var b=this;this._addSliderGalleryImageModeCustomization(a),this.addInputGroupField(function(){b._addCollapsiblePanel(this,b._loc("SliderGalleryOther"),function(){var a={fieldId:b._getFieldProxyId(),key:"comp.maxSpeed"},c=(b._addSlider(this,b._loc("SliderGallerySpeed"),a,1,30,1,void 0,!0,b._getCurrentValue(a,8)),this.addCheckBoxField(b._loc("SliderGalleryLoop"))),d={fieldId:b._getFieldProxyId(),key:"comp.loop"};b._bindToCustomization(c,d,b._getCurrentValue(d,!0))})}),this.addInputGroupField(function(){this.setNumberOfItemsPerLine(1);var a=[{value:"disabled",label:b._loc("SliderGalleryOnClickDisabled")},{value:"zoomMode",label:b._loc("SliderGalleryOnClickZoomMode")},{value:"goToLink",label:b._loc("SliderGalleryOnClickGoToLink")}],c=this.addComboBoxField(b._loc("SliderGalleryOnClick"),a,"zoomMode");b._bindToCustomization(c,{fieldId:b._getFieldProxyId(),key:"comp.galleryImageOnClickAction"},"zoomMode")}),this._spacingPanelDefer.promise.done(function(a){var c={fieldId:b._getFieldProxyId(),key:"comp.margin"};b._addSlider(a,b._loc("SliderGallery_ImageSpacers"),c,0,250,1,void 0,!0,b._getCurrentValue(c,8))}),this._addComponentStyleSelector(a,this._getFieldProxyId())},_addSliderGalleryImageModeCustomization:function(a){var b=this,c=[{value:"clipImage",label:this._loc("SliderGalleryImageMode_Crop")},{value:"flexibleWidth",label:this._loc("SliderGalleryImageMode_FitHeight")}],d=this._loc("SliderGallery_ImageModeLabel"),e=a.addComboBoxField(d,c,void 0,void 0,"Slider_Gallery_Settings_Image_Scaling_ttid"),f="radiobuttons/aspRatio/radio_button_states.png",g={w:"46px",h:"52px"},h={options:[{value:"16:9",image:f,dimensions:g,icon:"radiobuttons/aspRatio/16-9.png"},{value:"4:3",image:f,dimensions:g,icon:"radiobuttons/aspRatio/4-3.png"},{value:"1:1",image:f,dimensions:g,icon:"radiobuttons/aspRatio/1-1.png"},{value:"3:4",image:f,dimensions:g,icon:"radiobuttons/aspRatio/3-4.png"},{value:"9:16",image:f,dimensions:g,icon:"radiobuttons/aspRatio/9-16.png"}],display:"inline",defaultValue:"",group:""},i=a.addRadioImagesField(this._loc("SliderGalleryAspectRatio"),h.options,h.defaultValue,h.group,h.display),j={fieldId:b._getFieldProxyId(),key:"comp.imageMode"};b._bindToCustomization(e,j),b._bindToCustomization(i,{fieldId:b._getFieldProxyId(),key:"comp.aspectRatioPreset"},"4:3");var k=function(a){switch(a){case"clipImage":i.uncollapse();break;case"flexibleWidth":i.collapse()}};e.addEvent("inputChanged",function(a){k(a.value)});var l=this._getCurrentValue(j,"clipImage");k(l)}})}),define.experiment.component("wixapps.integration.components.panels.ListSettingsPanel.AppBuilderTagsEditor",function(a,b){a.fields({_viewName:"ManageItems2.AppBuilderTagsEditor"}),a.binds(b.merge(["_onSelectorChanged"])),a.methods({_addListeners:b.after(function(){this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenFilterPanel",this,this.selectItems),this._appPart.addEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onSelectorChanged)}),_removeListeners:b.after(function(){this.resources.W.Commands.unregisterCommand("WAppsEditor2Commands.OpenFilterPanel"),this._appPart.removeEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onSelectorChanged)}),_onSelectorChanged:function(a){this._removeDataSelectorEvents(),this._usedDataSelector=a,this._addDataSelectorEvents(),this._loadSharedData(function(){this._updateCursor(),this._manageItemPresenter.rebuildModel(),this._dataEditPresenter.rebuildModel(!0)}.bind(this))},_onTabSelected:function(a){this._tabPanels[a.oldTab].setIsOpen(!1),this._tabPanels[a.newTab].setIsOpen(!0),this._setPanelHeader(null,this._loc(a.newTab+(this._isList()?"":"SingleItem")+"TabDescription2")),this.backToSettings()},_loadSharedData:function(a){var b=this._usedDataSelector.getSelectionType();if(this._usedDataSelector.isListSelector())this._usedDataSelector.getData(function(b){this._itemsData.setChildren(b.getRealChildren()),a&&a(this._itemsData)}.bind(this));else{this._usedDataSelector=this.resources.W.AppsEditor2.getAllItemsOfTypeDataSelector(b,this._appInstance);var c=this._itemsData;this._usedDataSelector.getData(function(b){c.setChildren(b.getChildren()),a&&a(c)})}},_getItemIndex:function(a){var b=a||this._selectionHandler.getCurrentDataItem(),c=-1;if(b){var d=b.getChildValue("_iid");c=this._usedDataSelector.getItemIdIndex(d)}return c},_updateCursor:function(a){var b=this._getItemIndex(a);return-1==b?(this._selectionHandler.setSelectedIndex(0,!0),this._updateCursor(),void 0):(this._selectionHandler.setSelectedIndex(b,!0),this._listCursor.setSelectedIndex(b,!0),void 0)},createItem:function(){var a=this;this.resources.W.Commands.executeCommand("WAppsEditor2Commands.AddNewDataItem",{comp:this._appPart,compId:this._appPart.getAppPartDefinition().getId(),onDataItemAdded:function(b){a._loadSharedData(function(){var c=a._getItemIndex(b);a._selectionHandler.setSelectedIndex(c,!0),a._listCursor.setSelectedIndex(c,!1)}),a._showFirstTimeTagBubble()},addedFrom:"PANEL_ADD_NEW_ITEM"})},_shouldntMigrateView:function(a){return a&&a.editorData&&a.editorData.isPaginated&&a.editorData.hasTags},selectItems:function(a){var b=this,c=function(a,c){var d=b._appPart.getDataSelector();if(d===a){var e=a.getDefinition();if(d.loadFromDefinition(e),a.isListSelector)throw"Cannot change to a non-list data selector";a.getData()}else{var f={appPart:b._appPart,dataSelector:a,dataSelectorPredefinedSettings:c,listSettingsPanel:b};b._migrateToPaginatedList(),c&&b.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenHelpBubble",{appPart:b._appPart,ftHelpSetName:"FT_UoU_FILTERING_ENABLED",anchorElement:b._view.getElement("[vcfield='userTags']")}),b.resources.W.Commands.executeCommand("WAppsEditor2Commands.ChangeDataSelector",f)}};W.Commands.executeCommand("WAppsEditor2Commands.DataItemSelectionRequested",{appPart:this._appPart,type:this._typeName,appInstance:this._appInstance,okCallback:c,args:a})},_onSelectorDataChange:function(a){this._itemsData.setChildren(a.vArray.getRealChildren()),this._manageItemPresenter.rebuildModel(a.vArray),this._itemsData.getChildrenCount()?(this._updateCursor(this._usedDataSelector.getSelectedItem()),this._dataEditPresenter.rebuildModel(!0)):this.backToSettings()},_addDataEditPanel:function(){this._dataPanelAdded=!0,this.resources.W.AppsGUI.addViewToPanel(this._appPart.getAppInstance(),this._dataEditPanel,"DataEdit2.AppBuilderTags",this._dataEditPresenter),this._showFirstTimeTagBubble()},_setupViews:function(){var a=this;a._setupAction.promise.then(function(){this.resources.W.Utils.callLater(function(){a.resources.W.AppsGUI.addViewToPanel(a._appPart.getAppInstance(),a._itemsTab,a._viewName,a._manageItemPresenter,["SingleItem"]),setTimeout(a._manageItemsReady.resolve,500)}),this.resources.W.Utils.callLater(function(){a._designTab.addInputGroupField(function(){a._custPanel=this,a._migrateToPaginatedList(),a._updateCustomizationPanel()}),a.resources.W.AppsGUI.addViewToPanel(a._appPart.getAppInstance(),a._designTab,"SimpleCustomizeFields",a._customizeItemsPresenter),a._designTab.addButtonField("",a._loc("EditLayout"),!1,void 0,"withArrow",0,"").runWhenReady(function(b){b.addEvent("click",a._openAdvancedDesign)});var b=a._appInstance.getAppPartDefinitions().filterByType(a._typeName);a.isPageSelector()||a._addCopyOtherListViewDesignButton(b)}),a._loading.collapse()}.bind(this)),a._createPageLinksFrame(a._settingsTab),a._createNamingFrame(a._settingsTab)},backToSettings:b.after(function(){this._showFirstTimeTagBubble()}),_showFirstTimeTagBubble:function(){var a=this._view.getElement("[vcview='"+this._viewName+"']");a&&!this._usedDataSelector.isSorted()&&a.isVisible()&&this._itemsData.getChildrenCount()>=5&&this.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenHelpBubble",{appPart:this._appPart,ftHelpSetName:"FT_START_USING_TAGS",anchorElement:a.getElement("[vcfield='items']").children[0]})},_listCursorChanged:function(a){var b=a.index,c=this._itemsData.getChildByIndex(b);if(c){var d=c.getChildValue("_iid");b=this._usedDataSelector.getItemIdIndex(d),0>b?this._selectionHandler.removeSelection():this._selectionHandler.setSelectedIndex(b,!0),this._handleNonListSelectors(d)}this._dataEditPresenter.rebuildModel()}})}),define.experiment.component("wixapps.integration.components.panels.ListSettingsPanel.ServerPagination",function(a,b){a.binds(b.merge(["_onPaginationStatusChanged","_onItemsPerPageChanged","_addAppPartCustomizations"])),a.fields({_paginationEnabled:null,_paginationItemsPerPage:null}),a.methods({_loadSharedData:function(a){var b=this._usedDataSelector.getSelectionType();if(this._usedDataSelector.isListSelector())this._itemsPerPage=this._appPart.getLimit(),this._usedDataSelector.getAllData(function(b){this._itemsData.setChildren(b.getChildren()),a&&a(this._itemsData)}.bind(this));else{this._usedDataSelector=this.resources.W.AppsEditor2.getAllItemsOfTypeDataSelector(b,this._appInstance);var c=this._itemsData;this._usedDataSelector.getData(function(b){c.setChildren(b.getChildren()),a&&a(c)})}},_addAppPartCustomizations:function(a){var b=a.addCheckBoxField(this._loc("UsePagination"));b.setValue(this._appPart.paginationEnabled()),b.addEvent("inputChanged",this._onPaginationStatusChanged),a.addBreakLine("10px");var c=a.addSliderField(this._loc("ItemsPerPage"),1,120,1);c.setValue(this._appPart.getLimit()),c.addEvent("inputChanged",this._onItemsPerPageChanged),c.runWhenReady(function(a){this._paginationItemsPerPage=a}.bind(this)),a.addBreakLine("10px")},_onPaginationStatusChanged:function(a){a.value===!0?(this._paginationItemsPerPage.uncollapse(),setTimeout(function(){this._appPart.setLimit(this._itemsPerPage&&-1!==this._itemsPerPage?this._itemsPerPage:10)}.bind(this),0)):(this._paginationItemsPerPage.collapse(),setTimeout(function(){this._appPart.setLimit(-1)}.bind(this),0)),this._reportUserToggledPagination(a.value)},_reportUserToggledPagination:function(a){var b={g1:a.toString()};this._logger.reportEvent(this._logger.Events.APP_BUILDER_TOGGLE_PAGINATION,b)},_onItemsPerPageChanged:function(a){this._appPart.setLimit(a.value),this._itemsPerPage=a.value}})}),define.experiment.Class("wixapps.integration.components.traits.AppsGUITrait.BlogManager",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({_actualOpenEditDataDialog:function(a){var b=a.selectedComp.getAppPartLogic();if(b.getDataEditDialogParams){var c=b.getDataEditDialogParams();W.EditorDialogs.openIframeDialog(c.url,c.params).addEvent("dialogClosed",c.onClosedCallback)}else if(b.getBlogManagerDataDialog){var d=b.getBlogManagerDataDialog();d.payload.anchorsData.then(function(a){d.payload.anchorsData=a,this.resources.W.Commands.executeCommand("WEditorCommands.OpenBlogManagerFrame",d)}.bind(this))}else W.EditorDialogs.openWixAppsDataDialog(a.selectedComp)}})}),define.experiment.Class("wixapps.integration.components.traits.AppsGUITrait.LazyProvision",function(a,b){a.resources(b.merge(["W.AppStoreManager"])),a.methods({_getAppDefinitionId:function(a){var b=a.getAppInstance();return b.getAppDefinitionId()},_getWidgetId:function(a){var b=a.getPartDef();return b.id},_onOpenEditDataDialog:function(a){if(W.Config.siteNeverSavedBefore()){if(W.Editor.getEditorStatusAPI().getSaveInProcess())return;W.EditorDialogs.openWixAppsSiteMustBeSaved()}else{var b=this,c=a.selectedComp;this.resources.W.AppStoreManager.getAppDefinitionData(this._getAppDefinitionId(c),function(d){if(!d)throw"Error: AppData not found";"Template"===d.state?b.resources.W.AppStoreManager.provisionApp(b.WIX_APP_PART_TYPE,b._getAppDefinitionId(c),b._getWidgetId(c),function(c){b.reloadApplication(c),b._actualOpenEditDataDialog(a)}):b._actualOpenEditDataDialog(a)})}}})}),define.experiment.Class("wixapps.integration.components.traits.AppsGUITrait.LazyProvisionTemp",function(a,b){a.resources(b.merge(["W.AppStoreManager"])),a.methods({_getAppDefinitionId:function(a){var b=a.getAppInstance();return b.getAppDefinitionId()},_getWidgetId:function(a){var b=a.getPartDef();return b.id},_onOpenEditDataDialog:function(a){if(W.Config.siteNeverSavedBefore()){if(W.Editor.getEditorStatusAPI().getSaveInProcess())return;W.EditorDialogs.openWixAppsSiteMustBeSaved()}else{var b=this,c=a.selectedComp;this.resources.W.AppStoreManager.getAppDefinitionData(this._getAppDefinitionId(c),function(d){if(!d)throw"Error: AppData not found";"Template"===d.state?b.resources.W.AppStoreManager.provisionApp(b.WIX_APP_PART_TYPE,b._getAppDefinitionId(c),b._getWidgetId(c),function(c){b.reloadApplication(c),b._actualOpenEditDataDialog(a)}):b._actualOpenEditDataDialog(a)})}}})}),define.experiment.Class("wixapps.integration.components.traits.AppsGUITrait.PageAnchorsOptimization",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({_actualOpenEditDataDialog:function(a){var b=a.selectedComp.getAppPartLogic();if(b.getDataEditDialogParams){var c=b.getDataEditDialogParams();W.EditorDialogs.openIframeDialog(c.url,c.params).addEvent("dialogClosed",c.onClosedCallback)}else if(b.getBlogManagerDataDialog){var d=b.getBlogManagerDataDialog();this.resources.W.Commands.executeCommand("WEditorCommands.OpenBlogManagerFrame",d)}else W.EditorDialogs.openWixAppsDataDialog(a.selectedComp)}})}),define.experiment.Class("wixapps.integration.components.traits.AppsGUITrait.Playlist",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({_actualOpenEditDataDialog:function(a){var b=a.selectedComp.getAppPartLogic();if(b.getDataEditDialogParams){var c=b.getDataEditDialogParams();W.EditorDialogs.openIframeDialog(c.url,c.params).addEvent("dialogClosed",c.onClosedCallback)}else{var d=this.resources.W.Commands,e=function(a,c){b.onAfterDataEdit&&b.onAfterDataEdit(a,c,d)},f=function(){var c=b.getDataEditingModel&&b.getDataEditingModel(),d=c.getPanelSkins&&c.getPanelSkins();W.EditorDialogs.openWixAppsDataDialog(a.selectedComp,e,d)};b.onBeforeDataEdit?b.onBeforeDataEdit(d,f):f()}}})}),define.experiment.Class("wixapps.integration.gui.CustomizeItemsPresenter.ShowHideFieldEditor",function(a){a.methods({onHideField:function(a){var b=a.data.getValue();if(!b.isContainer){var c=b.data;this.resources.W.Commands.executeCommand("WAppsEditor2Commands.HideField",{appPart:this._appPart,fieldId:c}),this._createDataStructure()}},onShowField:function(a){var b=a.data.getValue();if(!b.isContainer){var c=b.data;this.resources.W.Commands.executeCommand("WAppsEditor2Commands.ShowField",{appPart:this._appPart,fieldId:c}),this._createDataStructure()}}})}),define.experiment.Class("wixapps.integration.gui.DataEditPresenter.AppBuilderTagsEditor",function(a,b){a.binds(b.merge(["_updateTagsRepoDataItem","_onDataSelectorChanged","_onTagsChanged"])),a.utilize(b.merge(["wixapps.core.utils.WixAppsLogger"])),a.fields({_logger:null,_tagsRepoDataItem:null}),a.methods({initialize:b.after(function(){this._appPart.addEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onDataSelectorChanged),this._tagsRepoDataItem=this._appInstance.getTagsMapping(),this._tagsRepoDataItem.addEvent(Constants.DataItemEvents.CHANGE,this._updateTagsRepoDataItem),this._logger=new this.imports.WixAppsLogger}),setupPresenter:b.after(function(){this.resources.W.Commands.registerCommandAndListener("WEditorCommands.StartEditingMultiSelection",this,this._onBeforeStartEditingText),this.resources.W.Commands.registerCommandAndListener("WEditorCommands.StopEditingMultiSelection",this,this._onStopEditingText)}),_getNullItemRawData:function(){var a=this._dataItemFactory.createDataItem({_iid:"NULL_ITEM",_type:this._typeName,_tags:[]});this._typesManager.applyDefaults(a);var b=this.resources.W.AppsEditor2.localize("DATA_EDIT_PANEL_ItemNotSelected");return a.getChildByRef("title").setValue(b),a.getValue()},openTagHelpDialog:function(a){this._logger.reportEvent(this._logger.Events.APP_BUILDER_ITEM_TAG_HELP_CLICKED),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenHelpBubble",{appPart:this._appPart,ftHelpSetName:"FT_HELP_ADDING_TAGS_TO_ITEM",anchorElement:a.sender.getParentProxy().getElement()})},_onDataSelectorChanged:function(a){this._usedDataSelector=a,this._updateMetadata()},_updateTagsRepoDataItem:function(a){this._ignoreOriginalChanges=!0,this._model.getChildByRef("_tagMapping").setValue(a.target.getValue()),this._ignoreOriginalChanges=!1
},rebuildModel:function(a){this._updateOriginalDataItem();var b=this._originalDataItem?this._originalDataItem.getValue():this._getNullItemRawData();b._tags=b._tags||[],b._tagMapping=this._tagsRepoDataItem.getValue(),this._model.getChildByRef("_tags").removeEvent(Constants.DataItemEvents.CHANGE,this._onTagsChanged),this._model.setValue(b),this._model.getChildByRef("_tags").addEvent(Constants.DataItemEvents.CHANGE,this._onTagsChanged),(!this._originalDataItem||a)&&this._updateMetadata()},_onTagsChanged:function(){this._ignoreModelChanges||(this._focusElement=this._builderDialogPanel.getViewNode().getElement('div[skinpart="input"]'))},_getDataItemValueFromModel:function(){var a=this._model.getValue();return delete a._tagMapping,a},_debouncedDataItemUpdated:_.debounce(function(a){this.resources.W.Commands.executeCommand("WAppsEditor2Commands.DataItemUpdated",a)},1500),_onModelChanged:function(a){if(!this._ignoreOriginalChanges&&this._originalDataItem){this._ignoreModelChanges=!0;var b=this._getDataItemValueFromModel(),c=this._originalDataItem.getValue();this._originalDataItem.setValue(b);var d=a.currentTarget.getChildRef(a.target),e={oldValue:c,dataItem:this._originalDataItem,changedFieldName:d};this._usedDataSelector.isListSelector()&&this._usedDataSelector.isSorted()&&this._usedDataSelector.getSortField()===d?this._debouncedDataItemUpdated(e):this.resources.W.Commands.executeCommand("WAppsEditor2Commands.DataItemUpdated",e),this._ignoreModelChanges=!1,this._updateMetadata()}},_onOriginalItemChanged:function(){if(!this._ignoreModelChanges&&this._originalDataItem){this._ignoreOriginalChanges=!0;var a=this._originalDataItem.getValue();a._tagMapping=this._tagsRepoDataItem.getValue(),this._model.setValue(a),this._ignoreOriginalChanges=!1}},_setTextFocusOnEdit:function(a){var b=this;if(this._builderDialogPanel){var c=Q.defer();Q.resolve().then(function(){var a=b._builderDialogPanel.getViewNode().getParent("[comp*=InputGroup]");return a?a.hidden||c.resolve():c.reject(),c.promise}).then(function(){var c=b._focusElement||a&&"tags"===a.focusOn&&b._builderDialogPanel.getViewNode().getElement('div[skinpart="input"]')||b._builderDialogPanel.getViewNode().getElement('input[type="text"]');c&&c.focus(),delete b._focusElement})}},_updateOriginalDataItem:function(){var a=this._currentOriginalDataItemId;this._originalDataItem&&this._originalDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._onOriginalItemChanged);var b=this._listCursor.getCurrentItemIndex();this._originalDataItem=this._itemsData.getChildByIndex(b),this._originalDataItem?(this._currentOriginalDataItemId=this._originalDataItem.getChildValue("_iid"),this._originalDataItem.addEvent(Constants.DataItemEvents.CHANGE,this._onOriginalItemChanged)):delete this._currentOriginalDataItemId,a!==this._currentOriginalDataItemId&&this._setTextFocusOnEdit()},dispose:b.before(function(){this.resources.W.Commands.unregisterCommand("WEditorCommands.StartEditingMultiSelection"),this.resources.W.Commands.unregisterCommand("WEditorCommands.StopEditingMultiSelection"),this._appPart.removeEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onDataSelectorChanged),this._model.getChildByRef("_tags").removeEvent(Constants.DataItemEvents.CHANGE,this._onTagsChanged),this._tagsRepoDataItem&&(this._tagsRepoDataItem.removeEvent(Constants.DataItemEvents.CHANGE,this._updateTagsRepoDataItem),this._tagsRepoDataItem=null)})})}),define.experiment.Class("wixapps.integration.gui.DataItemsSelectionPresenter.AppBuilderTagsEditor",function(a,b){a.fields({_tags:[],_dataSelectors:[],_originalDataSelector:null,_appPart:null,_typeDef:null,_type:null}),a.resources(b.merge(["W.Editor","W.AppsGUI","W.EditorDialogs"])),a.utilize(b.merge(["wixapps.integration.gui.FilterByTagsBubblePresenter"])),a.binds(b.merge(["_updateTagsInModel","_onTagsChanged","_userTagChanged"])),a.methods({initialize:function(a,b,c,d,e,f){this._appPart=a,this._predefinedSettings=this._appPart.getAppPartDefinition().getDataSelectorDef().predefinedSettings,this._originalDataSelector=this._appPart.getDataSelector(),this._type=b,this._appInstance=c,this._typeDef=this._appInstance.getTypesManager().getType(this._type),this._initDataSelectors(),this._okCallback=d||function(){},this._cancelCallback=e||function(){},this._selectedTags=[],this._dataItemFactory=this._appInstance.getDataItemFactory(),this._logger=new this.imports.WixAppsLogger,this._args=f||{}},setupPresenter:function(a){this._builderDialogPanel=a;var b=this;this.resource.getResourceValue("W.AppsEditor2",function(a){var c=b._args.logicalTypeName||b._originalDataSelector.getLogicalTypeName();b._appsEditor2Mgr=a,b._buildModel(),b._createMetaData(),b._initSelector(c),b.updateSelector(c)}),this._builderDialogPanel.getViewHolder().performActionWhenReady(function(){b.openNoSelectedTagsBubbleHelp()})},_buildModel:function(){var a=this._appInstance.getDataItemFactory();this._tags=this._appInstance.getTagsMapping(),this._model=a.createDataItem({items:[],allTags:[],userTags:{},sortFields:{items:[],selectedValue:null},sortAscending:!0,selectorTypes:[{value:this.MANUAL_SELECTED_SELECTOR_TYPE,text:this._appsEditor2Mgr.localize("FILTER_DIALOG_Select_Items","Select Items")},{value:this.TAGS_SELECTOR_TYPE,text:this._appsEditor2Mgr.localize("FILTER_DIALOG_Use_Tags","Use Tags")}],selectedType:this._originalDataSelector.getLogicalTypeName(),userDefinedTags:this._predefinedSettings?!0:!1,selectedTags:[]}),this._setSelectedTags(),this._updateTagsInModel(),this._model.getChildByRef("allTags").addEvent(Constants.DataItemEvents.CHANGE,this._onTagsChanged),this._updateSortInModel(this._model.getValue())},_initSelector:function(a){a===this.TAGS_SELECTOR_TYPE&&this._getDataSelector(a).setTags(this._selectedTags)},_setSelectedTags:function(){var a=this._getDataSelector(this._model.getChildByRef("selectedType").getValue());this._selectedTags=this._predefinedSettings?this._predefinedSettings.tags:a.getLogicalTypeName()===this.TAGS_SELECTOR_TYPE?a.getTags():[],this._model.getChildByRef("selectedTags").setValue(this._selectedTags)},_updateTagsInModel:function(){this._model.getChildByRef("allTags").setValue(this._createAllTags(this._selectedTags)),this._updateSelectorPredefinedSettings()},_createUserSelectionTagDropdown:function(){var a=[],b=this._model.getChildByRef("allTags").getValue();b&&(a=_.filter(b,{selected:!0})),a.unshift({value:"all",text:this._appsEditor2Mgr.localize("FILTER_DIALOG_All_Tags","All")}),this._model.getChildByRef("userTags").setValue({items:a,selectedValue:this._predefinedSettings?this._predefinedSettings.selectedTag:""})},enableUserDefinedTags:function(){this._updateSelectorPredefinedSettings(!0),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_ENABLE)},disableUserDefinedTags:function(){var a=this.TAGS_SELECTOR_TYPE;this._getDataSelector(a).setTags(this._selectedTags),this._predefinedSettings=null,this.updateSelector(a),this._model.getChildByRef("userDefinedTags").setValue(!1),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_DISABLE)},_getSelectedTagsCount:function(){return this._model.getChildByRef("allTags").getChildren().length},_createMetaData:function(){var a={selectionCountLabel:this._createSelectionCountLabel(),selectedTagsCount:this._getSelectedTagsCount()};this._metaData=this._dataItemFactory.createDataItem(a)},_handleDialogButtons:function(){this._selectedTags.length>0?this._builderDialogPanel.enableButton("OK"):this._builderDialogPanel.disableButton("OK")},_onTagsChanged:function(a){var b=this.TAGS_SELECTOR_TYPE,c=this._getDataSelector(b),d=a.target.getChildValue("value"),e=a.target.getChildValue("text");a.target.getChildValue("selected")?(this._selectedTags.push(d),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_ADDED_FILTER_TAG,{i1:e})):(_.pull(this._selectedTags,d),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_REMOVED_FILTER_TAG,{i1:e})),c.setTags(this._selectedTags),this._updateSelectorPredefinedSettings(),this._model.getChildByRef("selectedTags").setValue(this._selectedTags),this._handleDialogButtons(),this.updateSelector(b)},closeBubble:function(){this.resources.W.EditorDialogs.closeDialogById("FTHelpBubble_2")},onBeforeDialogClose:function(a){if(this.closeBubble(),a&&"OK"==a.result){var b=this._getDataSelector();this._updateDataSelector(b),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_CLICK_OK,{i1:b.getLogicalTypeName(),c1:JSON.stringify(b.getDefinition()),c2:this._model.getChildValue("userDefinedTags")}),this._okCallback(b,this._predefinedSettings)}else{var c={};this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_DIALOG_CANCELED,c),this._cancelCallback()}},openNoSelectedTagsBubbleHelp:function(){this._tags.getChildren().length>0&&0===this._selectedTags.length&&this.resources.W.Commands.executeCommand("WAppsEditor2Commands.OpenHelpBubble",{appPart:this._appPart,ftHelpSetName:"FT_FILTER_TAGS",anchorElement:this._builderDialogPanel.getViewNode().getElement("[vcfield=tags]")})},selectDataSelector:function(a){this.closeBubble();var b=a.params.type;b===this.TAGS_SELECTOR_TYPE?(0===this._tags.getChildren().length&&this.openTagsFilterBubbleHelp(a),this._handleDialogButtons()):this._builderDialogPanel.enableButton(this.resources.W.EditorDialogs.DialogButtonSet.OK),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_SELECT_TYPE,{i1:b}),this.updateSelector(b)},_updateSelectorPredefinedSettings:function(a){if(!this._getDataSelector().hasPredefinedSettings()||!this._predefinedSettings&&!a)return this._model.getChildByRef("userDefinedTags").setValue(!1),void 0;var b=this._selectedTags,c=this._model.getChildByRef("userTags").getChildByRef("selectedValue"),d=c?c.getValue():this._predefinedSettings?this._predefinedSettings.selectedTag:null,e=d&&_.contains(b,d)?d:"all";this._predefinedSettings={tags:b,selectedTag:e},c&&c.removeEvent(Constants.DataItemEvents.CHANGE,this._userTagChanged),this._createUserSelectionTagDropdown(),this._model.getChildByRef("userTags").getChildByRef("selectedValue").addEvent(Constants.DataItemEvents.CHANGE,this._userTagChanged),this._model.getChildByRef("userDefinedTags").setValue(!0)},_updateDataSelector:function(a){if(a.getLogicalTypeName()===this.MANUAL_SELECTED_SELECTOR_TYPE){var b=[];Object.each(this._selectedItems,function(c,d){var e=a.getItemIdIndex(d);e=e>=0?e:b.length,b.splice(e,0,d)}.bind(this)),_.isEqual(_.keys(this._selectedItems),_.keys(this._previouslySelected))?this._reportDataSelectionChange(!1):this._reportDataSelectionChange(!0),a.setItemIds(b)}else a.getLogicalTypeName()===this.TAGS_SELECTOR_TYPE&&a.setPredefinedSettings(this._predefinedSettings);a.hasPredefinedSettings()||(this._predefinedSettings=null)},_userTagChanged:function(){this._updateSelectorPredefinedSettings(),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_UOU_FILTERING_TAG_SELECTED,{i1:this._predefinedSettings.selectedTag})},updateSelector:function(a){var b="string"==typeof a?a:a.params.type,c=this._getDataSelector(b);if(this._model.getChildByRef("selectedType").setValue(b),"IB.ManualSelectedList"===b)this._updateAllItemsSelector();else{var d=this;c.getData(function(a){var b=d._convertItemsToObjectModel(a.getChildren(),c.getSortField());d._model.getChildByRef("items").setValue(b),d._updateMetadata()})}},_convertItemsToObjectModel:function(a,b){var c=this._originalDataSelector.getItemIds(),d=/^(-?(?:[1-9][0-9]*)?[0-9]{4})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])T(2[0-3]|[01][0-9]):([0-5][0-9]):([0-5][0-9])(\.[0-9]+)?(Z|[+-](?:2[0-3]|[01][0-9]):[0-5][0-9])?$/,e=function(a){return d.test(a)?new Date(a).toUTCString().replace(" GMT",""):a};return _.map(a,function(a){var d=a.getChildValue("_iid");return{id:d,title:a.getChildValue("title")?a.getChildValue("title"):this._appsEditor2Mgr.localize("DATA_EDIT_PANEL_UntitledItem"),selected:c.contains(d),description:b&&"title"!==b?e(a.getChildValue(b)):""}}.bind(this))},_createAllTags:function(a){var b=_.mapValues(this._tags.getValue(),function(a){return{tag:a,selected:!1}});return _.each(a,function(a){b[a].selected=!0}),_(b).keys().map(function(a){return{value:a,text:b[a].tag,selected:b[a].selected}}).value()},_initDataSelectors:function(){var a=this._originalDataSelector.getDefinition(),b=this._appInstance.getDataSelectors(),c=_.clone(a),d=this._originalDataSelector.getItemIds();c.itemIds=a.itemIds||d;var e=b.createInstance("IB.ManualSelectedList",this._originalDataSelector.getDataProvider(),this._type,c),f=_.clone(a);f.tagIds="IB.TagsFilteredList"===this._originalDataSelector.getLogicalTypeName()?this._originalDataSelector.getTags():[];var g=b.createInstance("IB.TagsFilteredList",this._originalDataSelector.getDataProvider(),this._type,f);this._dataSelectors=[e,g]},openHelpDialog:function(a){var b=a.data.getChildValue("helpId");W.Commands.executeCommand("WEditorCommands.ShowHelpDialog",b)},openTagsFilterBubbleHelp:function(a){var b=a.params&&a.params.forceOpen;if("IB.TagsFilteredList"!==this._originalDataSelector.getLogicalTypeName()&&(!this._dontShowTagsFilterBubbleHelp||b)){this._dontShowTagsFilterBubbleHelp=!0;var c={title:this._appsEditor2Mgr.localize("FILTER_DIALOG_TAGS_HELP_TITLE"),descriptions:[this._appsEditor2Mgr.localize("FILTER_DIALOG_TAGS_HELP_DESCRIPTION")],iconSrc:"images/icons/tags-filter-bubble-help.gif",helpLink:{title:this._appsEditor2Mgr.localize("FILTER_DIALOG_Learn_more"),helpId:"/node/19865"}},d=new this.imports.FilterByTagsBubblePresenter(this._appPart,c,"appbuilder_help_bubble_TagsFilteredList"),e=this._builderDialogPanel.getViewNode().getElement("[vcfield=tab_IB.TagsFilteredList]"),f=e.getPosition(),g=e.getSize(),h=this.resources.W.AppsGUI.getDialogParams("","","basicPopup");h=_.assign(h,{width:600,minHeight:324,allowScroll:!1,position:Constants.DialogWindow.POSITIONS.DYNAMIC,buttonSet:this.resources.W.EditorDialogs.DialogButtonSet.NONE,top:f.y+g.y+17,left:f.x-g.x-86,nonModal:!1,semiModal:!1,allowDrag:!1,dialogSkin:"wixapps.integration.skins.dialogs.HelpBubbleDialogWindowSkinUpArrow"}),this.resources.W.AppsGUI.openDialog(this._appInstance,"TagsHelpBubble",d,h,[])}},_updateSortInModel:function(){this.closeBubble();var a=this._model.getValue(),b=this._getDataSelector();b.isSorted()||(b=this._getDataSelector("IB.TagsFilteredList")),a.sortFields.selectedValue=b.getSortField(),a.sortAscending=b.isSortAscending();var c=this._appsEditor2Mgr.getTypesHelper(),d=_.map(c.getSortableFields(this._typeDef),function(a){return{value:a.name,text:a.displayName}});a.sortFields.items=_.sortBy(d,"text"),this._model.setValue(a)},_getSelectionCount:function(){return Object.keys(this._selectedItems).length},_getTotalItemsCount:function(){return this._model.getChildByRef("items").getChildren().length},_createSelectionCountLabel:function(){var a=this._getSelectionCount()+"",b=this._getTotalItemsCount()+"",c=this._appsEditor2Mgr.localize("DATA_ITEMS_SELECTION_ITEM_COUNT");return c=c.replace("%count%",a).replace("%total%",b)},onSelectAllOrNone:function(){this._getSelectionCount()===this._getTotalItemsCount()?this.selectNone():this.selectAll()},_updateAllItemsInModel:function(a){var b=this._originalDataSelector.getItemIds();this._selectedItems=_.object(b,_.times(b.length,function(){return!0}));var c=this._convertItemsToObjectModel(a);c.sort(function(a,c){var d=b.indexOf(a.id),e=b.indexOf(c.id);return d>-1&&e>-1?d-e:d>-1&&-1===e?1:-1===d&&e>-1?-1:a.title>c.title?1:a.title<c.title?-1:0}),this._model.getChildByRef("items").setValue(c),this._previouslySelected=_.clone(this._selectedItems),this._updateMetadata()},_updateAllItemsWithSelection:function(a){for(var b=this._model.getValue().items,c=0;c<b.length;c++){var d=b[c];d.selected=a,this._setItemSelectionState(d.id,a)}this._model.getChildByRef("items").setValue(b)},_getDataSelector:function(a){return a=a||this._model.getChildValue("selectedType"),_.find(this._dataSelectors,function(b){return b.getLogicalTypeName()===a})},tagSelected:function(a){var b=a.cause.getData().value;if(""!==b){var c="IB.TagsFilteredList",d=this._getDataSelector(c);d.setTags("all"!==b?[b]:[]),this.updateSelector(c)}},setSortField:function(a){var b=a.cause.getData().value,c=this._getDataSelector();c.setSortField(b),this.updateSelector(c.getLogicalTypeName())},changeSortDirection:function(){this.closeBubble();var a=!this._model.getChildValue("sortAscending");this._model.getChildByRef("sortAscending").setValue(a);var b=this._getDataSelector();b.sortAscending(a),this.updateSelector(b.getLogicalTypeName()),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_CLICK_SORT,{i1:a})}})}),define.experiment.Class("wixapps.integration.gui.ManageItemsPresenter.AppBuilderTagsEditor",function(a,b){a.binds(b.merge(["_onDataSelectorChanged","_onUserTagChanged","_onPredefinedSettingsChanged"])),a.methods({initialize:b.after(function(){delete this._appPartDataSelector,this._model=this._dataItemFactory.createDataItem({}),this._appPart.addEvent(Constants.WixAppEvents.DATA_SELECTOR_PREDEFINED_SETTINGS_CHANGED,this._onPredefinedSettingsChanged),this._appPart.addEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onDataSelectorChanged)}),_onDataSelectorChanged:function(){this._updateMetadata()},_updateMetadata:function(){var a=this._isMobile(),b=this._appPart.getDataSelector(),c={noItems:0===this._itemsData.getChildren().length,allowDrag:"IB.ManualSelectedList"==b.getLogicalTypeName()&&!a,allowListActions:b.isListSelector()&&!a,allowEditItem:!a};this._setMetaDataValue(c)},onItemMoved:function(a){var b=a.cause.oldIndex,c=a.cause.newIndex;this._ignoreChanges=!0,W.UndoRedoManager.startTransaction();var d=this._appPart.getDataSelector();d.moveItem(b,c),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataSelectorDataChange",{changeType:"Move",selector:d,dataItemId:d.getItemIds()[b],newValue:c,oldValue:b,appPart:this._appPart}),W.UndoRedoManager.endTransaction(),this._ignoreChanges=!1;var e=this._listCursor.getCurrentItemIndex(),f=e;e===b?f=c:(e>b&&f--,f>=c&&f++),e!==f&&this._listCursor.setSelectedIndex(f)},rebuildModel:function(a){this._ignoreChanges||(this._createModel(a),this._updateMetadata())},_createUserTagModel:function(){this._itemsTaggedPrefix=this._loc("UserTagsDropdownLabel")+" ";var a=this._predefinedSettings&&this._predefinedSettings.selectedTag;if(this._predefinedSettings=this._appPart.getUserTags().getValue(),a=a||this._predefinedSettings.selectedValue,this._predefinedSettings){for(var b=this._predefinedSettings.items,c=[{value:"all",text:this._loc("FILTER_DIALOG_All_Tags","All")}],d=1;d<b.length;d++)c.push({value:this._predefinedSettings.items[d].value,text:this._itemsTaggedPrefix+b[d].text});return{enabled:this._predefinedSettings.enabled,items:c,selectedValue:a}}return{enabled:!1,items:[{value:"",text:""}],selectedValue:""}},_createModel:function(a){var b=[];a&&this._itemsData.setChildren(a.getRealChildren());for(var c=this._itemsData.getChildren(),d=0;d<c.length;d++){var e=c[d],f=this._createModelItem(e,d);b.push(f)}var g={items:b,userTags:this._createUserTagModel()};this._model.setValue(g),this._predefinedSettings.enabled&&this._model.getChildByRef("userTags").getChildByRef("selectedValue").addEvent(Constants.DataItemEvents.CHANGE,this._onUserTagChanged)},_onPredefinedSettingsChanged:function(a){this._predefinedSettings=a,this._model.getChildByRef("userTags").setValue(this._createUserTagModel())},_onUserTagChanged:function(a){var b=a.newValue;if(this._predefinedSettings.enabled&&b!==this._predefinedSettings.selectedValue){var c=this._appPart.getDataSelector();this._predefinedSettings.selectedValue=b,c.hasPredefinedSettings()&&c.setPredefinedSettings({tags:_(this._predefinedSettings.items).filter(function(a){return"all"!=a.value}).map("value").value(),selectedTag:this._predefinedSettings.selectedValue},function(a){this.rebuildModel(a)}.bind(this))}},_onSharedDataChange:function(a){for(var b=this._dataItemUtils.createDataChangeEventList(a,this._itemsData),c=["_iid","title"],d=_.filter(b,function(a){return a.type===Constants.DataItemEvents.CHANGE?2===a.path.length&&_.contains(c,a.path[1]):a.type===Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD?1===a.path.length:a.type===Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE?1===a.path.length:!1}),e=this._model.getChildByRef("items"),f=0;f<d.length;f++){var g,h=d[f],i=h.path[0];if(h.type===Constants.DataItemEvents.CHANGE){var j=h.path[1],k=e.getChildByIndex(i),l=k.getValue();"_iid"===j&&(l.itemId=h.item.getValue()),"title"===j&&(l.title=h.item.getValue()),k.setValue(l)}else if(h.type===Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD){var m=this._createModelItem(h.item,i);g=e.getValue(),g.splice(i,0,m),e.setValue(g)}else h.type===Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE&&(g=e.getValue(),g.splice(i,1),e.setValue(g))}},_listCursorChanged:function(a){var b=a.index,c=a.oldIndex,d=null,e=null,f=this._model.getChildByRef("items");0!==f.getChildrenCount()&&(c>-1&&(d=f.getChildByIndex(c),e=d.getValue(),e.selected=!1,d.setValue(e)),b>-1&&(d=f.getChildByIndex(b),e=d.getValue(),e.selected=!0,d.setValue(e)))},_removeEvents:b.before(function(){this._appPart.removeEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,this._onDataSelectorChanged)})})}),define.experiment.component("wixapps.integration.gui.SelectionHandler.ServerPagination",function(a){a.methods({last:function(){this.setSelectedIndex(this._appPart.getDataSelector().getTotalCount()-1)},setSelectedIndex:function(a,b){if(a!=this._currentItemIndex){var c,d=this._currentItemIndex,e=this._appPart.getDataSelector();return c=e.isListSelector()?e.getTotalCount():this._appPart.getAppPartData().getChildren().length,0===c?(this._currentItemIndex=-1,e.isListSelector()&&e.resetSelectedItem(),void 0):(this._currentItemIndex=a>=c?c-1:0>a?0:a,e.isListSelector()&&e.setSelectedItemByIndex(this._currentItemIndex,function(){this._markCurrentProxy(d,b)}.bind(this)),void 0)}},_markCurrentProxy:function(a,b){var c=this._appPart.getDataSelector();if(this._appPart&&c){var d=this._currentDataItem;this._currentDataItem=c.isListSelector()?c.getSelectedItem():this._appPart.getAppPartData();var e=this._findProxyByDataItem(this._currentDataItem);e?(this._selectionMarker.unmarkSelectedSubComponent(),this._selectionMarker.markSelectedSubComponent(e.getElement()),b||this.notifySelectionChanged(a,d)):this.notifySelectionChanged(a,d)}},_onSelectorAction:function(a){if(a.action==this.imports.ProxySelector.ACTION_MOUSE_DOWN&&this._appPart){var b=a.proxyList[a.proxyList.length-1];if(this._currentDataItem=b.getData(),this._appPart.getDataSelector().isListSelector()){var c=this._appPart.getDataSelector().getItemIdIndex(this._currentDataItem.getChildValue("_iid"));this.setSelectedIndex(c)}else this.setSelectedIndex(0)}}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.AppBuilderDeleteType.New",function(a,b){a.resources(b.merge(["W.UndoRedoManager"])),a.binds(b.merge(["_deleteAppPartDialog"])),a.utilize(b.merge(["wysiwyg.editor.commandregistrars.EditCommandRegistrar"])),a.methods({_registerPlugins:b.after(function(){this.resources.W.Commands.executeCommand("WEditorCommands.CommandRegistrarRegisterPlugin",{componentClassName:"wixapps.integration.components.AppPart2",pluginMethods:{onBeforeDelete:this._deleteAppPartDialog}})}),_openDeleteAppPartDialog:function(a,b){var c=this.resources.W.AppsGUI.getDialogParams(this.localize("DELETE_APP_PART_DIALOG_TITLE"),"","");c.width=430,c.minHeight=20,c.allowDrag=!1,c.position=Constants.DialogWindow.POSITIONS.CENTER,c.buttonSet=[W.EditorDialogs.DialogButtons.CANCEL,W.EditorDialogs.DialogButtons.DELETE],this.resources.W.AppsGUI.openDialog(a,"DeleteLastAppPartDialog",b,c)},_deleteAppPartDialog:function(a,b){if(W.Config.env.isViewingSecondaryDevice())return b(),void 0;var c=this._getAppPartFromContainerComp(a);if("error"===c.getState("phase"))return b(),void 0;var d=c.getAppInstance(),e=c.getDataSelector().getSelectionType(),f=this._getAllAppPartsDefinitions(d).then(function(a){var b=_.filter(a,function(a){return a.getType()===e}),c=d.getDataItemFactory().createDataItem({deleteTypeFlag:!1,canDeleteType:1===b.length});return Q.resolve(c)}),g=null,h=this,i=function(){var a=function(a){var c={};h.resources.W.UndoRedoManager.startTransaction(c),b(),h.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.TypeDeleted",a),h.resources.W.UndoRedoManager.endTransaction(c)},c=function(){b()};d.deleteType(e,a,c)};f.done(function(a){var c={setupPresenter:function(a){g=a},getModel:function(){return a},onBeforeDialogClose:function(a){if("DELETE"===a.result){var c=this.getModel().getValue();c.deleteTypeFlag?i():b()}},learnMore:function(){h.resources.W.Commands.executeCommand("WEditorCommands.ShowHelpDialog","/node/21939")}};h._openDeleteAppPartDialog(d,c)})},_getAppPartFromContainerComp:function(a){var b=[];return a.isMultiSelect?b=a.getSelectedComps():a.IS_CONTAINER&&(b=a.getDescendantComponentsRecurse(a,b)),b&&b.length&&(b=_.filter(b,function(a){return a.isAppPart2})),b[0]||a},_reportSaveToBi:function(a,b,c){var d=a.getAppPartDefinitions(),e=d.getIds(),f={c1:a.getInstanceId(),i1:e.length,i2:b};c&&(f.error=c);for(var g={},h=0;h<e.length;h++){var i=d.getById(e[h]);if(a.getDataSelectors().exists(i.getDataSelectorId())){var j=a.getDataSelectors().getById(i.getDataSelectorId());g[e[h]]=j.getBiInfo()}}f.g2=JSON.stringify(g),this._logger.reportEvent(this._logger.Events.APP_BUILDER_SAVE,f)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.AppBuilderTagsEditor",function(a,b){a.resources(b.merge(["W.UndoRedoManager"])),a.methods({_registerCommands:b.before(function(){this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.CreateTag",this,this._createTag),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.DataItemUpdated",this,this._onDataItemUpdated),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.ChangeDataSelector",this,this._changeDataSelector)}),_changeDataSelector:function(a){var b=a.appPart.getDataSelector();a.appPart.setDataSelector(a.dataSelector),a.appPart.setDataSelectorPredefinedSettings(a.dataSelectorPredefinedSettings),a.listSettingsPanel.fireEvent(Constants.WixAppEvents.DATA_SELECTOR_CHANGED,a.dataSelector);var c={};this.resources.W.UndoRedoManager.startTransaction(c);var d={appPart:a.appPart,oldValue:b,newValue:a.dataSelector};this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataSelectorChanged",d),this.resources.W.UndoRedoManager.endTransaction(c)},_createTag:function(a){var b=this._getApplicationInstance(),c=b.addTag(a.displayName);a.callback&&a.callback(c),this._logger.reportEvent(this._logger.Events.TAG_CREATED,{i1:a.displayName})},_getApplicationInstance:function(){var a=this._getApps2Manager().getApplicationInstances(),b=_(a).toArray().first();return b},_onDataItemUpdated:function(a){var b=this._getApplicationInstance();_.isEqual(a.oldValue,a.dataItem.getValue())||b.updateDataSelectors(a.oldValue,a.dataItem)},_getDataItemDefaultValue:function(a){return this._addClientSideTimestamps({_iid:this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId(),_type:a,_tags:[]})},_onDataItemSelectionRequested:function(a){var b=a.appPart,c=a.type,d=a.appInstance,e=a.okCallback,f=a.cancelCallback;this._openDataItemSelectionDialog(b,c,d,e,f,a.args)},_openDataItemSelectionDialog:function(a,b,c,d,e,f){var g=new this.imports.DataItemsSelectionPresenter(a,b,c,d,e,f),h=this.resources.W.AppsGUI.getDialogParams(this.localize("FILTER_DIALOG_Title"));h=Object.merge(h,{dialogSkin:"wysiwyg.editor.skins.dialogs.WDialogWindowSkin",width:610,minHeight:515,position:"center",level:1,allowScroll:!1,showToolbar:!1,nonModal:!1,allowDrag:!1,buttonSet:this.resources.W.EditorDialogs.DialogButtonSet.OK_CANCEL,helpButtonId:"/node/19865"}),this.resources.W.AppsGUI.openDialog(c,this._getFilterSelectionViewName(),g,h,["TabView"]),this._logger.reportEvent(this._logger.Events.APP_BUILDER_FILTER_SELECTION_DIALOG_OPEN,{i1:a.getDataSelector().getLogicalTypeName()})},_getFilterSelectionViewName:function(){return"FilterSelection.AppBuilderTagsEditor2"},_setUpdatedAtAndFireUndoCommandOnIt:function(a){var b=this._removeDataItemChangeEvent(a.target.getChildValue("_iid")),c=a.target.getValue(),d=a.target.getChildByRef("_updatedAt"),e=d.getValue(),f=this._getApps2Manager().getServerDate().toISOString();d.setValue(f),b.dataItem.addEvent(Constants.DataItemEvents.CHANGE,b.callback),this._onDataItemUpdated({oldValue:c,dataItem:a.target,changedFieldName:"_updatedAt"}),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataItemChange",{dataItem:d,changeEvents:[{target:d,currentTarget:d,_previousTargets:[d],phase:Constants.DataItemEventPhase.ON_TARGET,oldValue:e,newValue:f}]})},_createDataSelectorDefinition:function(a){var b={id:a,predefinedSettings:null};return b},_createAppPage:function(a){var b=a.appInnerID,c=a.pageName,d=a.appPart,e=a.onPageCreated,f=d.getAppInstance(),g=d.getDataSelector().getDataProvider(),h=d.getAppPartDefinition().getType(),i=d.getAppPartDefinition().getViewName(),j=i+"_item_page",k=f.getViewDefinitions().getViewDefinition(h,i,"");k=this._viewBuilder.generatePageView(k.getValue(),"Center",630),k.forType=h,k.name=j,f.addViewDefinition(k);var l,m=f.getPages().getPageDefByType(h);l=m?m.getId():this._createAndRegisterPage(f,h,c);var n=f.getDataSelectors(),o=n.createAndRegister("IB.PageSelectedItem",g,h,{appPageId:l}),p=this._createDataSelectorDefinition(o),q=f.getTypesManager().getType(h),r=q.displayName,s=this.resources.W.Resources.get("EDITOR_LANGUAGE","FPP_LIST_ITEM_TITLE","Item").replace("%friendly_type_name%",r),t=f.getAppPartDefinitions().createAndRegister(p,j,h,s);this._applicationPageMgr.addAppBuilderApplicationPage(b,l,f,c,t),e&&setTimeout(function(){e(l)},1e3)},_prepareDataForCopiedComp:function(a,b,c,d){var e=b.getViewDefinitions(),f=c.getType(),g=c.getViewName(),h=g+"_dup_"+this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId();e.duplicateListViewDefinition(b,g,h,f,f);var i=_.cloneDeep(c.getDataSelectorDef());i.id=d.getId();var j=this._ensureUniqueWidgetName(b,c.getDisplayName()),k=b.getAppPartDefinitions().createAndRegister(i,h,f,j);return{type:"AppBuilderComponent",appInnerID:a,appPartName:k}},_setupAppPart:function(a,b,c){this._closeAppBuilderManageDialog();var d,e=a.getDataItemFactory(),f=b.view,g=f.name,h=f.forType,i=b.data;d=a.getDataProviders().getWixDbDataProvider(),d.registerDataItemsChange(this._addDataItemChangeEvent,this._removeDataItemChangeEvent);var j=a.getTypesManager(),k=Object.clone(b.type);d.createType(k);for(var l=0;l<i.length;l++){var m=i[l];this._addClientSideTimestamps(m),m._tags=m._tags||[];var n=e.createDataItem(m);j.applyDefaults(n),d.createItem(n)}d.adminTypeMigration(k);var o=this._getSelectorLogicalType(c),p=_.pluck(i,"_iid"),q=a.getDataSelectors().createAndRegister(o,d,h,{itemIds:p}),r=this._createDataSelectorDefinition(q);a.addViewDefinition(f),this._setAdditionalViewDefinitions(c,b,a),a.setupCustomizations([]);var s=a.getAppPartDefinitions().createAndRegister(r,g,h,b.friendlyName),t=a.getApplicationId();return this._addAppPartComponent(t,a,s,b),s},_onCreateAppPartByType:function(a){var b=a.typeName,c=a.appInstance,d=a.templateId||"BlankList",e="IB.ManualSelectedList",f=this._generateNewListNameForCollection(c,b),g=a.type||"list",h=c.getDataSelectors(),i=c.getDataProviders().getWixDbDataProvider(),j=c.getApplicationId(),k=this.getAllItemsOfTypeDataSelector(b,c),l=this._viewBuilder.getViewTemplateDefinition(d),m=l.view,n=m.name,o=this;k.getData(function(){var a=k.getItemIds(),d=h.createAndRegister(e,i,b,{itemIds:a}),p=o._createDataSelectorDefinition(d);m.forType=b,c.addViewDefinition(m),o._setAdditionalViewDefinitions(g,l,c);var q=c.getAppPartDefinitions().createAndRegister(p,n,b,f);o._addAppPartComponent(j,c,q,l)})}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.BlinkyFormContainerEditor",function(a,b){a.traits(b.merge(["wixapps.integration.managers.traits.FormsEditorManagerTrait","wixapps.integration.components.common.minipart.editor.MiniPartFppMetaDataBuilderTrait"])),a.methods({_onAddNewDataItem:function(a){this.resources.W.Preview.getPreviewManagersAsync(function(b){var c=this,d=function(b,d,e){c._addDataItemChangeEvent(b,d),a.fromUndo||(W.UndoRedoManager.startTransaction(),c.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.DataChange",{dataProvider:d,dataSelectors:e,oldValue:null,newValue:b.getValue(),comp:a.comp,compId:a.compId}),W.UndoRedoManager.endTransaction()),a.onDataItemAdded&&a.onDataItemAdded(b,e)
};b.Commands.executeCommand("WApps2Commands.AddNewDataItem",{comp:a.comp,compId:a.compId,rawData:a.rawData,dataSelectors:a.dataSelectors,itemIndex:a.itemIndex,action:a.action,onDataItemAdded:d,onError:a.onError})},this)},_getDataItemDefaultValue:b.remove(),_onDeleteField:function(a){var b,c=a.comp,d=c.getAppInstance(),e=c.getDataSelector(),f=e.getSelectionType(),g=e.getDataProvider(),h=function(){var e={};try{W.UndoRedoManager.startTransaction(e);var h=[],i=d.getViewDefinitions(),j=i.getViewDefinitionsByType(f);for(b=0;b<j.length;b++){for(var k=j[b],l=k.getValue(),m=Object.clone(l),n=this._viewBuilder.findByData(l,a.fieldName),o=0;o<n.length;o++)this._viewBuilder.removeFieldFromView(l,n[o].id);k.setValue(l),h.push({oldValue:m,newValue:l})}var p=this._getMiniPartsOfField(f,a.fieldName);_.each(p,function(a){this.resources.W.Editor.doDeleteComponent(a)}.bind(this));var q=d.getTypesManager().getType(f),r=Object.clone(q);r.fields=r.fields.filter(function(b){return b.name!==a.fieldName});var s=g.updateType(r);this.resources.W.Commands.executeCommand("WAppsEditor2Commands.Undo.FieldRemoved",{viewRepo:i,dataProvider:g,comp:c,fieldName:a.fieldName,modifiedViews:h,modifiedItems:s,typeNewValue:r,typeOldValue:q})}finally{W.UndoRedoManager.endTransaction(e)}}.bind(this);this._beforeDeleteField(d,f,h)},_beforeDeleteField:function(a,b,c){var d=a.getAppPartDefinitions().countAppPartOfType(b,!1),e=a.getFormDefinitions().countFormOfType(b);d+e>0?this._openPromptDialog(this.localize("CONFIRM_REMOVE_FIELD_TITLE"),this.localize("CONFIRM_REMOVE_FIELD_DESCRIPTION"),"",this.resources.W.EditorDialogs.DialogButtonSet.DELETE_CANCEL,function(a){("DELETE"==a.result||"$AUTOMATED$"==a.result)&&c()},this._userExperience.KEYS.DELETE_FIELD_CONFIRM):c()},_getMiniPartsOfField:function(a,b){var c=this.resources.W.Preview.getSiteNode().getElements("[comp=wixapps.integration.components.common.minipart.viewer.MiniPart]");return _(c).map("$logic").compact().filter(function(c){return c.getType()===a&&c.getRawData().field===b}).value()}})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.ListsNewServerBaseUrl",function(a,b){a.binds(["_onDataItemChanged","_addDataItemChangeEvent","_removeDataItemChangeEvent","_reportAddPartToBi","_onPartCopied","_convertViewToMobile","_updateAppRepo","_updateDataStore"]),a.methods({saveDraft:function(a,b,c,d,e){var f=this,g=this._getApps2Manager();this.getAppBuilderApplicationInstance(function(h){var i=g.getClientSpecMapEntry(),j=f._validateBeforeSaveDraft(a,h,i,c);return j?(e("",j),void 0):(f._reportStartSave(a,h.getInstanceId(),c,b),h.setApplicationId(i.applicationId),h.setInstanceId(i.instanceId),h.setIsStubStore(!1),Q.resolve().then(function(){f.performCleanup(h)}).then(function(){var d=W.ClipBoard.getClip();d&&d.data&&"AppBuilderComponent"===d.data.type&&W.ClipBoard.resetClip();var e={appInstance:h,isOverride:b,isFirstSave:c,metasiteId:a};return Q.resolve(e)}).then(f._updateAppRepo).then(f._updateDataStore).done(d,function(a){a.code?e(a.description,a.code,a.payload):e("Non-recoverable wixapps error",1970)}),void 0)})},_takeRevisionSnapshot:b.remove()})}),define.experiment.Class("wixapps.integration.managers.WixAppsEditorManager2.ShowHideFieldEditor",function(a,b){a.binds(b.merge(["_updateAppRepo"])),a.methods({_registerCommands:function(){this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.CreateAppFromTemplate",this,this._onCreateAppPart),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.CreateAppByType",this,this._onCreateAppPartByType),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.AddExtraField",this,this._onAddExtraField),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.HideField",this,this._onHideField),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.ShowField",this,this._onShowField),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.MoveField",this,this._onMoveField),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.DeleteField",this,this._onDeleteField),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenChooseTemplateDialog",this,this._openChooseTemplateDialog),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenAppBuilderManageDialog",this,this._openAppBuilderManageDialog),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.CloseAppBuilderManageDialog",this,this._closeAppBuilderManageDialog),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.RefreshAppBuilderManageDialog",this,this._refreshAppBuilderManageDialog),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.AddNewDataItem",this,this._onAddNewDataItem),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.RemoveDataItem",this,this._onRemoveDataItem),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.CreateAppPage",this,this._createAppPage),this.resources.W.Commands.registerCommandAndListener("WEditorCommands.BeforeDeletePage",this,this._deleteAppPage),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.DataItemSelectionRequested",this,this._onDataItemSelectionRequested),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.EditPageTemplate",this,this._onEditPageTemplate),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.AppBuilderTypeNameChanged",this,this._onAppBuilderTypeNameChanged,null,!0),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenItemsList",this,this._openItemsPanel),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenDesignList",this,this._openDesignPanel),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenOptionsList",this,this._openOptionsPanel),this.resources.W.Commands.registerCommandAndListener("WAppsEditor2Commands.OpenEditItem",this,this._openEditItem),this.resources.W.Commands.registerCommandListenerByName("WEditorCommands.SetViewerMode",this,this._viewerModeChanged)},saveDraft:function(a,b,c,d,e){var f=this,g=this._getApps2Manager();this.getAppBuilderApplicationInstance(function(h){var i=g.getClientSpecMapEntry(),j=f._validateBeforeSaveDraft(a,h,i,c);return j?(e("",j),void 0):(f._reportStartSave(a,h.getInstanceId(),c,b),h.setApplicationId(i.applicationId),h.setInstanceId(i.instanceId),h.setIsStubStore(!1),Q.resolve().then(function(){f.performCleanup(h)}).then(function(){var d=W.ClipBoard.getClip();d&&d.data&&"AppBuilderComponent"===d.data.type&&W.ClipBoard.resetClip();var e={appInstance:h,isOverride:b,isFirstSave:c,metasiteId:a};return Q.resolve(e)}).then(f._updateAppRepo).then(f._updateDataStore).done(d,function(a){a.code?e(a.description,a.code,a.payload):e("Non-recoverable wixapps error",1970)}),void 0)})},_updateAppRepo:function(a){var b=Q.defer(),c=a.appInstance.getInstanceId();if(a.appInstance.isDirty()){var d=function(c){try{a.appInstance.setAppInstanceVersion(c.applicationInstanceVersion),this._reportSaveRepoToBi(a.appInstance,a.isFirstSave)}catch(d){console.error("can't send save repo BI",d)}b.resolve(a)}.bind(this),e=function(a){b.reject(a)}.bind(this);this._reportBeforeSaveRepo(a.metasiteId,c,a.isOverride),this._appRepoTransport.updateInstance(a.appInstance,c,a.isOverride,d,e)}else this._reportSkipSaveRepo(a.metasiteId,c),b.resolve(a);return b.promise},_onChangeVisibilityField:function(a,b,c){var d=a.getViewDefinition(),e=d.getValue(),f=a.getAppInstance();W.UndoRedoManager.startTransaction();var g=Object.clone(e);this._viewBuilder.changeFieldVisibility(g,b,c),d.setValue(g),W.Commands.executeCommand("WAppsEditor2Commands.Undo.ViewDefinitionChange",{viewRepo:f.getViewDefinitions(),oldValue:e,newValue:g,appPart:a}),W.UndoRedoManager.endTransaction()},_onHideField:function(a){var b=a.appPart,c=a.fieldId;this._onChangeVisibilityField(b,c,!1)},_onShowField:function(a){var b=a.appPart,c=a.fieldId;this._onChangeVisibilityField(b,c,!0)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsManager.EcomArtifactDeploy",function(a){var b=a;b.methods({requestAppDescriptor:function(a,b){return this._appDescriptorMap[a]?(b(this._appDescriptorMap[a]),void 0):(this.resources.W.Data.getDataByQuery("#WIXAPPS_EXTERNAL_APPS",function(c){var d=c.get("items")[a];if("ecommerce"==a){var e=this;this.resource.getResourceValue("ecommerceDescriptor",function(a){e.registerAppDescriptor(a),b&&b(a)})}else if(void 0!==d)this._loadExternalAppManifest(a,d.descriptorResourceName,b);else{var f=this._buildDescriptorURL(a);this._loadDescriptorFile(f,a,b)}}.bind(this)),void 0)}})}),define.experiment.Class("wixapps.integration.managers.WixAppsManager2.BlinkyFormContainerEditor",function(a,b){a.utilize(b.merge(["wixapps.core.types.AppBuilderTypesHelper"])),a.resources(b.merge(["W.Utils"])),a.fields({_typesHelper:null}),a.methods({initialize:b.after(function(){this._typesHelper=new this.imports.AppBuilderTypesHelper,this._registerCommands()}),_registerCommands:function(){this.resources.W.Commands.registerCommandAndListener("WApps2Commands.AddNewDataItem",this,this._onAddNewDataItem)},_addCreatedAndUpdatedAt:function(a){var b=this.getServerDate().toISOString();return a._updatedAt=b,a._createdAt=b,a},_getDataItemDefaultValue:function(a,b){var c={_iid:this.resources.W.Utils.AppsUtils.getTimeBasedUniqueId(),_type:a,_tags:[]};return this._addCreatedAndUpdatedAt(_.merge(c,b))},_onAddNewDataItem:function(a){if(!this._addItemProccessInitiated){var b=a.comp,c=b.getAppInstance(),d=b.getDataSelector(),e=d.getSelectionType(),f=this._getDataItemDefaultValue(e,a.rawData),g=a.dataSelectors;if(!g){var h=d.getSelectedItemIndex(),i=a.itemIndex;!i&&h>=0&&("AddBefore"===a.action?i=h:"AddAfter"===a.action&&(i=h+1)),g=[{index:i||0,dataSelector:d}];var j=c.getDataSelectors().getByType(e);_.each(j,function(a){a!==d&&g.push({index:0,dataSelector:a})}),g=_.filter(g,function(a){return a.dataSelector.isListSelector()})}var k=c.getTypesManager().getType(e),l=this._typesHelper.getDisplayableFields(k);if(0!==l.length){this._addItemProccessInitiated=!0;var m=c.getDataItemFactory(),n=m.createDataItem(f);c.getTypesManager().applyDefaults(n);var o=d.getDataProvider();o.createItem(n,function(b){_.each(g,function(a){a.dataSelector.addItem(b,a.index,d)}),this._reportItemAdded(c,a.compId,e,a.addedFrom),a.onDataItemAdded&&a.onDataItemAdded(b,o,g),this._addItemProccessInitiated=!1}.bind(this),function(b,c){this._logger.reportError({code:b,description:c},this.$className,"_onAddNewDataItem",this._logger.SubCategory.DATA_ITEMS,this._logger.Severity.RECOVERABLE,this._logger.Category.EDITOR),a.onError&&a.onError(),this._addItemProccessInitiated=!1}.bind(this))}}},_reportItemAdded:function(a,b,c){var d=this.getAllItemsOfTypeDataSelector(c,a),e={c1:c,c2:b,g1:a.getInstanceId(),i1:d.getItemsIdsLocally().length};this._logger.reportEvent(this._logger.Events.APP_BUILDER_ITEM_ADDED,e)}})}),define.experiment.Class("wixapps.integration.managers.undoredomanager.AppBuilderChange.AppBuilderDeleteType",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({initialize:b.after(function(){this.resources.W.Commands.registerCommand("WAppsEditor2Commands.Undo.TypeDeleted",!0)}),startListen:b.after(function(){this.resources.W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.TypeDeleted",this,this._onTypeDeleted)}),_onTypeDeleted:function(a){var b={type:this.className,changeType:"TypeDeleted",appInstance:a.appInstance,deletedTypeName:a.typeName,deletedTypeObj:a.typeObj,deletedItemsOfType:a.itemsOfType,deletedDataSelectors:a.dataSelectors,deletedPartDefs:a.partDefs,deletedPageDefs:a.pageDefs,deletedViewDefs:a.viewDefs};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,b),b},_applyRecreateDeletedType:function(a,b,c,d,e,f,g){a.restoreType(b,c,d,e,f,g)},_applyDeleteType:function(a,b){var c=function(){};a.deleteType(b,c,c,!0)},undo:b.after(function(a){"TypeDeleted"===a.changeType&&this._applyRecreateDeletedType(a.appInstance,a.deletedTypeObj,a.deletedItemsOfType,a.deletedDataSelectors,a.deletedPartDefs,a.deletedPageDefs,a.deletedViewDefs)}),redo:b.after(function(a){"TypeDeleted"===a.changeType&&this._applyDeleteType(a.appInstance,a.deletedTypeName)})})}),define.experiment.Class("wixapps.integration.managers.undoredomanager.AppBuilderChange.AppBuilderTagsEditor",function(a,b){a.resources(b.merge(["W.Commands"])),a.methods({initialize:b.after(function(){this.resources.W.Commands.registerCommand("WAppsEditor2Commands.Undo.DataSelectorChanged",!0)}),startListen:b.after(function(){this.resources.W.Commands.registerCommandListenerByName("WAppsEditor2Commands.Undo.DataSelectorChanged",this,this._onDataSelectorChanged)}),_onDataSelectorChanged:function(a){var b={type:this.className,changeType:"DataSelectorChanged",newValue:a.newValue,oldValue:a.oldValue,appPart:a.appPart,changedComponentIds:[a.appPart.getComponentId()]};return this.fireEvent(Constants.UrmEvents.DATA_CHANGE_RECORDED,b),b},_applyDataSelectorChanged:function(a,b){b.setDataSelector(a)},_applyDataItemEvents:function(a,b){function c(a){var b=a.getParent();return b?c(b):a}var d=c(a),e=a.getValue();_.each(b,function(a){if(a.newValue)e=a.newValue;else switch(a.action){case Constants.DataItemEvents.CHANGE_EVENT_ACTION_ADD:_.has(a,"index")?e.splice(a.index,0,a.child.getValue()):e[a.ref]=a.child.getValue();break;case Constants.DataItemEvents.CHANGE_EVENT_ACTION_DELETE:_.has(a,"index")?e.splice(a.index,1):delete e[a.ref];break;case Constants.DataItemEvents.CHANGE_EVENT_ACTION_MOVE:var b=e.splice(a.to,1)[0];e.splice(a.index,0,b);break;case Constants.DataItemEvents.CHANGE_EVENT_ACTION_REPLACE:_.has(a,"index")?e[a.index]=a.child.getValue():e[a.ref]=a.child.getValue();break;default:throw"Can't get the old value of action: "+a.action}});var f=d.getValue();a.setValue(e),this.resources.W.Commands.executeCommand("WAppsEditor2Commands.DataItemUpdated",{oldValue:f,dataItem:d})},undo:b.after(function(a){"DataSelectorChanged"===a.changeType&&this._applyDataSelectorChanged(a.oldValue,a.appPart)}),redo:b.after(function(a){"DataSelectorChanged"===a.changeType&&this._applyDataSelectorChanged(a.newValue,a.appPart)})})}),define.experiment.Class("wixapps.integration.proxies.ButtonProxy.OBC_SiteButton.New",function(a){var b=a;b.methods({_getCompName:function(){return"wysiwyg.viewer.components.SiteButtonOBC"}})}),define.experiment.Class("wixapps.integration.proxies.CheckBoxProxy.AppBuilderTagsEditor",function(a){a.methods({_setupPropertyHandlers:function(){this.parent();var a=this;this._handleProperty("label",function(b){a._componentLogic.setLabel(b)}),this._handleProperty("indeterminate",function(){a._refresh()})},_createRawData:function(){var a=this._def.getChildValue("indeterminate");return{type:"CheckBox",value:this._data.getValue(),indeterminate:a===!0||"true"===a}},_getAcceptableDataTypes:function(){return["Boolean","CheckBox"]}})}),define.experiment.Class("wixapps.integration.proxies.CheckBoxProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.CheckBoxGroupProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.ComboBoxProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.DateSelectorProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.GridGalleryProxy.WixAppsGalleries.New",function(a){a.methods({_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["transition","autoplayInterval","transDuration","columns","rows","gap"]),this._mapToCompProperty("showNavigation","showNavigation",function(a){return!(a===!1||"false"==a)}),this._mapToCompProperty("showCounter","showCounter",function(a){return!(a===!1||"false"==a)})},_stylesMap:{"default":{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridDefaultSkin"},productGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridSimple",style:"pgg_cg0"},contentGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg1"},minipostGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg2"},hoverGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoBG",style:"pgg_cg3"},blogGallery:{skin:"wysiwyg.viewer.skins.paginatedgrid.PaginatedGridNoDetail",style:"pgg_cg4"}},_getDefaultSkinName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].skin},_getDefaultStyleName:function(){var a=this._def.getChildValue("styleNS")||"default";return this._stylesMap[a].style}})}),define.experiment.newClass("wixapps.integration.proxies.MultiSelectionProxy.AppBuilderTagsEditor",function(a){a.inherits("wixapps.integration.proxies.WProxy"),a.resources(["W.Data"]),a.utilize(["wixapps.core.utils.WixAppsLogger"]),a.fields({_logger:null}),a.methods({initialize:function(a,b,c,d){this._logger=new this.imports.WixAppsLogger,this.parent(a,b,c,d),this._keyField="value",this._fields=["value","text","selected"],this._itemDataType="SelectOption"},createComponent:function(){return this.items=this._translateToWysiwyg(),this._createWixComponent(this._getComponentType(),{type:"MultiSelectableList",items:this.items})},_onComponentWixified:function(){this._componentLogic.on("itemCreated",this,this._onItemCreated),this._componentLogic.on("itemSelected",this,this._onItemSelected),this._componentLogic.on("itemRemoved",this,this._onItemRemoved)},_onItemCreated:function(a){this._data.addChild(this._translateFromWysiwyg(a))},_onItemRemoved:function(a){this._data.replaceChild(this._translateFromWysiwyg(a),this._getChildIndex(a))},_onItemSelected:function(a){this._data.replaceChild(this._translateFromWysiwyg(a),this._getChildIndex(a))},_getChildIndex:function(a){var b=this._keyField,c=a.data.item.getData()[b];return _.findIndex(this._data.getChildren(),function(a){return a.getChildValue(b)===c})},_getComponentType:function(){return"wysiwyg.common.components.multiselection.viewer.MultiSelection"},_getPropSchemaName:function(){return"MultiSelectionProperties"},_processPropValue:function(a,b){return"selectionOnly"===a?"true"===b||b===!0:b},_setupPropertyHandlers:function(){this.parent(),this._mapToCompProperties(["selectionOnly","placeholder","newItemText"])},_translateToWysiwyg:function(){var a=this;return _(this.getData().getChildren()).map(function(b){var c={type:a._itemDataType};return _.each(a._fields,function(a){c[a]=b.getChildValue(a)}),a.resources.W.Data.createDataItem(c)}).value()},_translateFromWysiwyg:function(a){var b={};return _.each(this._fields,function(c){b[c]=a.data.item.getData()[c]}),b}})}),define.experiment.Class("wixapps.integration.proxies.OptionListInputProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.OptionsListProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.PaginatedListProxy.ServerPagination",function(a,b){a.fields({_pagination:b.remove()}),a.binds(["_nextPage","_previousPage"]),a.methods({initialize:function(a,b,c,d){this._def=c,this._logger=new this.imports.WixAppsLogger,this._viewContext=a,this.parent(a,b,c,d),this._initEvents()},_initEvents:function(){this.addEventFilteredByScope("descendant","nextPageClicked",this._nextPage),this.addEventFilteredByScope("descendant","prevPageClicked",this._previousPage)},_initEnvironmentVariables:b.remove(),_onComponentWixified:b.remove(),_getShouldUsePagination:b.remove(),_getLogicArgs:b.remove(),_getPaginationLogic:b.remove(),_onTogglePagination:b.remove(),_reportUserToggledPagination:b.remove(),_onItemsPerPageChanged:b.remove(),_nextPage:function(){this.getViewContext().getEnvironment().getEventsDispatcher().fireEvent("nextPage"),this._scrollToTop()},_previousPage:function(){this.getViewContext().getEnvironment().getEventsDispatcher().fireEvent("previousPage"),this._scrollToTop()},dispose:function(){this.removeEvent("nextPageClicked",this._nextPage),this.removeEvent("prevPageClicked",this._previousPage),this.parent()}})}),define.experiment.Class("wixapps.integration.proxies.ProxyMap.AppBuilderTagsEditor",function(a,b){a.utilize(b.merge(["wixapps.integration.proxies.TagInput2Proxy","wixapps.integration.proxies.MultiSelectionProxy"])),a.methods({registerComponentProxies:b.after(function(a){a.registerProxy("TagInput2",this.imports.TagInput2Proxy,""),a.registerProxy("MultiSelection",this.imports.MultiSelectionProxy,"")})})}),define.experiment.Class("wixapps.integration.proxies.ProxyMap.EcomGalleries.New",function(a){a.methods({_registerGalleryProxies:function(a){"ecommerce"==a.getNameSpace()?(a.registerProxy("Gallery",this.imports.GridGalleryProxy,"Array"),a.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array"),a.registerProxy("ColumnGallery",this.imports.ColumnGalleryProxy,"Array")):(a.registerProxy("Gallery",this.imports.GalleryProxy,"Array"),a.registerProxy("GridGallery",this.imports.GridGalleryProxy,"Array"),a.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array"),a.registerProxy("ColumnGallery",this.imports.ColumnGalleryProxy,"Array"),a.registerProxy("PaginatedColumnGallery",this.imports.PaginatedColumnGalleryProxy,"Array"))}})}),define.experiment.Class("wixapps.integration.proxies.ProxyMap.WixAppsGalleries.New",function(a){a.methods({_registerGalleryProxies:function(a){a.registerProxy("Gallery",this.imports.GridGalleryProxy,"Array"),a.registerProxy("SliderGallery",this.imports.SliderGalleryProxy,"Array"),a.registerProxy("ColumnGallery",this.imports.ColumnGalleryProxy,"Array")}})}),define.experiment.Class("wixapps.integration.proxies.RichTextEditorProxy.funtextico",function(a,b){var c=a;c.methods({dispose:function(){this._componentLogic&&this._componentLogic.getSkinPart("richTextContainer").removeEvent(Constants.CoreEvents.CLICK,this._onPreviewClicked),this._editorLogic&&(this._editorLogic.dispose(),this._editorLogic=null),this.parent()},_createRTEditorComponent:function(){var a=W.Data;W.Editor&&(a=W.Preview.getPreviewManagers().Data),this._updateLinkDataItems(a);var b=new Element("DIV");b.set("comp","wysiwyg.editor.components.richtext.WRichTextEditor"),b.set("skin","wixapps.integration.skins.editor.WRichTextEditorAppBuilderSkin"),b.set("pos",""),this._editorElement=b,this._editorElement.addEvent(Constants.ComponentEvents.WIXIFIED,function(){}.bind(this)),this._editorElement.addEvent(Constants.ComponentEvents.READY,function(){this._editorLogic=b.getLogic(),this._editorLogic.addEvent("richTextEditorReady",function(){this._componentLogic.getSkinPart("richTextContainer").setStyle("visibility","hidden")}.bind(this)),this._scrollContainer=this._findFirstScrollerContainer(),this._notifyEditorReady()}.bind(this)),this._componentLogic.getSkinPart("frame").grab(b);var c={isFixedHeight:!0,isPersistent:!1,generateLinkIdFunc:this._linkIdGenerator,getDataOnCKChange:!0,addTextBackground:!1,shouldCloseOnlyInComponentsPanel:!0};this._editorElement.wixify(c,this._editorData)}})}),define.experiment.Class("wixapps.integration.proxies.SliderGalleryProxy.WixAppsGalleryField",function(a,b){a.traits(["wixapps.integration.components.traits.ResizableProxyTrait"]),a.utilize(["wixapps.integration.utils.ImageListDataUtils"]),a.binds(b.merge(["_updateComponentSize"])),a.fields({_imageListUtils:null}),a.methods({initialize:function(a,b,c,d){this.parent(a,b,c,d),this._imageListUtils=new this.imports.ImageListDataUtils},createComponent:function(){var a=this._viewContext.getEnvironment().getEventsDispatcher();a.addEvent(Constants.WixAppEvents.APP_VIEW_READY,this._updateComponentSize);var b=this._createWixComponent("wixapps.integration.components.SelectableSliderGallery",this._createRawData(this._data.getValue()),null);return b.setStyle("position","relative"),b},_createRawData:function(a){return _.forEach(a,function(a){a.src=this._resolveResourcePath(a.src)},this),this._imageListUtils.createImageListDataFromAppsImagesData(a)},_resolveResourcePath:function(a){return this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(a)},_setupPropertyHandlers:b.after(function(){this._mapToCompProperties(["imageMode","aspectRatioPreset","maxSpeed","loop","galleryImageOnClickAction","margin"])}),_getDefaultStyleName:function(){return"sg1"},_isLayoutBasedWidth:function(){return!0},_isLayoutBasedHeight:function(){return!0},_onDataChanged:function(){if(this._componentLogic){var a=this._data.getValue();this._componentLogic.getDataItem().set("items",this._createRawData(a).items)}},dispose:function(){var a=this._viewContext.getEnvironment().getEventsDispatcher();a.removeEvent(Constants.WixAppEvents.APP_VIEW_READY,this._updateComponentSize),this.parent()},_getWImage:b.remove()})}),define.experiment.newClass("wixapps.integration.proxies.TagInput2Proxy.AppBuilderTagsEditor",function(a){a.inherits("wixapps.integration.proxies.WProxy"),a.binds(["_onItemCreated","_onItemSelected","_onItemRemoved"]),a.resources(["W.Commands"]),a.utilize(["wixapps.core.utils.WixAppsLogger"]),a.fields({_logger:null}),a.methods({initialize:function(a,b,c,d){this._logger=new this.imports.WixAppsLogger,this._ignoreChanges=!1,this.parent(a,b,c,d)},_createAllTags:function(){var a=_.mapValues(this._def.getChildValue("tagMapping"),function(a){return{tag:a,selected:!1}});return _.each(this.getData().getValue(),function(b){a[b].selected=!0}),_(a).keys().map(function(b){return W.Data.createDataItem({type:"SelectOption",value:b,text:a[b].tag,selected:a[b].selected})}).value()},createComponent:function(){return this._createWixComponent(this._getComponentType(),{type:"MultiSelectableList",items:this._createAllTags()})},_onComponentWixified:function(){this._componentLogic.setComponentProperty("newItemText",W.AppsEditor2.localize("EDITOR_TAG_NEW_TAG_TEXT")),this._componentLogic.setComponentProperty("placeholder",W.AppsEditor2.localize("EDITOR_TAG_INPUT_PLACEHOLDER")),this._componentLogic.on("itemCreated",this,this._onItemCreated),this._componentLogic.on("itemSelected",this,this._onItemSelected),this._componentLogic.on("itemRemoved",this,this._onItemRemoved)},_onItemCreated:function(a){this._ignoreChanges=!0;var b=function(b){this.getData().addChild(b),a.data.item.getData().value=b}.bind(this);this.resources.W.Commands.executeCommand("WAppsEditor2Commands.CreateTag",{displayName:a.data.item.get("text"),callback:b}),this._ignoreChanges=!1,this._logger.reportEvent(this._logger.Events.TAG_ADDED_TO_ITEM)},_onItemRemoved:function(a){this._ignoreChanges=!0;var b=_.findIndex(this.getData().getChildren(),function(b){return b.getValue()===a.data.item.get("value")});this.getData().deleteChild(b,1),this._ignoreChanges=!1,this._logger.reportEvent(this._logger.Events.TAG_REMOVED_FROM_ITEM)},_onItemSelected:function(a){this._ignoreChanges=!0,this.getData().addChild(a.data.item.get("value")),this._ignoreChanges=!1,this._logger.reportEvent(this._logger.Events.TAG_ADDED_TO_ITEM)},_getComponentType:function(){return"wysiwyg.common.components.multiselection.viewer.MultiSelection"},_onDataChanged:function(){this._ignoreChanges||this._componentLogic.getDataItem().set("items",this._createAllTags())}})}),define.experiment.Class("wixapps.integration.proxies.TextAreaProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.TextInputProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.TimeSelectorProxy.MediaZoomDispose.New",function(a){a.methods({dispose:function(){this._disposed||(this._data.removeEvent(Constants.DataItemEvents.VALIDATION_PERFORMED,this._onValidation),this.parent())}})}),define.experiment.Class("wixapps.integration.proxies.WIntegrationTrait.AppBuilderTags",function(a){a.methods({_applyStyle:function(a,b){if(a){var c={};Object.each(b,function(a,b){if("width"==b||"height"==b)"string"!=typeOf(a)||String.contains(a,"%")||"auto"===a||(a=parseInt(a,10));else if("background"===b||"background-image"===b){var d=/url\((.+)\)/i;if(d.test(a)){var e=_.last(d.exec(a)),f=this._viewContext.getEnvironment().getProxyFactory().resolveResourcePath(e);a=a.replace(e,f)}}c[b]=a}.bind(this)),a.setStyles(c)}}})}),define.experiment.Class("wixapps.integration.proxies.layout.FieldBoxProxy.ShowHideFieldEditor",function(a){a.methods({_rewriteDefinition:function(a,b,c){function d(a){return!a.comp.hidden||"false"===a.comp.hidden}var e={},f=b.orientation||"vertical";e.name="Box",e.orientation="vertical"==f?"vertical":"horizontal",e.items=_.filter(b.items,d)||[],e.events=b.events||{};for(var g=0;g<e.items.length;g++){var h=e.items[g];if(["Field","TextField"].contains(h.comp.name)){h.comp.orientation=f;var i=c.getEnvironment().getProxyFactory().getProxyClassByName(h.comp.name);if(i.getLayoutDefinitions){var j="rtl"===c.getEnvironment().getVar("partDirection"),k=i.getLayoutDefinitions(h.comp,j);h.layout=h.layout||{},h.layout=Object.merge({},h.layout,k)}}}if(b.pack&&(e.pack=b.pack),e.css=e.css||{},"vertical"==f&&this._isWidthAmbiguous()&&this._hasChildContent(e)){var l=this._findMaxManualWidth(e);e.css.width=String(l)}else e.css.width="auto";return e}})}),define.experiment.Class("wixapps.integration.proxies.layout.TextFieldProxy.NewListFields",function(a,b){a.statics({_isEmptyValue:function(a){var b=this._typeEmptyCheckers[a.getTypeName()];return b&&b(a)},_typeEmptyCheckers:{"wix:Date":function(a){return _.isEmpty(a.getChildValue("iso"))},String:function(a){return _.isEmpty(a.getValue())},"wix:RichText":function(a){_.isEmpty(a.getChildValue("text"))}}}),a.methods({_rewriteDefinition:function(a,b,c,d){if(!b.items||1!==b.items.length)throw"field proxy accepts exactly one child";var e=b["width-mode"]||"auto";void 0===this._lastWidthMode&&(this._lastWidthMode=e),this._lastWidthMode!==e&&(this._lastWidthMode=e,this._requestReloadAfterNextRewrite());var f={},g=b.orientation||"vertical",h="vertical"==g,i=c.getEnvironment().getVar("partDirection"),j=i&&"rtl"===i.getValue();f.name=h?"Css":"Box",h||(f.orientation="horizontal"),f.hidden=b.hidden===!0||"true"===b.hidden||this._isEmptyValue(a),f.events=b.events||{},f.items=[],f.css=this._rewriteSpacers(b,j).xax,h&&(f.css.display="block");var k=b.items[0],l="manual"===e,m=this._rewriteBoxAlignment(b["box-align"]||"start",h);return f=_.merge(f,m),k.layout=k.layout||{},l?k.layout.width=void 0!==b.width?parseInt(b.width,10):this.defaultManualWidth:h?k.layout.width="100%":k.layout["box-flex"]=1,this._setActualComponentName(b,k,a),f.items.push(this._linkify(k,d,b.pageLink)),f},_setActualComponentName:function(a,b,c){var d=void 0!==a["height-mode"]?a["height-mode"]:"auto",e=parseInt(a["min-lines"],10)||0,f=parseInt(a["max-lines"],10)||0;f>0&&e>f&&(f=e);var g=parseInt(a["max-chars"],10)||100,h=parseInt(a["min-height"],10)||100;b.comp.name=c&&c.getChildValue&&"wix:Date"===c.getChildValue("_type")?"Date":"Label","auto"==d?(b.comp.singleLine=!1,b.layout.height="auto"):"lines"===d&&0===e&&1===f&&"String"===c.getTypeName()?b.comp.singleLine=!0:"max-chars"===d?(b.comp.name="ClippedParagraph2",b.comp["max-chars"]=g,b.layout["min-height"]=h):"fixed-height"==d?(b.layout["min-height"]=0,b.comp.name="Label",b.layout.height=void 0!==a.height?parseInt(a.height,10):this.defaultManualHeight,b.layout["overflow-y"]="hidden"):"pixels"==d?(b.comp.name="ClippedParagraph",b.comp.minLines=0,b.comp.maxLines=0,b.layout.height=void 0!==a.height?parseInt(a.height,10):this.defaultManualHeight):"lines"==d&&f>0&&(b.comp.name="ClippedParagraph",b.comp.minLines=e,b.comp.maxLines=f)
},_isHiddenInDef:b.remove(),_shouldHide:b.remove()})}),define.experiment.Class("wixapps.integration.proxies.traits.AppsLinkTrait.WixAppsGalleryField",function(a,b){var c=a,d=b;c.utilize(d.merge(["wixapps.integration.utils.LinksUtils"])),c.fields({_linksUtils:null}),c.methods({_getLinksUtils:function(){return this._linkUtils?this._linkUtils:this._linkUtils=new this.imports.LinksUtils},_createWLink:function(a,b){b=b||W.Data;var c=this._getLinksUtils().convertAppsLinkToWLink(a);if(!c)return null;var d=b.addDataItem(a.linkId,c);return d.setMeta("isPersistent",!1),d},_createAppsLink:function(a){var b=this._getLinksUtils().convertWLinkToAppsLink(a.getData()),c=this._viewContext.getEnvironment().getDataItemFactory();return c.createDataItem(b)},_createRawLinkData:d.remove()})}),define.experiment.skin("wixapps.integration.skins.WixAppsButtonSkin.NBC_SiteButton.New",function(a){var b=a;b.inherits("core.managers.skin.BaseSkin2")}),define.experiment.Class("wixapps.integration.utils.MediaTextDataUtils.BlogManager",function(a){a.methods({_createImageWDataItems:function(a,b){for(var c=this.getImageJsonDataArray(a),d=0;d<c.length;d++){var e=c[d].dataQuery;if(!this.getDataManager().getDataByQuery("#"+e)){var f=this._createImageWDataItem(e,b.imageList[d],c[d].linkDataQuery);this._createImagePropertiesItem(e),f.setMeta("isPersistent",!1)}}},_createImageWDataItem:function(a,b,c){var d={type:"Image",uri:b.src,title:b.title,description:"",width:b.width,height:b.height,link:c};return this.getDataManager().addDataItemWithId(a,d)},getMediaPostPseudoType:function(a){var b=this.getCompCoverPhoto(a),c=this.TypesMap[b.componentType];return c||this.TypesMap["default"]},convertMediaPostForView:function(a,b){if("MediaPost"!==a.getTypeName())return a;var c=_.clone(a.getValue()),d=this.getMediaPostPseudoType(c.mediaText.text),e=this.cleanText(c.mediaText.text);if(c.text.text=e,c._type="TextPost","TextPost"!==d){var f=this.getCoverImage(c.mediaText.text);"VideoPost"===d&&c.mediaText.videoList.length?(c._type="VideoPost",c.video=_(c.mediaText.videoList).filter(function(a){return _.contains(f,a.videoId)}).compact().first()||c.mediaText.videoList[0],c.isHD=!1):"PhotoPost"===d&&c.mediaText.imageList.length&&(c._type="PhotoPost",c.photo=_(c.mediaText.imageList).filter(function(a){return _.contains(f,a.src)}).compact().first()||c.mediaText.imageList[0])}return b.createDataItem(c)}})}),define.component("Editor.wixapps.integration.components.common.formcontainer.viewer.FormContainer",function(a,b){var c=a,d=b;c.panel({logic:"wixapps.integration.components.common.formcontainer.editor.FormSettingsPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin",manageOwnScroll:!0}),c.styles(1),c.helpIds({componentPanel:"/node/18990"}),c.methods({initialize:d.after(function(){this.EDITOR_META_DATA=_.merge(this.EDITOR_META_DATA,{general:{animation:!1},mobile:{disablePropertySplit:!0}})}),isDeleteableRecurse:function(){if(!this.isDeleteable())return!1;var a=_(this.getViewNode().getElements("[comp]")).map("$logic").filter(function(a){return a&&"wixapps.integration.components.common.submitbutton.viewer.SubmitButton"!==a.$className}).value();return this._isDeleteableRecurse(a)},getShowOnAllPagesChangeability:function(){if(!this._showOnAllPagesChangeability)return!1;for(var a=_(this.getChildComponents()).map("$logic").filter(function(a){return a&&"wixapps.integration.components.common.submitbutton.viewer.SubmitButton"!==a.$className&&"wixapps.integration.components.common.minipart.viewer.MiniPart"!==a.$className}).value(),b=0;b<a.length;b++)if(!a[b].getShowOnAllPagesChangeability())return!1;return!0}})}),define.component("Editor.wixapps.integration.components.common.minipart.viewer.MiniPart",function(a,b){var c=a,d=b;c.panel({logic:"wixapps.integration.components.common.minipart.editor.MiniPartSettingsPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin",manageOwnScroll:!0}),c.styles(1),c.helpIds({componentPanel:"/node/18990"}),c.methods({initialize:d.after(function(){this._resizableSides=[Constants.BaseComponent.ResizeSides.LEFT,Constants.BaseComponent.ResizeSides.RIGHT],this.EDITOR_META_DATA=_.merge(this.EDITOR_META_DATA||{},{general:{design:!1,animation:!1,forceHideIconOnRemove:!0}})}),isDeleteable:function(){return this.resources.W.Config.env.$viewingDevice!==Constants.ViewerTypesParams.TYPES.MOBILE},canBeDraggedIntoContainer:function(){return!1},getFormContainer:function(){function a(b){var c=b.getParentComponent();return c?"wixapps.integration.components.common.formcontainer.viewer.FormContainer"===c.$className?c:a(c):null}return a(this)}})}),define.component("Editor.wixapps.integration.components.common.submitbutton.viewer.SubmitButton",function(a,b){var c=a;c.panel({logic:"wixapps.integration.components.common.submitbutton.editor.SubmitButtonPanel",skin:"wysiwyg.editor.skins.panels.base.AutoPanelSkin"}),c.styles(1),c.helpIds({componentPanel:"/node/18990"}),c.methods({isDeleteable:function(){return!1},getShowOnAllPagesChangeability:function(){return!1},canBeDraggedIntoContainer:function(){return!1}})}),define.component("Editor.wixapps.integration.components.AppPage",function(a,b){a.methods({initApp:b.after(function(){this._pageDefinition&&this._pageEnvironment.getBundledPagesIds&&this._loadBundledPages()}),_loadBundledPages:function(){var a=this._pageEnvironment.getBundledPagesIds(this._pageDefinition);_.each(a,function(a){this.resources.W.Commands.executeCommand("WAppsCommands.LoadAppPage",{appPageId:a})},this)}})});