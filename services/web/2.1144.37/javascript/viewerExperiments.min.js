define.experiment.component("wysiwyg.viewer.components.BgImageStrip.EditableImageInput",function(a){a.methods({_setBgImage:function(){var a=this._skinParts.bg.style;this._isFakeOrEmptyUri()?(a.backgroundImage="",this._data.set("uri","none"),this._updateMobileInputs(!0)):(this._updateMobileInputs(!1),a.backgroundImage="url("+this._baseUrl+this._data.get("uri")+")")},_updateMobileInputs:function(a){this.EDITOR_META_DATA&&(this.EDITOR_META_DATA.mobile.allInputsHidden=a)},_isFakeOrEmptyUri:function(){var a=this._data.get("uri");return!a||"none"===a},_mediaGalleryCallback:function(a){this.getDataItem().setFields({uri:a.fileName,originalImageDataRef:null})}})}),define.experiment.component("wysiwyg.viewer.components.ClipArt.EditableImageInput",function(a){a.statics({EDITOR_META_DATA:{general:{settings:!0,design:!1,proportionalResize:!0},custom:[{label:"CLIP_ART_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{commandSource:"FPP",galleryConfigID:"clipart",publicMediaFile:"clipart",i18nPrefix:"clipart",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback",startingTab:"free"}},{label:"IMAGEINPUTNEW_CLIPART_EFFECTS",command:"WEditorCommands.OpenAviaryDialog",commandParameter:{commandSource:"FPP",dialogLabel:"IMAGEINPUTNEW_CLIPART_EFFECTS"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{commandSource:"dblClick",galleryConfigID:"clipart",publicMediaFile:"clipart",i18nPrefix:"clipart",selectionType:"single",mediaType:"picture",callback:"_mediaGalleryCallback",startingTab:"free"}},mobile:{previewImageDataRefField:"*",allInputsHidden:!0}}}),a.methods({_mediaGalleryCallback:function(a){this.getDataItem().setFields({height:a.height,width:a.width,uri:a.fileName,originalImageDataRef:null}),this._logChangeMediaSuccess()}})}),define.experiment.component("wysiwyg.viewer.components.ClipArt.ProportionalScaling",function(a,b){var c=a,d=b;c.statics({EDITOR_META_DATA:d.merge({general:{proportionalResize:!0}})})}),define.experiment.component("wysiwyg.viewer.components.FooterContainer.LandingPageSupport",function(a){a.methods({toggleLandingPageMode:function(a){a?(this._serializedHeight=this.getHeight(),this.setHeight(this.MINIMUM_HEIGHT_DEFAULT)):(this.setHeight(this._serializedHeight),delete this._serializedHeight)},_getSerializedHeight:function(){return"number"==typeof this._serializedHeight?this._serializedHeight:this.getHeight()}})}),define.experiment.component("wysiwyg.viewer.components.HeaderContainer.LandingPageSupport",function(a){a.methods({toggleLandingPageMode:function(a,b){if(a){this._serializedY=this.getY();var c=this.getHeight();b?b.to(this.$view,1,{top:-c,ease:"strong_easeIn",onComplete:this.$view.setStyle.bind(this.$view,"top",-c)}):this.$view.setStyle("top",-c)}else b.to(this.$view,1,{top:this._serializedY,ease:"strong_easeIn",onComplete:this.setY.bind(this,this._serializedY)}),delete this._serializedY},_getSerializedY:function(){return"number"==typeof this._serializedY?this._serializedY:this.getY()}})}),define.experiment.component("wysiwyg.viewer.components.HorizontalMenu.DisableHorizontalMenu",function(a){var b=a;b.statics({EDITOR_META_DATA:{general:{settings:!1,design:!1,animation:!1}}})}),define.experiment.component("wysiwyg.viewer.components.MatrixGallery.ProportionalScaling",function(a,b){var c=a,d=b;c.statics({EDITOR_META_DATA:d.merge({general:{proportionalResize:!0}})})}),define.experiment.component("wysiwyg.viewer.components.MediaZoom.MediaZoomDispose",function(a,b){var c=a;c.methods({_closeZoom:function(){this.collapse(),this.injects().Viewer.exitFullScreenMode(),this.setDataItem(null),this.resetIterator(),this._emptyContainer(this._skinParts.virtualContainer),this._emptyContainer(this._skinParts.itemsContainer),this._skinParts.dialogBox.setStyles({width:"100px"}),this._opened=!1,this.unlock(),this._lastCurrentItem=null},_transitionToCurrentDisplayer:function(a){if(!this._inTransition){this._inTransition=!0,a.setStyle("opacity","0.0");var b=this._skinParts.itemsContainer,c=this,d=function(){c._emptyContainer(b);var d=a.getStyles("width","height"),f=c._getTopGap(d.height.replace("px",""));b.adopt(a),c._emptyContainer(c._skinParts.virtualContainer);var g=new Fx.Morph(c._skinParts.dialogBox,{duration:c.transitionTime,link:"chain"});g.addEvent("complete",function(){var b=new Fx.Tween(a,{duration:c.transitionTime,link:"chain"});b.addEvent("complete",function(){c.unlock(),c._inTransition=!1,b.removeEvent("complete",arguments.callee)}),b.start("opacity","1.0"),g.removeEvent("complete",arguments.callee)}),g.start({width:d.width,"min-height":d.height,"margin-top":f+"px"}),e&&e.removeEvent("complete",arguments.callee)};if(b.hasChildNodes()){var e=new Fx.Tween(b.firstChild,{duration:c.transitionTime,link:"chain",property:"opacity"});e.addEvent("complete",d),e.start("0.0")}else d()}},_changeImageNoTransition:function(a){var b=this._skinParts.itemsContainer,c=this;this._emptyContainer(b);var d=a.getStyles("width","height"),e=c._getTopGap(d.height.replace("px",""));b.adopt(a),this._emptyContainer(c._skinParts.virtualContainer),c._skinParts.dialogBox.setStyles({width:d.width,"min-height":d.height,"margin-top":e+"px"}),c.unlock()},_emptyContainer:function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];c.getLogic?c.getLogic().dispose():c.destroy()}a.empty()}})}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoom.ExitMobileMode",function(a,b){var c=a;c.methods({fixZoom:function(){var a=1,b=W.Config.env.$viewingDevice.toUpperCase()===Constants.ViewerTypesParams.TYPES.DESKTOP,c=this._isMobilePreviewMode||this.getState("viewerType").toUpperCase()===Constants.ViewerTypesParams.TYPES.MOBILE;if(c&&!b)return a;(!this._initZoom||this._initZoom<0||this._initZoom>5)&&this._setInitZoom();var d=this._initZoom/this._mobileConfig.getZoom();this._skinParts.xButton.style.zoom=d,this._skinParts.buttonPrev.style.zoom=d,this._skinParts.buttonNext.style.zoom=d}})}),define.experiment.component("wysiwyg.viewer.components.MobileMediaZoomDisplayer.ExitMobileMode",function(a,b){var c=a;c.methods({_setZoomModeFontSize:function(){this._mobileConfig._deviceInitZoom=this._initZoom=this._mobileConfig.getMobileScreenWidth()/document.body.offsetWidth;var a,b=this._isMobilePreviewMode?1:this._initZoom/this._mobileConfig.getZoom();switch(this.getState("displayDevice")){case"desktop":a=this._mobileConfig.isMobile()&&window.publicModel.adaptiveMobileOn?this.FONT_MULTIPLIER.MOBILE_SITE:this.FONT_MULTIPLIER.DESKTOP_SITE;break;case"tablet":a=this.FONT_MULTIPLIER.TABLET_SITE;break;case"mobile":a=this.FONT_MULTIPLIER.MOBILE_SITE;break;default:a=this.FONT_MULTIPLIER.DESKTOP_SITE}var c=a*b;this._mobileConfig.isPortrait()&&(c*=this._fontSizeCorrectionWhenOpenZoomInPortrait),this._view.setStyle("font-size",c+"px")}})}),define.experiment.component("wysiwyg.viewer.components.PageGroup.LandingPageSupport",function(a,b){var c=a;c.methods({_executeTransitionIfPossible:b.before(function(a){if(this._currentPage){var b=a.$logic.isLanding();this.isCurrentPageLandingPage()!==b&&W.Commands.executeCommand("Viewer.ToggleLandingPageMode",{toLanding:b})}}),isCurrentPageLandingPage:function(){if("undefined"==typeof this._currentPage){var a=this.resources.W.Viewer,b=a.getCurrentPageId()||a.getHomePageId()||"",c=a.getCompLogicById(b);return c&&c.isLanding()}return this._currentPage.$logic.isLanding()}})}),define.experiment.component("wysiwyg.viewer.components.PagesContainer.LandingPageSupport",function(a){a.methods({toggleLandingPageMode:function(a,b){a?(this._serializedY=this.getY(),b?b.to(this.$view,1,{top:0,ease:"strong_easeIn",onComplete:this.setY.bind(this,0)}):this.setY(0)):b.to(this.$view,1,{top:this._serializedY,ease:"strong_easeIn",onComplete:function(){this.setY(this._serializedY),delete this._serializedY,W.Layout.enforceAnchors([this],!0),W.Layout.recalculateSiteHeight()}.bind(this)})},_getSerializedY:function(){return"number"==typeof this._serializedY?this._serializedY:this.getY()},isHorizontallyMovable:function(){return!W.Viewer.isCurrentPageLandingPage()&&this.parent()},isVerticallyMovable:function(){return!W.Viewer.isCurrentPageLandingPage()&&this.parent()}})}),define.experiment.component("wysiwyg.viewer.components.ScreenWidthContainer.LesserWidthIssue",function(a){a.methods({_stretchBackgroundAndCenterContent:function(){var a=this._view,b=$(document).getSize(),c=a.getSize(),d=this.resources.W.Viewer.getDocWidth(),e=this._isMobileView?0:-Math.round((b.x-d)/2),f=this._isMobileView?d:Math.max(d,b.x);e>0&&(e=0),this._skinParts.screenWidthBackground.setStyles({position:"absolute",width:f+"px",height:c.y+"px",left:e})}})}),define.experiment.component("wysiwyg.viewer.components.SiteButton.ProportionalScaling",function(a,b){var c=a,d=b;c.statics({EDITOR_META_DATA:d.merge({general:{proportionalResize:!0}})})}),define.experiment.component("wysiwyg.viewer.components.Video.VideoNBC",function(a){var b=a;b.inherits("core.components.base.BaseComp"),b.methods({initialize:function(a,b,c){c=c||{},this.parent(a,b,c),this._iframe=null,this.on("resizeEnd",this,this._onResizeEnd),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditorModeChanged)},_onRender:function(a){var b=a.data.invalidations;this._renderIframe(),this.setMinW(this._getWMinSize()),this.setMinH(this._getHMinSize()),b.isInvalidated([this.INVALIDATIONS.FIRST_RENDER])&&this._view.on(Constants.DisplayEvents.COLLAPSED,this,this._stopVideo)},isRenderNeeded:function(a){var b=[this.INVALIDATIONS.DATA_CHANGE,this.INVALIDATIONS.FIRST_RENDER,this.INVALIDATIONS.SIZE];return a.isInvalidated(b)},_onResize:function(){},setHeight:function(a,b,c){this.parent(a,b,c)},setWidth:function(a,b,c){this.parent(a,b,c)},_onEditorModeChanged:function(a,b){if(!this.resources.W.Config.env.$isPublicViewerFrame){"CURRENT_PAGE"===a&&(this._stopVideo(),this._renderIframe());var c="PREVIEW";(b===c||a===c)&&this._renderIframe()}}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.EditableImageInput",function(a){a.statics({EDITOR_META_DATA:{general:{settings:!0,design:!0,proportionalResize:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{commandSource:"FPP",galleryConfigID:"photos",publicMediaFile:"photos",selectionType:"single",i18nPrefix:"single_image",mediaType:"picture",callback:"_mediaGalleryCallback"}},{label:"IMAGEINPUTNEW_IMAGE_EFFECTS",command:"WEditorCommands.OpenAviaryDialog",commandParameter:{commandSource:"FPP"}},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{commandSource:"dblClick",galleryConfigID:"photos",publicMediaFile:"photos",selectionType:"single",i18nPrefix:"single_image",mediaType:"picture",callback:"_mediaGalleryCallback"}},mobile:{previewImageDataRefField:"*"}}}),a.methods({_mediaGalleryCallback:function(a){this.getDataItem().setFields({height:a.height,width:a.width,uri:a.fileName,originalImageDataRef:null}),this._reportLogEvent()}})}),define.experiment.component("wysiwyg.viewer.components.WPhoto.ProportionalScaling",function(a,b){var c=a,d=b;c.statics({EDITOR_META_DATA:d.merge({general:{proportionalResize:!0}})})}),define.component("wysiwyg.viewer.components.WPhotoOBC",function(a){var b=a;b.inherits("mobile.core.components.base.BaseComponent"),b.binds(["_mediaGalleryCallback"]),b.utilize(["core.components.image.ImageSettings","core.components.image.ImageDimensionsNew","wysiwyg.common.utils.LinkRenderer"]),b.resources(["W.Config","W.Data"]),b.skinParts({link:{type:"htmlElement"},img:{type:"core.components.image.ImageNew",dataRefField:"*",hookMethod:"_setImageArgs"}}),b.dataTypes(["Image"]),b.propertiesSchemaType("WPhotoProperties"),b.fields({_renderTriggers:[Constants.DisplayEvents.ADDED_TO_DOM,Constants.DisplayEvents.DISPLAYED,Constants.DisplayEvents.DISPLAY_CHANGED,Constants.DisplayEvents.SKIN_CHANGE]}),b.statics({MIN_IMAGE_HEIGHT:1,MIN_IMAGE_WIDTH:1,_autoSizeStates:{none:1,autoSizeNoLayoutUpdate:2,autoSizeUpdateLayout:3},EDITOR_META_DATA:{general:{settings:!0,design:!0},custom:[{label:"PHOTO_REPLACE_IMAGE",command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"photos",publicMediaFile:"photos",selectionType:"single",i18nPrefix:"single_image",mediaType:"picture",callback:"_mediaGalleryCallback"}},{label:"PHOTO_EDIT_IMAGE",command:"WEditorCommands.OpenAviaryDialog"},{label:"LINK_LINK_TO",command:"WEditorCommands.OpenLinkDialogCommand",commandParameter:{position:"center"},commandParameterDataRef:"SELF"}],dblClick:{command:"WEditorCommands.OpenMediaFrame",commandParameter:{galleryConfigID:"photos",publicMediaFile:"photos",selectionType:"single",i18nPrefix:"single_image",mediaType:"picture",callback:"_mediaGalleryCallback"}}}}),b.methods({initialize:function(a,b,c){this._imageDimensions=new this.imports.ImageDimensionsNew,this._SettingsClass=this.imports.ImageSettings,this.parent(a,b,c),c&&c.props&&this.setComponentProperties(c.props),this._contentPadding={x:0,y:0},this._autoSizeState=this._autoSizeStates.none,this._initialDataChange=!0,this._linkRenderer=new this.imports.LinkRenderer},_setImageArgs:function(a){return a.argObject={requestExactSize:!this.injects().Config.env.$isEditorViewerFrame},a},_onAllSkinPartsReady:function(a){this.parent(a),this._data&&this._setTitle()},_preventRenderOnDataChange:function(a,b){return b&&"displayMode"!=b&&"href"!=b?!0:!1},_onDataChange:function(a,b,c){if(this._skinParts&&"title"==b&&this._setTitle(),"displayMode"==b){var d=this._translateDisplayModeToImageCropMode(c.displayMode);this._getImageSettings().setCropMode(d)}this._initialDataChange||!this._isFitMode()||"displayMode"!=b&&b||(this._autoSizeState=this._autoSizeStates.autoSizeUpdateLayout),this._initialDataChange=!1,this.parent(a,b,c)},setWidth:function(a,b,c,d){if(a&&!isNaN(a)&&(d||"fitHeightStrict"!=this._getDisplayMode())&&(this._getImageSettings().setContainerWidth(a-this._getContentPaddingSize().x),this.parent(a,b,c),!d)){var e=this._getImageDisplayMode();e==this._SettingsClass.CropModes.FIT_HEIGHT&&this._isDisplayed&&this._getImageSettings().setCropMode(this._SettingsClass.CropModes.FIT_WIDTH),(e===this._SettingsClass.CropModes.FIT_WIDTH||e===this._SettingsClass.CropModes.FIT_HEIGHT)&&(this._autoSizeState=this._autoSizeStates.autoSizeNoLayoutUpdate),this._renderImage()}},setHeight:function(a,b,c,d){if(a&&!isNaN(a)&&(d||"fitWidthStrict"!=this._getDisplayMode())&&(this.parent(a,b,c),this._getImageSettings().setContainerHeight(a-this._getContentPaddingSize().y),!d)){var e=this._getImageDisplayMode();e==this._SettingsClass.CropModes.FIT_WIDTH&&this._isDisplayed&&this._getImageSettings().setCropMode(this._SettingsClass.CropModes.FIT_HEIGHT),(e===this._SettingsClass.CropModes.FIT_WIDTH||e===this._SettingsClass.CropModes.FIT_HEIGHT)&&(this._autoSizeState=this._autoSizeStates.autoSizeNoLayoutUpdate),this._renderImage()}},getMinPhysicalHeight:function(){return this._getContentPaddingSize().y},render:function(){this._styleChanged(),this._renderImage(),this.parent(),this._renderLink()},_renderLink:function(){if(this.PREVENT_LINK_RENDER)return this._linkRenderer.removeRenderedLinkFrom(this._skinParts.link,this),void 0;var a=this.getDataItem(),b=a._data.link;if(!b)return this._linkRenderer.removeRenderedLinkFrom(this._skinParts.link,this),void 0;var c=this.resources.W.Data.getDataByQuery(b);c&&this._linkRenderer.renderLink(this._skinParts.link,c,this)},_renderImage:function(){if(this._layoutInitialized){var a=this._skinParts.img;if(a&&a.getOriginalClassName){var b=this._getImageSettings();a.setSettings(b),b.getCropMode()==b.CropModes.FIT_WIDTH?this.setHeight(a.getSize().y+this._getContentPaddingSize().y,!1,!1,!0):b.getCropMode()==b.CropModes.FIT_HEIGHT&&this.setWidth(a.getSize().x+this._getContentPaddingSize().x,!1,!1,!0),this._fireAutoSize()}}},_fireAutoSize:function(){this._autoSizeState!=this._autoSizeStates.none&&(this.fireEvent("autoSized",{ignoreLayout:this._autoSizeState==this._autoSizeStates.autoSizeNoLayoutUpdate}),this.resources.W.Config.env.$isEditorFrame||this.injects().Layout.notifyPositionChanged(this,"updateSize"),this._autoSizeState=this._autoSizeStates.none)},_styleChanged:function(){var a=this._getContentPaddingSize(!0);this.setMinH(a.y+this.MIN_IMAGE_HEIGHT),this.setMinW(a.x+this.MIN_IMAGE_WIDTH);var b=this._getPhotoInnerSize();this._getImageSettings().setSize(b.x,b.y)},_getContentPaddingSize:function(a){if(!this._contentPadding||a){this._contentPadding={};var b=this.getSkin();this._contentPadding.x=parseInt(b.getParamValue("contentPaddingLeft"),10)+parseInt(b.getParamValue("contentPaddingRight"),10),this._contentPadding.y=parseInt(b.getParamValue("contentPaddingTop"),10)+parseInt(b.getParamValue("contentPaddingBottom"),10),this._contentPadding.x=isNaN(this._contentPadding.x)?0:this._contentPadding.x,this._contentPadding.y=isNaN(this._contentPadding.y)?0:this._contentPadding.y,this.getSizeLimits().minH=this._contentPadding.y,this.getSizeLimits().minW=this._contentPadding.x}return this._contentPadding},_getImageSettings:function(){if(!this._imageSettings){var a=this._getPhotoInnerSize(),b=this._translateDisplayModeToImageCropMode(this._getDisplayMode());this._imageSettings=new this.imports.ImageSettings(b,a.x,a.y)}return this._imageSettings},_getPhotoInnerSize:function(){var a=this._getContentPaddingSize(),b=this.getWidth()-a.x,c=this.getHeight()-a.y;return{x:b,y:c}},_setTitle:function(){var a=this._data.get("title");this._skinParts.view.set("title",a)},_getDisplayMode:function(){return this.getComponentProperty("displayMode")},_getImageDisplayMode:function(){return this._getImageSettings()&&this._getImageSettings().getCropMode()},_translateDisplayModeToImageCropMode:function(a){var b=a;return"fitWidthStrict"==a&&(b=this._SettingsClass.CropModes.FIT_WIDTH),"fitHeightStrict"==a&&(b=this._SettingsClass.CropModes.FIT_HEIGHT),b},allowHeightLock:function(){return!this._isFitMode()},_isFitMode:function(){var a=["fitWidth","fitWidthStrict","fitHeightStrict"];return a.indexOf(this._getDisplayMode())>=0},_mediaGalleryCallback:function(a){this.getDataItem().setFields({title:a.title,description:a.description||"",height:a.height,width:a.width,uri:a.fileName})}})}),define.experiment.component("wysiwyg.viewer.components.WSiteStructure.LesserWidthIssue",function(a){a.methods({_createDesktopBackgroundNode:function(){var a={id:"desktopBgNode",comp:"wysiwyg.viewer.components.background.DesktopBackground",skin:"wysiwyg.viewer.skins.background.BackgroundSkin","min-width":this.resources.W.Viewer.getDocWidth()+"px"};this._bgNode=this._createBgNode(a)}})}),define.experiment.component("wysiwyg.viewer.components.WixAds.HideComponentsForQA",function(a,b){var c=a;c.methods({_hideForQA:function(){this._isHiddenForQA&&this.getViewNode().setStyle("display","none")}})}),define.experiment.component("wysiwyg.viewer.components.inputs.ComboBoxInput.AppBuilderTagsEditor",function(a,b){a.binds(b.merge(["_onFocus"])),a.methods({_onAllSkinPartsReady:b.after(function(){this._skinParts.collection.addEvent(Constants.CoreEvents.FOCUS,this._onFocus)}),_onFocus:function(){this.fireEvent("focus")}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.CustomSiteMenu",function(a,b){var c=a;c.skinParts({repeaterButton:{type:"core.components.MenuButton",repeater:!0,inlineDataField:"items",repeaterDataQueryField:"id",container:"itemsContainer",argObject:{listSubType:"PAGES"}},moreButton:{type:"core.components.MenuButton"},itemsContainer:{type:"htmlElement"},moreContainer:{type:"htmlElement"},dropWrapper:{type:"htmlElement"}}),c.resources(["W.Viewer"]),c.methods({_selectActiveButton:function(a){var b,c;if(this._flatButtons)for(b=0;b<this._flatButtons.length;b++)c=this._flatButtons[b],c._data&&c._data.isLinkedToType("PageLink")&&c._data.isValueInLinkedDataItem("#"+a)?c.setSelected(!0):c.setSelected(!1),this.injects().Utils.forceBrowserRepaint(c.getViewNode())},_constructButtonsTree:function(){var a,b,c,d,e,f,g=this._data.get("items"),h=[];for(a=0;a<g.length;a++){for(c=null,b=0;b<this._rootButtons.length;b++)if(this._rootButtons[b].compareId(g[a].get("id"))){c=this._rootButtons[b];break}if(c)for(c.children=[],d=g[a].getItems(),b=0;b<d.length;b++)e=Object.clone(this._repeaterDefinitions[0]),e.dataQuery="#"+d[b].get("id"),h.push({owner:c,def:e})}if(f=h.length,0===f)this._constructionDone();else for(a=0;a<h.length;a++){var i=h[a].def;h[a].owner.createSubButton(this._createComponentbyDefinition.bind(this),i,function(a){this._registerButton(a),this._flatButtons.push(a),f--,0===f&&this._constructionDone()}.bind(this))}},_arrangeButtonAccordingToData:function(){for(var a=this._data.get("items"),b=[],c=0;c<a.length;c++){var d=a[c].get("id");b.push(this._rootButtons.filter(function(a){return a.getDataItem().get("id")===d}.bind(this))[0])}this._rootButtons=b},_onRepeaterItemReady:function(a,b,c,d){this._rootButtons.push(b),this._flatButtons.push(b),b.getViewNode().setStyle("visibility","hidden"),this._registerButton(b),this.parent(a,b,c,d)},_registerButton:function(a){var b=a.getViewNode(),c=a.getDataItem();a.setMenu(this),a.addEvent("dataChanged",this._onButtonDataChange),a.dropdownMode=!0,c&&c.getLinkedDataItem()&&this.resources.W.Viewer.getLinkRenderer().renderLink(b,c.getLinkedDataItem(),a,!0)},_getDisplayedButtons:function(){for(var a=[],b=0;b<this._rootButtons.length;b++)this._rootButtons[b].getDataItem().isVisible()&&a.push(this._rootButtons[b]);return a}})}),define.experiment.component("wysiwyg.viewer.components.menus.DropDownMenu.Firefox31Fix",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){Browser&&Browser.firefox31&&this.injects().Viewer.addEvent("SiteReady",this.initFirefox31Fix.bind(this))}),dispose:d.after(function(){Browser&&Browser.firefox31&&this.injects().Viewer.removeEvent("SiteReady",this.initFirefox31Fix)}),initFirefox31Fix:function(){this._firefoxFixTrialsLeft=20,window.setTimeout(this.fixFirefox31Bug.bind(this),150)},fixFirefox31Bug:function(){this._firefoxFixTrialsLeft>0&&this._getButtonsWidth()>this.getWidth()&&(this.render(),this._firefoxFixTrialsLeft--,window.setTimeout(this.fixFirefox31Bug.bind(this),150))}})}),define.experiment.component("wysiwyg.viewer.components.mobile.TinyMenu.CustomSiteMenu",function(a,b){var c=a,d=b;c.methods({initialize:d.after(function(){this._NO_LINK_PROPAGATION=!0,this._linkRenderer=this.resources.W.Viewer.getLinkRenderer()}),render:function(){var a=this._data.getItems(!0),b=this.resources.W.Viewer.getCurrentPageId();this._asyncGetChildren(a,function(a){var c=this._skinParts.menuContainer;return this._clearOldContent(c),_.isEmpty(a)?(this._mainMenu=void 0,!1):(this._mainMenu=this._initMenu(a,c),this._setCurrentPage(this._mainMenu,b),void 0)}.bind(this)),this.parent()},_addItems:function(a,b){var c,d;a.forEach(function(a){var e;a.isVisibleMobile()&&(e=this._buildItem(a),a.hasVisibleItemsMobile()&&(c=this._buildToggleButton(),d=this._buildMenu(a.getItems()),this._addElement(e,c),this._addElement(e,d)),this._addElement(b,e))}.bind(this))},_buildItem:function(a){var b=new Element("li");a.hasItems()&&b.setAttribute("class","hasChildren");var c=this._buildLink(a);return b=this._addElement(b,c)},_buildLink:function(a){var b=new Element("a"),c=a.getLinkedDataItem();return b.innerHTML=a.getLabel(),b.addEvent("click",this._closeMainMenu.bind(this)),c&&"PageLink"===c.getType()&&c.get("pageId")&&b.setAttribute("data-refid",c.get("pageId").replace("#","")),c&&this._linkRenderer.renderLink(b,c,this),b},_asyncGetSinglePage:function(a,b){return a.isVisibleMobile()?(b(a),void 0):(b(null),void 0)},_getItemData:function(a){var b={};return b.link=a.get("link"),b.name=a.get("label"),b.children=[],b}})}),define.experiment.component("wysiwyg.viewer.components.svgshape.SvgShape.AutoGeneratedShapesSkins",function(a,b){a.traits(b.merge(["wysiwyg.common.components.traits.SvgShapeNameHelper"])),a.methods({_mediaGalleryCallback:function(a){if(this._fileName=a?a.fileName:"",!this._isValidFileName(this._fileName))return console.error("invalid shape data received from media gallery: ",a),void 0;var b=this.resources.W,c=this.getStyle().getDataItem().get("id");b.Skins.getSkin(this._getSkinNameFromFileName(this._fileName),function(a){var d=b.Theme._styleCache[c];d&&d.setSkin(a),_.defer(function(){window.parent.W.Commands.executeCommand("WEditorCommands.UpdateEditedComponentPanel",{})})}),this._logChangeMediaSuccess()},_getSkinNameFromFileName:b.remove(),_setSkin:b.remove()})}),define.experiment.component("wysiwyg.viewer.components.svgshape.SvgShape.ProportionalScaling",function(a,b){var c=a,d=b;c.statics({EDITOR_META_DATA:d.merge({general:{proportionalResize:!0}})})}),define.experiment.Class("wysiwyg.viewer.components.traits.MediaTextHandler.BlogManager",function(a,b){var c=a;c.methods({getCompCoverPhoto:function(a){var b=/wix-comp=[\"']({.*?})[\"']/g,c=this._getAllMatches(a,/\<\s*img[^>]*\>/g),d=_.filter(c,function(a){return _.contains(a[0],"post-cover-photo")}),e=d.length?d[0]:c[0];if(e){var f=b.exec(e[0]);return f?JSON.parse(this._decodeJsonData(f[1])):{componentType:"default"}}return{componentType:"default"}},getCoverImage:function(a){var b=this._getAllMatches(a,/<\s*img[^>]*\>/g),c=_.filter(b,function(a){return _.contains(a[0],"post-cover-photo")}),d=c.length?c[0]:b[0];return d?d[0]:void 0}})}),define.experiment.Class("wysiwyg.viewer.managers.ActionsManager.AnimationPageTransitions",function(a,b){var c=a,d=b;c.resources(d.merge(["ActionsEnabledMap"])),c.utilize(d.merge(["wysiwyg.viewer.managers.actions.PageTransitionAction","wysiwyg.common.behaviors.Transitions"])),c.methods({initialize:function(){this._actionsEnabledMap=this.resources.ActionsEnabledMap,this._anyActionEnabledInMap=_.any(this._actionsEnabledMap,Boolean),this._animations=new this.imports.Animations,this._transitions=new this.imports.Transitions(this._animations),this._createActionsInstances(),this._setActionsListeners()},registerComponent:function(a,b,c){var d,e=b.getComponentId();if(c=c||{},"string"==typeof c)try{c=JSON.parse(c)}catch(f){return LOG.reportError(wixErrors.ANIMATIONS_REGISTER_CORRUPTED_DATA,"ActionsManager","registerComponent",{dsc:e}),void 0}for(d in this._actions)this._actions[d].removeComponentBehaviors(e);for(d in c)this._actions[d]&&this.isActionEnabledForSession(d)&&this._addBehaviorsByAction(a,e,c,d)},_createActionsInstances:function(){this._actions[Constants.Actions.PAGE_IN]=new this.imports.PageInAction(this._animations),this._actions[Constants.Actions.SCREEN_IN]=new this.imports.ScreenInAction(this._animations),this._actions[Constants.Actions.PAGE_TRANSITION]=new this.imports.PageTransitionAction(this._transitions)},_setActionsListeners:function(){_.forEach(this._actions,function(a,b){this.isActionEnabledForSession(b)?(a.setActionListeners(),a.setActiveState(!0)):a.setInactiveActionListeners()},this)},isActionEnabledForSession:function(a){return this._actionsEnabledMap[a]},isAnyActionsEnabledForSession:function(){return this._anyActionEnabledInMap}})}),define.experiment.Class("wysiwyg.viewer.managers.LayoutManager.BoxSlideShow",function(a,b){var c=a;c.fields({LOCK_THRESHOLD:70,DEFAULT_MARGIN:10,SUGGEST_ANCHOR_MARGIN:20,FLAG_DIRTY_TOP:1,FLAG_DIRTY_BOTTOM:2,STOP_LAYOUT_ACTION:!1}),c.methods({_getAnchoredH:function(a){var b=a.fromComp.getBoundingHeight(),c=a.fromComp.getBoundingY()+b;return a.locked?c+=a.distance:!this.resources.W.Viewer.isPageComponent(a.toComp.getOriginalClassName())&&this.resources.W.Viewer.canHaveFatherHeight(a.toComp)&&(c+=this.DEFAULT_MARGIN),a.type==a.ANCHOR_BOTTOM_BOTTOM?c-=a.toComp.getBoundingY():a.type==a.ANCHOR_BOTTOM_PARENT&&a.toComp.getInlineContentContainer&&this._isInlineContentNonZeroSize(a.toComp)&&(c+=this._getContainerMarginHeight(a.toComp)),c},_setAnchorableDistance:function(a,b){if("wysiwyg.common.components.boxslideshow.viewer.BoxSlideShow"===a.toComp.$className&&"wysiwyg.common.components.boxslideshowslide.viewer.BoxSlideShowSlide"===a.fromComp.$className||"wysiwyg.common.components.boxslideshowslide.viewer.BoxSlideShowSlide"===a.toComp.$className&&"wysiwyg.common.components.boxslideshowslide.viewer.BoxSlideShowSlide"===a.fromComp.$className)return a.distance=0,void 0;var c=a.fromComp,d=a.toComp;void 0!==c.isAnchorable().from.distance?b=c.isAnchorable().from.distance:void 0!==d.isAnchorable().to.distance&&(b=d.isAnchorable().to.distance),a.distance=b},updateChildAnchors:function(a){if(a&&a.getChildComponents){var b=a.getChildComponents();if(!this._validateNodesRendered(b))return;b.length>0?this._updateAnchors(b[0].getLogic(),[],!0):this._clearReverseAnchorsByScope(a.getReverseAnchors(),!0),this.checkAndUpdateChildOfChildIfNeeded(a)}},checkAndUpdateChildOfChildIfNeeded:function(a){if(a.waitTillMeasureToPreformLayoutChanges()&&a&&a.getChildComponents){var b=a.getChildComponents();b.map(function(a){this.updateChildAnchors(a.$logic)}.bind(this))}},updateLayoutAction:function(a){this.STOP_LAYOUT_ACTION=a},_updateLayout:function(){if(!this.STOP_LAYOUT_ACTION){this._nextRenderId=null;var a=this._getLayoutRootComp();this._measureInvalidatedComps(a),this._enforceAnchorsRecurse(a),this.fireEvent("UpdateLayoutDone")}}})}),define.experiment.Class("wysiwyg.viewer.managers.LayoutManager.BugFixesForReactEditor",function(a,b){var c=a;c.resources(b.merge(["BugFixesForReactCommonCode"])),c.methods({_enforceAnchorsRecurse:function(a){return this.resources.BugFixesForReactCommonCode.enforceAnchorsRecurse(a,this)}})}),define.experiment.Class("wysiwyg.viewer.managers.LayoutManager.BugFixesForReactPublic",function(a,b){var c=a;c.resources(b.merge(["BugFixesForReactCommonCode"])),c.methods({_enforceAnchorsRecurse:function(a){return this.resources.BugFixesForReactCommonCode.enforceAnchorsRecurse(a,this)}})}),define.experiment.Class("wysiwyg.viewer.managers.LayoutManager.FixBottomTopAnchor",function(a,b){var c=a;c.methods({_getMaxAnchoredY:function(a,b){var c=this._getAnchoredY,d=b;return a.getReverseAnchors().forEach(function(a){if(a.type==a.ANCHOR_BOTTOM_TOP||a.type==a.ANCHOR_TOP_TOP){a.type!=a.ANCHOR_BOTTOM_TOP||a.locked||(d=Math.max(a.originalValue,d));var b=c(a);d=Math.max(b,d)}}),d}})}),define.experiment.Class("wysiwyg.viewer.managers.LayoutManager.LandingPageSupport",function(a){a.methods({_measureInvalidatedComps:function(a){if(a.getIsDisplayed()&&(!a.NEW_BASE_COMP&&a.isMeasureNeeded()&&a.measure(),a.getChildComponents)){var b;b=a.getCurrentChildren?a.getCurrentChildren():a.getChildComponents();for(var c=0;c<b.length;c++)b[c].$logic&&b[c].$alive&&this._measureInvalidatedComps(b[c].$logic)}},_getLayoutRootComp:function(){return W.Viewer.isCurrentPageLandingPage()?W.Viewer.getPagesContainer().$logic:W.Viewer.getSiteNode().$logic},recalculateSiteHeight:function(){var a=W.Viewer.getSiteNode().$logic,b=a.getHeight(),c=this.getComponentMinResizeHeight(a);b!==c&&a.setHeight(c)},_enforceAnchorsRecurse:function(a){var b;if(a.getChildComponents){b=a.getCurrentChildren?a.getCurrentChildren():a.getChildComponents();for(var c=[],d=!1,e=0;e<b.length;e++)b[e].$logic&&b[e].$alive&&(d=this._enforceAnchorsRecurse(b[e].$logic),(d||b[e].$logic.wasHeightChanged())&&(b[e].$logic.validateHeight(),c.push(b[e].$logic)));return 0==c.length?!1:this.enforceAnchors(c,!1,void 0,void 0,!0)}}})}),define.experiment.Class("wysiwyg.viewer.managers.LayoutManager.NBC_FixMeasureBug",function(a,b){var c=a;c.methods({_isInlineContentNonZeroSize:function(a){return a.NEW_BASE_COMP?a.getInlineContentContainer().$measure.height>0:a.getInlineContentContainer().getSize().y>0},_getContainerMarginHeight:function(a){var b=a.NEW_BASE_COMP?a.getInlineContentContainer().$measure.height:a.getInlineContentContainer().getSize().y;return a.getPhysicalHeight()-b},_createToParentAnchor:function(a,b){var c=a.getBoundingY(),d=a.getBoundingHeight(),e=b.NEW_BASE_COMP?b.getInlineContentContainer().$measure.height:b.getInlineContentContainer().getSize().y,f=new this._AnchorClass;
return f.type=f.ANCHOR_BOTTOM_PARENT,f.fromComp=a,f.toComp=b,this._setAnchorableDistance(f,e-c-d),this._setAnchorableIsLocked(f),f.topToTop=c,f.originalValue=e,f}})}),define.experiment.Class("wysiwyg.viewer.managers.PageManager.LandingPageSupport",function(a,b){var c=a;c.resources(b.merge(["W.Commands"])),c.binds(b.merge(["_hideSiteNode"])),c.methods({_createMasterPage:function(){var a=new this.imports.MasterPageHandler(this._dataResolver,this._viewerName);this._propagateEvents(a);var b=a.loadMasterSignatureHtml();return b.then(this._hideSiteNode),this._masterPageHandler=a,b},_hideSiteNode:function(a){a.rootCompNode.setStyle("opacity",0)}})}),define.experiment.newClass("wysiwyg.viewer.managers.SocialActivityDataManager.SocialActivity.New",function(a){a.inherits("core.managers.data.DataManager"),a.fields({}),a.statics({_defaultPresets:{id01:{type:"SocialActivitySettings",activeNetworks:["fb","tw"],iconSize:35,showCondition:1,theme:"light"},id02:{type:"SocialActivitySettings",activeNetworks:["fb","tw","pi"],iconSize:25,showCondition:1,theme:"default"},id03:{type:"SocialActivitySettings",activeNetworks:["fb","tw","pi"],iconSize:25,showCondition:1,theme:"default"},id04:{type:"SocialActivitySettings",activeNetworks:["fb","tw","pi"],iconSize:25,showCondition:1,theme:"default"}}}),a.resources(["SN.FacebookSocialNetwork","SN.TwitterSocialNetwork","SN.PinterestSocialNetwork"]),a.methods({initialize:function(){this.parent()},getDefaultPreset:function(){return Object.values(this.getPresets())[0]},getPresets:function(){return this.isDataAvailable("#id01")||this._createPreset(),this.getDataByQueryList(Object.keys(this._defaultPresets).map(function(a){return"#"+a}))},_createPreset:function(){_.each(this._defaultPresets,function(a,b){this.addDataItem(b,a)},this)},isPreset:function(a){return a&&this._defaultPresets[a.get("id")]?!0:!1},getSocialNetwork:function(a){var b={fb:this.resources.SN.FacebookSocialNetwork,tw:this.resources.SN.TwitterSocialNetwork,pi:this.resources.SN.PinterestSocialNetwork};return b[a]||b}})}),define.experiment.Class("wysiwyg.viewer.managers.WViewManager.BoxSlideShow",function(a,b){var c=a;c.methods({canHaveFatherHeight:function(a){return a._childCanHaveFatherSize===!0}})}),define.experiment.Class("wysiwyg.viewer.managers.WViewManager.CustomSiteMenu",function(a,b){var c=a,d=b;c.utilize(d.merge(["wysiwyg.common.utils.LinkRenderer"])),c.methods({getLinkRenderer:function(){return this._linkRenderer||(this._linkRenderer=new this.imports.LinkRenderer(this,this.resources.W.Data)),this._linkRenderer},getMainMenu:function(a){return this.resources.W.Data.getDataByQuery(a?"#CUSTOM_MAIN_MENU":"#MAIN_MENU")}})}),define.experiment.Class("wysiwyg.viewer.managers.WViewManager.ExitMobileMode",function(a,b){var c=a;c.methods({initiateSite:function(a){var b=this,c=function(c){var d=b._isDesktopModeImposed(),e=!d&&c&&(W.Config.isMobileOptimizedViewOn()||W.Config.forceMobileOptimizedViewOn()),f=e?Constants.ViewerTypesParams.TYPES.MOBILE:Constants.ViewerTypesParams.TYPES.DESKTOP;b._firstActiveViewerLoad(f),(W.Config.mobileConfig.isMobile()||a===Constants.ViewerTypesParams.TYPES.DESKTOP)&&b._mobileHandler.setMobileSite(f),b._activeViewer_.initiateSite(),d&&(MobileUtils.setViewportContent(""),MobileUtils.fixViewportScale(),b._removePreloader())};a!==Constants.ViewerTypesParams.TYPES.DESKTOP&&W.Config.env.$isPublicViewerFrame&&(W.Config.mobileConfig.isMobile()||W.Config.forceMobileOptimizedViewOn())?this._dataResolver.isStructureExists(Constants.ViewerTypesParams.TYPES.MOBILE).then(c):c(!1)},_isDesktopModeImposed:function(){if(this._desktopSiteImposing)return!0;var a=W.CookiesManager.getCookie("desktopSiteImposing");return a?(this._desktopSiteImposing=!0,W.CookiesManager.removeCookie("desktopSiteImposing"),!0):!1},_removePreloader:function(){var a=document.getElementById("viewer_preloader");a&&document.body.removeChild(a);var b=document.getElementById(Constants.ViewerTypesParams.DOM_ID_STATIC_PREFIX+"viewer_preloader");b&&document.body.removeChild(b)}})}),define.experiment.Class("wysiwyg.viewer.managers.WViewManager.LandingPageSupport",function(a,b){a.traits(b.merge(["core.events.EventDispatcher"])),a.utilize(b.merge(["wysiwyg.viewer.utils.TransitionUtils"])),a.methods({initialize:b.after(function(){this.resources.W.Commands.registerCommandAndListener("Viewer.ToggleLandingPageMode",this,this._onToggleLandingPageMode),this._transitionUtils=new this.imports.TransitionUtils,this._Tween=this.resources.W.Utils.Tween}),_onToggleLandingPageMode:function(a){var b=a.toLanding;this._toggleMasterPageComponentsVisibility(b);var c=[this.getPagesContainer().$logic,this.getHeaderContainer().$logic,this.getFooterContainer().$logic];a.isFirstLoad?_.invoke(c,"toggleLandingPageMode",b):_.invoke(c,"toggleLandingPageMode",b,this._Tween)},_toggleMasterPageComponentsVisibility:function(a){var b=this._getTopLevelMasterPageComponents();_.forEach(b,function(b){a?b.collapse():b.uncollapse()})},_getTopLevelMasterPageComponents:function(){return _.filter(this.getSiteNode().getChildren(),function(a){return"PAGES_CONTAINER"!==a.$logic.getComponentId()})},isCurrentPageLandingPage:function(){var a=this.getPageGroup();return a&&a.isCurrentPageLandingPage()},_initSiteView:b.after(function(){this.once("SiteReady",this,this._setSiteToVisible)}),_setSiteToVisible:function(){this.isCurrentPageLandingPage()&&this.resources.W.Commands.executeCommand("Viewer.ToggleLandingPageMode",{toLanding:!0,isFirstLoad:!0}),this.getSiteNode().setOpacity(1),this._fixHtmlEmbedsHackForMobile()},_fixHtmlEmbedsHackForMobile:function(){window.MobileUtils&&window.MobileUtils.isMobile()?$$(".hiddenTillReady").setStyle("display","none"):$$(".hiddenTillReady").removeClass("hiddenTillReady")}})}),define.experiment.Class("wysiwyg.viewer.managers.WViewManager.RichTextMigrationStudio",function(a,b){var c=a,d=b;c.utilize(d.merge(["wysiwyg.common.utils.TextMigrationHandler"])),c.methods({_wasMasterMigrated:!1,migrateAllRenderedTextComps:function(){this._textMigrationHandler=this._textMigrationHandler||new this.imports.TextMigrationHandler;var a=[];if(this._wasMasterMigrated){var b=this.getCurrentPageNode(),c=b&&b.$logic;c&&(a=c.getPageComponents())}else{var d=this.getSiteNode();a=d.getElements("[comp]").map(function(a){return a.$logic}),this._wasMasterMigrated=!0}return this._migrateTextComponents(a)},_migrateTextComponents:function(a){var b=a.filter(function(a){return"wysiwyg.viewer.components.WRichText"===a.getOriginalClassName()&&"StyledText"!==a.getDataItem().getType()});return this._textMigrationHandler=this._textMigrationHandler||new this.imports.TextMigrationHandler,b.forEach(function(a){var b=this._textMigrationHandler.migrateComponent(a);a.getDataItem().set("text",b)},this),b.length}})}),resource.getResourceValue("W.Experiments",function(a){a.isExperimentOpen("AnimationPageTransitions")&&resource.getResources(["W.Config","W.Utils"],function(a){var b=a.W.Config,c=a.W.Utils,d="undefined"==typeof window.addEventListener,e=b.mobileConfig.isMobileOrTablet(),f=c.getQueryParam("disableActions");f=f?f.split(","):[];var g={};g[Constants.Actions.PAGE_IN]=!_.contains(f,Constants.Actions.PAGE_IN)&&!d&&!e,g[Constants.Actions.SCREEN_IN]=!_.contains(f,Constants.Actions.SCREEN_IN)&&!d&&!e,g[Constants.Actions.PAGE_TRANSITION]=!_.contains(f,Constants.Actions.PAGE_TRANSITION)&&!d,define.resource("ActionsEnabledMap",g)})}),define.experiment.Class("wysiwyg.viewer.managers.actions.PageInAction.AnimationPageTransitions",function(a,b){var c=a,d=b;c.methods({initialize:d.remove(),setActionListeners:function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageChangeRequested",this,this._onPageChange),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageTransitionComplete",this,this._onPageTransitionComplete),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageTransitionStart",this,this._onPageTransitionStart),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._onViewerStateChanged),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged)},executeAction:function(a){if(this._getCurrentPageId()===a.pageId&&this._animations.isReady()&&"PREVIEW"===this.resources.W.Config.env.$editorMode){a.isPageTransitionEnd||this._resetPageTargetsToPlay();var b=this.getCurrentPageTargetsIds();this._populateSiteTargetsPlayData(b),this._populatePageTargetsToPlay(b,a),this._startAnimationEvents()}},_onPageTransitionComplete:function(a){a=a||{},a.isPageTransitionEnd=!0,this.executeAction(a)},_onPageTransitionStart:function(a){a=a||{},a.isPageTransitionEnd=!1,this.executeAction(a)}})}),define.experiment.newClass("wysiwyg.viewer.managers.actions.PageTransitionAction.AnimationPageTransitions",function(a){var b=a;b.inherits("wysiwyg.viewer.managers.actions.base.BaseAction"),b.resources(["W.Viewer","W.Commands","W.Config","W.Utils"]),b.binds([]),b.methods({initialize:function(a){this.parent(),this.resources.W.Commands.registerCommand("WViewerCommands.PageTransitionStart",!0),this.resources.W.Commands.registerCommand("WViewerCommands.PageTransitionComplete",!0),this.resources.W.Commands.registerCommand("WViewerCommands.PageTransitionCompleteOffset",!0),this._transitions=a,this._transitionsDefinitions=this._transitions.getAllTransitionDefinitions()},setActionListeners:function(){this.resources.W.Commands.registerCommandListenerByName("W.ViewerCommands.PageHandlerAttachPage",this,this._hidePage),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.NextPageReady",this,this._onNextPageReady),this.resources.W.Commands.registerCommandListenerByName("TweenEngine.AnimationInterrupted",this,this._onAnimationComplete),this.resources.W.Commands.registerCommandListenerByName("TweenEngine.AnimationComplete",this,this._onAnimationComplete),this.resources.W.Commands.registerCommandListenerByName("TweenEngine.AnimationStart",this,this._onAnimationStart)},setInactiveActionListeners:function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.NextPageReady",this,this._executeInactiveActionCommands)},executeAction:function(a){var b,c=this.resources.W.Viewer.getPageGroup().getComponentProperty("transition"),d=this.resources.W.Viewer.getCompByID(a.fromPageId),e=this.resources.W.Viewer.getCompByID(a.pageId),f=!1;if(this._showPage({pageNode:e}),this._currentPageCommandParams={fromPageId:a.fromPageId,pageId:a.pageId},!a.fromPageId||"none"===c)return this._executeInactiveActionCommands(a),void 0;b=this._getTransitionByLegacyName(c);try{this._currentTimeline=b.init(e,d,{reverse:f}),this._currentTimeline.call(this._onAnimationCompleteOffset,null,this,b.options.completeCommandOffset)}catch(g){throw this._executeInactiveActionCommands(a),g}},_getTransitionByLegacyName:function(a){var b=_.find(this._transitionsDefinitions,function(b){return _.contains(b.legacyTypes,a)});return b},_onAnimationStart:function(a){this._currentTimeline&&this._currentTimeline===a.timeline&&this.resources.W.Commands.executeCommand("WViewerCommands.PageTransitionStart",this._currentPageCommandParams,"PageTransitionAction")},_onAnimationCompleteOffset:function(){this.resources.W.Commands.executeCommand("WViewerCommands.PageTransitionCompleteOffset",this._currentPageCommandParams,"PageTransitionAction")},_onAnimationComplete:function(a){this._currentTimeline&&this._currentTimeline===a.timeline&&(this.resources.W.Commands.executeCommand("WViewerCommands.PageTransitionComplete",this._currentPageCommandParams,"PageTransitionAction"),window.scrollTo(0,0))},_executeInactiveActionCommands:function(a){var b=this.resources.W.Viewer.getCompByID(a.pageId);this.resources.W.Commands.executeCommand("WViewerCommands.PageTransitionStart",{fromPageId:a.fromPageId,pageId:a.pageId},"PageTransitionAction"),_.defer(function(a){this._showPage({pageNode:b}),this.resources.W.Commands.executeCommand("WViewerCommands.PageTransitionComplete",a,"PageTransitionAction"),window.scrollTo(0,0)}.bind(this),{fromPageId:a.fromPageId,pageId:a.pageId})},_onNextPageReady:function(a){this.executeAction(a)},_hidePage:function(a){var b=a.pageNode;b&&b.addClass("hidePageForTransition")},_showPage:function(a){var b=a.pageNode;b&&b.removeClass("hidePageForTransition")}})}),define.experiment.Class("wysiwyg.viewer.managers.actions.ScreenInAction.AnimationNewBehaviors",function(a,b){var c=a;c.fields({_pageSequences:[],_masterPageSequences:[]}),c.methods({_animateTargets:function(){var a,b,c,d,e,f,g,h,i,j=[],k=[];if(this._isTargetsToAnimate())for(var l=this._pageTargetsToPlay.length;l--;)if(d=this._pageTargetsToPlay[l],c=this._isTargetInViewport(d),c&&!this._isTweening(d)){for(e=this.getBehaviorsByTargetId(d),f=0;f<e.length;f++)g=e[f],this._animations.getAnimationDefinition(g.name)&&(b=g.params?_.cloneDeep(g.params):{},a=this._getDomElementByTargetId(d),"master"===this.getPageIdByTargetId(d)?k.push(this._animations.applyTween(g.name,a,g.duration,g.delay,b)):j.push(this._animations.applyTween(g.name,a,g.duration,g.delay,b)));k.length&&(i=this._animations.sequence(k,{autoClear:!0,paused:!0}),this._masterPageSequences.push(i)),j.length&&(h=this._animations.sequence(j,{autoClear:!0,paused:!0}),this._pageSequences.push(h)),this._siteTargetsPlayData[d].isPlayed=!0,this._pageTargetsToPlay.splice(l,1),i&&i.play(),h&&h.play()}},_clearAnimations:function(a){"master"===a?(this._animations.clear(this._masterPageSequences),this._masterPageSequences=[]):(this._animations.clear(this._pageSequences),this._pageSequences=[])}})}),define.experiment.Class("wysiwyg.viewer.managers.actions.ScreenInAction.AnimationPageTransitions",function(a,b){var c=a,d=b;c.methods({initialize:d.remove(),setActionListeners:function(){this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageChangeRequested",this,this._onPageChange),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageTransitionCompleteOffset",this,this._onPageTransitionComplete),this.resources.W.Commands.registerCommandListenerByName("WViewerCommands.PageTransitionStart",this,this._onPageTransitionStart),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.FeedbackQuickTourEnded",this,this._onFeedbackQuickTourEnded),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._onViewerStateChanged),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.WEditModeChanged",this,this._onEditModeChanged)},executeAction:function(a){if(a.pageId&&this._getCurrentPageId()===a.pageId&&this._animations.isReady()&&"PREVIEW"===this.resources.W.Config.env.$editorMode){a.isPageTransitionEnd||this._resetPageTargetsToPlay();var b=this.getCurrentPageTargetsIds();this._populateSiteTargetsPlayData(b),this._populatePageTargetsToPlay(b,a),this._startAnimationEvents()}},_onPageTransitionComplete:function(a){a=a||{},a.isPageTransitionEnd=!0,this.executeAction(a)},_onPageTransitionStart:function(a){a=a||{},a.isPageTransitionEnd=!1,this.executeAction(a)}})}),define.experiment.Class("wysiwyg.viewer.managers.actions.base.BaseAction.AnimationPageTransitions",function(a,b){var c=a;c.methods({initialize:function(a,b){this._animations=a,this._behaviors={},this._viewingDevice=null,this._isPublic=this.resources.W.Config.env.$isPublicViewerFrame,this._isActive=!1,this._syncWithViewingDeviceChanges(b)},isActive:function(){return this._isActive},setActiveState:function(a){this._isActive=!!a},_syncWithViewingDeviceChanges:function(a){this._setViewingDeviceForBehaviors({viewerMode:a||this.resources.W.Config.env.$viewingDevice}),this.resources.W.Commands.registerCommandAndListener("WEditorCommands.SetViewerMode",this,this._setViewingDeviceForBehaviors),this.resources.W.Commands.registerCommandListenerByName("WPreviewCommands.ViewerStateChanged",this,this._setViewingDeviceForBehaviors)},setActionListeners:function(){},setInactiveActionListeners:function(){},executeAction:function(){}})}),define.experiment.Class("wysiwyg.viewer.managers.pages.PageHandler.AnimationPageTransitions",function(a,b){"use strict";var c=a,d=b;c.resources(d.merge(["W.Commands"])),c.methods({_collapsePage:function(a){this.resources.W.Commands.executeCommand("W.ViewerCommands.PageHandlerAttachPage",this,{pageNode:a}),this._waitingForRender||a.collapse()}})}),resource.getResourceValue("W.Theme",function(a){var b={iconName:"",getFullIconUrl:function(){return a.getProperty("WEB_THEME_DIRECTORY")+"social_activity/"}};define.resource("SN.BaseSocialNetwork",b)}),resource.getResourceValue("SN.BaseSocialNetwork",function(a){var b=Object.create(a);b.name="fb",b.iconName={light:"fb_light.png","default":"fb_dark.png"},b.label="Share on FaceBook",define.resource("SN.FacebookSocialNetwork",b)}),resource.getResourceValue("SN.BaseSocialNetwork",function(a){var b=Object.create(a);b.name="pi",b.iconName={light:"pi_light.png","default":"pi_dark.png"},b.label="Share on Pinterest",define.resource("SN.PinterestSocialNetwork",b)}),resource.getResourceValue("SN.BaseSocialNetwork",function(a){var b=Object.create(a);b.name="tw",b.iconName={light:"tw_light.png","default":"tw_dark.png"},b.label="Share on Twitter",define.resource("SN.TwitterSocialNetwork",b)}),define.experiment.Class("wysiwyg.common.managers.viewer.MobileViewHandler.ExitMobileMode.New",function(a){var b=a;b.methods({_resetViewPortTagAttributes:function(){if(W.Config.isMobileOptimizedViewOn()){var a=W.Viewer.getDocWidth();this.setViewportAttribute("width",a),this.setViewportAttribute("initial-scale",1),this.setViewportAttribute("user-scalable","yes")}else this.setViewportAttribute("width",""),this.setViewportAttribute("initial-scale",""),this.setViewportAttribute("user-scalable","yes");this.setViewportAttribute("maximum-scale",1.25),this.setViewportAttribute("minimum-scale",.25)},handleQuickActions:function(){this._mobileQuickActionsHandler||(this._mobileQuickActionsHandler=new this.imports.MobileQuickActionsHandler,this._mobileQuickActionsHandler.handleMobileQuickActions())}})}),define.experiment.Class("wysiwyg.common.managers.viewer.MobileViewHandler.MobileActionsMenu",function(a,b){var c=a;c.utilize(["wysiwyg.viewer.utils.MobileQuickActionsHandler","wysiwyg.viewer.utils.MobileActionsMenuHandler"]),c.methods({handleQuickActions:function(){var a;window.WMobileActionsMenu&&window.WMobileActionsMenu.isInited()?(a=new this.imports.MobileActionsMenuHandler,a.handleMobileActionsMenu()):(a=new this.imports.MobileQuickActionsHandler,a.handleMobileQuickActions())},addRotationEventListener:function(){window.addEventListener("orientationchange",this._handleMobileRotation,!1),(window.WQuickActions||window.WMobileActionsMenu)&&window.addEventListener("orientationchange",this._showQuickActions,!1)},removeRotationEventListener:function(){window.removeEventListener("orientationchange",this._handleMobileRotation),(window.WQuickActions||window.WMobileActionsMenu)&&window.removeEventListener("orientationchange",this._showQuickActions)},_fixQuickActionsZoom:function(){(window.WQuickActions||window.WMobileActionsMenu)&&W.Viewer.addEvent("SiteReady",function(){_.delay(this._showQuickActions,100)}.bind(this))},_hideQuickActions:function(){window.WMobileActionsMenu?window.WMobileActionsMenu.forceCloseActionsMenu():window.WQuickActions&&window.WQuickActions.hideBar()},_showQuickActions:function(){setTimeout(function(){window.WMobileActionsMenu||window.WQuickActions&&(window.WQuickActions.showBar(),window.WQuickActions.fixZoom())},100)}})}),define.experiment.Class("wysiwyg.viewer.managers.viewer.ViewerProxy.LandingPageSupport",function(a){a.methods({addEventPropagation:function(a){var b=this;this._eventHandlers[a]=function(c){b.fireEvent(a,c),b.trigger(a,c)},this._activeViewer_.addEvent(a,this._eventHandlers[a])}})}),define.experiment.Class("wysiwyg.viewer.utils.MobileQuickActionsHandler.CustomSiteMenu",function(a){var b=a;b.methods({_addNavigation:function(){var a=document.getElementById("quick-actions");if(a){var b=document.getElementById("quick-actions-pages-button");if(b){this._pagesMap={},this.resources.W.Commands.registerCommandAndListener("WViewerCommands.SelectedPageChanged",this,this._onSelectedPageChanged);var c=document.getElementById("qa-drop-up-pages").querySelector(".quick-actions-drop-up-title"),d=document.getElementById("qa-drop-up-pages-list"),e="Pages";c.innerHTML=e;var f=this.injects().Viewer.getMainMenu().getItems();this._createNavItemsFromDataItems(d,f,0),this._addGapElement(d),b.className=b.className.replace("disabled","")}}}})}),define.experiment.Class("wysiwyg.viewer.utils.MobileQuickActionsHandler.MobileActionsMenu",function(a,b){var c=a;c.methods({handleMobileQuickActions:function(){this._removePreloader(),this._addNavigation(),window.WMobileActionsMenu&&window.WMobileActionsMenu.updateDisplay()},_createSingleNavItem:function(a,b,c){for(var d=this._navigateToPage,e=this._hideMenu,f=">  ",g="",h=0;c>h;h++)g+=f;var i=document.createElement("li"),j=b.get("refId");this._pagesMap[j]=i,i.innerHTML="<a href='#'></a>",a.appendChild(i),this.resources.W.Data.getDataByQuery(j,function(f){var h=f.get("mobileHidePage");if(h)a.removeChild(i);else{var k=f.get("title");i.firstChild.innerHTML=g+k;var l=b.get("items");l&&l.length>0&&this._createNavItemsFromDataItems(a,l,c+1,i),j&&0===j.indexOf("#")&&(j=j.substr(1)),i.addEventListener("click",function(a){e(),d(j),a.stopPropagation(),a.preventDefault()})}}.bind(this))}})});