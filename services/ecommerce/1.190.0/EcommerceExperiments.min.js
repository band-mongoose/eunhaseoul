define.experiment.Class("ecommerce.core.EcomCartAPI.AtntFix",function(a){var b=a;b.methods({_onRequestFail:function(a,b,c){if(c){var d="We seem to be having a problem with some of our carrier networks.  Please try again on a WiFi connection. If the problem persists, contact Support with the following error: WOS";this._msgCtrl.showError(this._localizer.localize("ECOM_SOMETHING_WENT_WRONG_ERR_TITLE"),d+b)}else switch(a.payload.code){case 1e3:this._msgCtrl.showError(this._localizer.localize("ECOM_SHOPPING_CART_INSUFFICIENT_STOCK_ERR_TITLE"),this._localizer.localize("ECOM_SHOPPING_CART_INSUFFICIENT_STOCK_ERR_DESC"));break;case 1007:this._msgCtrl.showError(this._localizer.localize("ECOM_SHOPPING_CART_UNAVAILABLE_PRODUCT_ERR_TITLE"),this._localizer.localize("ECOM_SHOPPING_CART_UNAVAILABLE_PRODUCT_ERR_DESC"));break;default:this._msgCtrl.showError(this._localizer.localize("ECOM_OOPS_ERR_TITLE"),this._localizer.localize("ECOM_CHECKOUT_API_REQUEST_FAIL_ERR_DESC")+b)}this._emptyRequestsMap(),this._hideLoadingSign(!1),this.fireEvent("EcomCartAPI.requestError")}})}),define.experiment.Class("ecommerce.core.EcomCheckoutAPI.AtntFixSvSession",function(a){var b=a;b.methods({getExternalCheckoutURL:function(a,b){var c=this.resources.W.Config.getServiceTopologyProperty("ecommerceCheckoutUrl");c.match("/$")||(c+="/");var d=this.resources.W.Config.getSiteId();return c+="payment?",c+=this._getCheckoutURLParams(a,b,d,!0)},_getCheckoutURLParams:function(a,b,c,d){var e="storeId="+b;return e+="&cartId="+a,e+="&metaSiteId="+this.resources.W.Config.getMetaSiteId(),c&&(e+="&siteId="+c),this.resources.W.Config.env.$isPublicViewerFrame&&("wix.com"===this.resources.W.Config.getSiteDomain()||d)&&(e+="&svSession="+this.resources.W.Config.getSvSession()),e+="&successURL="+this._getSuccessURL(),e+="&returnToURL="+this._getCurrentPageURL()}})}),define.experiment.Class("ecommerce.core.EcomCheckoutAPI.EcomExp8",function(a){var b=a;b.statics({API_URL_SEGMENT:"/apps/ecommerce/api/checkout?",CHECKOUT_RESULT:"f_checkoutResult",CHECKOUT_ERROR_ID:"f_checkoutErrorId",_isErrorProcessed:!1,_checkoutSuccessUrl:"",_returnToURL:""}),b.methods({_getCheckoutURLParams:function(a,b,c){var d="storeId="+b;return d+="&cartId="+a,d+="&metaSiteId="+this.resources.W.Config.getMetaSiteId(),c&&(d+="&siteId="+c),this.resources.W.Config.env.$isPublicViewerFrame&&(d+="&svSession="+this.resources.W.Config.getSvSession()),d+="&successURL="+this._getSuccessURL(),d+="&returnToURL="+this._getReturnToURL()},setReturnToURL:function(a){this.$class.prototype._returnToURL||(a=this._removeQueryParam(this.CHECKOUT_RESULT,a),a=this._removeQueryParam(this.CHECKOUT_ERROR_ID,a),this.$class.prototype._returnToURL=a)},_getReturnToURL:function(){return this._returnToURL?encodeURIComponent(this._returnToURL):this._getCurrentPageURL()},_getSuccessURL:function(){return this._checkoutSuccessUrl?encodeURIComponent(this._checkoutSuccessUrl):this._getReturnToURL()}})}),define.experiment.Class("ecommerce.core.EcomDataProvider.EcomExp1",function(a,b){var c=a,d=b;c.utilize(d.merge(["ecommerce.core.EcomCartIdHolder"])),c.methods({initialize:function(a){this._environment=a,this._dataFactory=a.getDataItemFactory(),this._typesManager=a.getTypesManager(),this._itemsCache=a.getItemCache(),this._magentoClient=new this.imports.EcomMagentoClient(this.getStoreId(),this._environment.getAppInstance().getLocalizer()),this._productBundleConverter=new this.imports.EcomProductBundleConverter,this._cartConverter=new this.imports.EcomCartConverter,this._categoryConverter=new this.imports.EcomCategoryConverter,this._shippingConverter=new this.imports.EcomShippingConverter,this._cartIdHolder=new this.imports.EcomCartIdHolder,this._runningRequests={},this._deleteCartIfNeeded()},getCart:function(a){var b=this,c=this.getCartId(),d=c?this._magentoClient.getCart:function(a,b){b(null)};c=c||this._cartConverter.NULL_CART_ID,this._getData(c,d,function(a){a&&a.cart&&a.cart.clearCart&&(b._deleteCartId(),a=null);var c=b._cartConverter.convertCart(a);return b._setCartId(c.id),c},a)},getCartId:function(){var a=this._itemsCache.get(this.cartIdProperty)&&this._itemsCache.get(this.cartIdProperty).getValue();if(!a){var b=this._cartIdHolder.getCartId();b&&(a=b,this._itemsCache.put(this.cartIdProperty,a))}return a},clearCartId:function(){this._itemsCache.remove(this.cartIdProperty),this._deleteCartId()},_setCartId:function(a){a!=this._cartConverter.NULL_CART_ID&&this.getCartId()!=a&&(this.resources.W.Config.env.$isPublicViewerFrame&&this._cartIdHolder.setCartId(a),this._itemsCache.put(this.cartIdProperty,a))},_deleteCartIfNeeded:function(){if(!this._itemsCache.get("isCartDeleted")||!this._itemsCache.get("isCartDeleted").getValue()){var a=this.resources.W.Utils.getQueryParam(this.paymentSucceededQueryParam);a&&a===this.paymentSucceededQueryParamSuccessValue&&this._deleteCartId()}},_deleteCartId:function(){this._cartIdHolder.clearCartId(),this._itemsCache.put("isCartDeleted",!0)},_deleteCartCookie:d.remove(),_writeCartCookie:d.remove()})}),define.experiment.Class("ecommerce.core.EcomMagentoClient.AtntFix",function(a){var b=a;b.statics({API_URL_SEGMENT:"/apps/ecommerce/api/json",FALLBACK_API_URL_SEGMENT:"/_api/ecommerce/api/json",JSONRPC_METHOD:"frontend",actions:{GET_PRODUCT:"dynamicstore_product.getProductById",GET_CATEGORY:"dynamicstore_category.getCategoryProductsByWixId",GET_CATEGORIES:"dynamicstore_website.getStoreCategoriesTree",GET_STORE_PRODUCTS:"dynamicstore_website.getSimpleProducts",GET_CART:"dynamicstore_order_cart.getCart",GET_SAMPLE_CART:"dynamicstore_order_cart.getSampleCart",ADD_PRODUCT_TO_CART:"dynamicstore_order_cart.addProduct",UPDATE_PRODUCT_IN_CART:"dynamicstore_order_cart.updateProduct",REMOVE_PRODUCT_FROM_CART:"dynamicstore_order_cart.removeProduct",ADD_RANDOM_PRODUCT_TO_CART:"dynamicstore_order_cart.addRandomProduct",SET_COUPON:"dynamicstore_order_cart.setCoupon",CLEAR_COUPON:"dynamicstore_order_cart.clearCoupon",SET_SHIPPING:"dynamicstore_order_cart.setDestination",GET_SHIPPING:"dynamicstore_order_cart.getCountries"},errorCodes:{GET_PRODUCT_ERROR:"2020",GET_CATEGORY_ERROR:"2021",GET_CATEGORIES_ERROR:"2022",GET_STORE_PRODUCTS_ERROR:"2023",GET_CART_ERROR:"2024",GET_SAMPLE_CART_ERROR:"2025",ADD_PRODUCT_TO_CART_ERROR:"2026",UPDATE_PRODUCT_IN_CART_ERROR:"2027",REMOVE_PRODUCT_FROM_CART_ERROR:"2028",ADD_RANDOM_PRODUCT_TO_CART_ERROR:"2029",SET_COUPON_ERROR:"2030",CLEAR_COUPON_ERROR:"2031",SET_SHIPPING_ERROR:"2032",GET_SHIPPING_ERROR:"2033"}}),b.methods({_getFallbackApiUrl:function(){var a="https://fallback.wix.com"+this.FALLBACK_API_URL_SEGMENT+"?metaSiteId="+this.resources.W.Config.getMetaSiteId();return this.resources.W.Config.env.$isPublicViewerFrame&&(a+="&svSession="+this.resources.W.Config.getSvSession()),a},getCategoryProducts:function(a,b,c){var d=this._getParams(this.actions.GET_CATEGORY,{wixId:a}),e="&ro=true";this._sendRequest(d,b,c,this.errorCodes.GET_CATEGORY_ERROR,e)},_getRequestUrl:function(a){var b;return this._useFallback?(this._useFallback=!1,b=this._getFallbackApiUrl()):(this._canRetry=!0,b=this._getApiUrl()),b+=a?a:""},_sendRequest:function(a,b,c,d,e){var f=this._getRequestUrl(e),g=function(){this._canRetry=!1,this._useFallback=!0,this._logger.sendEcomError(12345,"AT&T Fix - Sending Fallback Request","EcomMagentoClient","wos"+d),this._sendRequest(a,b,c,d,e)}.bind(this);this._callInProccess=!0;var h=this._restClient.jsonrpc(f,this.JSONRPC_METHOD,a,{onSuccess:function(){this._callInProccess=!1,clearTimeout(i);var a=arguments[0],c=a[0];this._logger.sendEcomEvent(this._logger.MAGENTO_CLIENT_SUCCESS,{c1:c});var d=arguments[1];b(d)}.bind(this,a),onError:function(){this._callInProccess=!1,clearTimeout(i);var a=arguments[0],b=arguments[3],d=arguments[5];if("object"!=typeof d){var e=arguments[6],f=arguments[7];d={errorCode:e,payload:{code:e,data:f,message:d},errorDescription:d}}if((d.payload.code<1e3||d.payload.code>=2e3)&&this._canRetry)return g(),void 0;a[0];if(this._logger.sendEcomError(d.payload.code,d.payload.message,"EcomMagentoClient","wos"+b),504!==d.payload.code||"en"!==this.resources.W.Config.getLanguage()||this._useFallback||this._canRetry)c?c(d,b):this._msgCtrl.showError(this._localizer.localize("ECOM_SOMETHING_WENT_WRONG_ERR_TITLE"),this._localizer.localize("ECOM_MAGENTO_REQUEST_FAILED_ERR_DESC")+b);else if(c)c(d,b,!0);else{var h="We seem to be having a problem with some of our carrier networks.  Please try again on a WiFi connection. If the problem persists, contact Support with the following error: WOS";this._msgCtrl.showError(this._localizer.localize("ECOM_SOMETHING_WENT_WRONG_ERR_TITLE"),h+b)}}.bind(this,a,b,c,d,e)}),i=setTimeout(function(){this._callInProccess&&(h.cancel(),g())}.bind(this),5e3)}})}),define.experiment.Class("ecommerce.core.EcomShippingAPI.AtntFix",function(a){var b=a;b.methods({_onRequestFail:function(a,b,c){if(c){var d="We seem to be having a problem with some of our carrier networks.  Please try again on a WiFi connection. If the problem persists, contact Support with the following error: WOS";this._msgCtrl.showError(this._localizer.localize("ECOM_SOMETHING_WENT_WRONG_ERR_TITLE"),d+b)}else this._msgCtrl.showError(this._localizer.localize("ECOM_OOPS_ERR_TITLE"),this._localizer.localize("ECOM_CHECKOUT_API_REQUEST_FAIL_ERR_DESC")+b);this._hideLoadingSign(!1)}})}),define.experiment.Class("ecommerce.parts_logic.EcomCheckoutButtonLogic.EcomExp4",function(a){var b=a;b.methods({_initializeInnerData:function(a){this._linkData.target=a.checkoutTarget||this._linkData.target,this.resources.W.Config.env.$isPublicViewerFrame&&this._environment.isMobile()&&(this._linkData.target="_blank")},generateSettingsPanel:function(a,b){var c=b.get("appLogicParams"),d=this,e=c.checkoutTarget&&c.checkoutTarget.value||this._windowOptions[0].value;a.addComboBoxField(d._localizer.localize("ECOM_CHECKOUT_BUTTON_BUYERS_CHECKOUT_LABEL_PANEL"),this._windowOptions).setValue(e).addEvent("inputChanged",function(a){d._linkData.target!=a.value&&(d._linkData.target=a.value,c.checkoutTarget={type:"AppPartParam",value:a.value},b.fireDataChangeEvent())})}})}),define.experiment.Class("ecommerce.parts_logic.EcomJoinedCartLogic.EcomExp8",function(a){var b=a;b.methods({_prepareInnerCompsLogic:function(a,b,c){if(this._cartLogic._addLoadingIndicatorEvents(b),this._chkBtnLogic._initializeInnerData(a),c.getChildValue("hasFees")===!0&&this._chkBtnLogic.setValidationCallBack(this._shippingLogic.validateShipping),this.resources.W.Config.env.$isPublicViewerFrame){var d=this._pageController.getThankYouPageUrl();d&&this._chkBtnLogic._checkoutAPI.setCheckoutSuccessUrl(d),this._chkBtnLogic._checkoutAPI.setReturnToURL(window.location.href)}}})}),define.experiment.Class("ecommerce.parts_logic.ProductBundleLogic.WixAppsGalleryField",function(a){var b=a;b.methods({_handleImageSelectedFromSliderGallery:function(a,b){var c=b.cause,d=b.sender.getCompLogic().getDataItem().get("items"),e=d.indexOf("#"+c.get("id"));if(e>-1){var f=a.getChildValue("mediaItems")[e],g=a.getChildByRef("productMedia");g.setValue(f)}}})});